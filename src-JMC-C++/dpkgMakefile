CPPFLAGS:=$(shell dpkg-buildflags --get CPPFLAGS)
CFLAGS:=$(shell dpkg-buildflags --get CFLAGS) -fopenmp
CXXFLAGS:=$(shell dpkg-buildflags --get CXXFLAGS)
LDFLAGS:=$(shell dpkg-buildflags --get LDFLAGS)

LIBS =   -L. -ldcmt 
CPPFILES = general.cpp acploc.cpp bias.cpp comparscen.cpp conf.cpp data.cpp estimparam.cpp header.cpp matrices.cpp mesutils.cpp modchec.cpp particleset.cpp particuleC.cpp randomgenerator.cpp reftable.cpp simfile.cpp testgen.cpp  
HFILES = global.h particuleC.h history.h header.h 
OBJS = acploc.o bias.o comparscen.o conf.o data.o estimparam.o general.o header.o history.o matrices.o mesutils.o particleset.o particuleC.o randomgenerator.o reftable.o simfile.o sumstat.o modchec.o  
CC = g++$(CCVERSION)

all: general initRNGproject

libdcmt.a:
	cd ../dcmt0.6.1/lib/ && $(MAKE) $(MFLAGS)  

### OK :
acploc.o: acploc.cpp acploc.h
	$(CC) $(CPPFLAGS) $(CFLAGS) -o acploc.o -c acploc.cpp

bias.o: bias.cpp bias.h
	$(CC) $(CPPFLAGS) $(CFLAGS) -o bias.o -c bias.cpp

comparscen.o: comparscen.cpp comparscen.h
	$(CC) $(CPPFLAGS) $(CFLAGS) -o comparscen.o -c comparscen.cpp

conf.o: conf.cpp conf.h
	$(CC) $(CPPFLAGS) $(CFLAGS) -o conf.o -c conf.cpp

data.o: data.cpp data.h
	$(CC) $(CPPFLAGS) $(CFLAGS) -o data.o -c data.cpp

estimparam.o: estimparam.cpp estimparam.h
	$(CC) $(CPPFLAGS) $(CFLAGS) -o estimparam.o -c estimparam.cpp

general.o: general.cpp
	$(CC) $(CPPFLAGS) $(CFLAGS) -o general.o -c general.cpp

header.o: header.cpp header.h
	$(CC) $(CPPFLAGS) $(CFLAGS) -o header.o -c header.cpp

history.o: history.cpp history.h
	$(CC) $(CPPFLAGS) $(CFLAGS) -o history.o -c history.cpp

initRNGproject.o: initRNGproject.cpp
	$(CC) $(CPPFLAGS) $(CFLAGS) -o initRNGproject.o -c initRNGproject.cpp

matrices.o: matrices.cpp matrices.h
	$(CC) $(CPPFLAGS) $(CFLAGS) -o matrices.o -c matrices.cpp

mesutils.o: mesutils.cpp mesutils.h
	$(CC) $(CPPFLAGS) $(CFLAGS) -o mesutils.o -c mesutils.cpp

particleset.o: particleset.cpp particleset.h
	$(CC) $(CPPFLAGS) $(CFLAGS) -o particleset.o -c particleset.cpp
	
particuleC.o: particuleC.cpp particuleC.h
	$(CC) $(CPPFLAGS) $(CFLAGS) -o particuleC.o -c particuleC.cpp

randomgenerator.o: randomgenerator.cpp randomgenerator.h
	$(CC) $(CPPFLAGS) $(CFLAGS) -o randomgenerator.o -c randomgenerator.cpp

reftable.o: reftable.cpp reftable.h
	$(CC) $(CPPFLAGS) $(CFLAGS) -o reftable.o -c reftable.cpp

simfile.o: simfile.cpp simfile.h
	$(CC) $(CPPFLAGS) $(CFLAGS) -o simfile.o -c simfile.cpp

sumstat.o: sumstat.cpp particuleC.h
	$(CC) $(CPPFLAGS) $(CFLAGS) -o sumstat.o -c sumstat.cpp

modchec.o: modchec.cpp modchec.h
	$(CC) $(CPPFLAGS) $(CFLAGS) -o modchec.o -c modchec.cpp

general:  $(OBJS) libdcmt.a
	$(CC) $(CPPFLAGS) $(CFLAGS) $(LDFLAGS) -o general $(OBJS) $(LIBS)

initRNGproject: initRNGproject.o  randomgenerator.o
	$(CC) $(CPPFLAGS) $(CFLAGS) $(LDFLAGS) -o initRNGproject mesutils.o matrices.o initRNGproject.o randomgenerator.o $(LIBS)



### Pour faire des tests



testRNG.o: testRNG.cpp
	$(CC) $(CFLAGS) -o testRNG.o -c testRNG.cpp

testRNG: testRNG.o randomgenerator.o
	$(CC) $(CFLAGS) -o testRNG testRNG.o randomgenerator.o $(LIBS)


clean: 
	\rm -f *.o
	\rm -f general
