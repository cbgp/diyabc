unit UnitMesUtils_5;
{$O+}

interface

Uses Classes, SysUtils, SyncObjs;

type 
  vecteurc = array of cardinal;
  vecteurd = array of double;
  matriced = array of vecteurd;
  vecteurF = array of extended;
  matriceF = array of vecteurF;
  tenseurF = array of matriceF;
  tenseur2F= array of tenseurF;
  vecteurS = array of single;
  matriceS = array of vecteurS;
  tenseurS = array of matriceS;
  vecteurI = array of integer;
  matriceI = array of vecteurI;
  tenseurI = array of matriceI;
  arrayC   = array of char;
  arrayC1  = array of arrayC;
  arrayC2  = array of arrayC1;
  arrayC3  = array of arrayC2;
  arrayS   = array of string;
  arraySS  = array of arrayS;
  arraySSS = array of arraySS;
  vecteurB = array of boolean;
  matriceB = array of vecteurB;
  tenseurB = array of matriceB;
  matriceE = record
    err     :integer;
    x       :array of vecteurF;
  end;
  tenseurE = array of matriceE;

var
  sexratio :extended;

const
  ln2=0.69314718055994530941723212145818;
  mwcg : array[0..9999] of integer
       = (12788298,12788754,12789228,12789669,12789810,12790245,12790848,12790890,12790953,12791154,
          12791580,12791868,12792045,12792069,12792498,12793563,12793584,12793599,12793695,12794760,
          12795024,12795138,12795450,12795543,12795975,12796998,12797034,12797190,12797433,12797523,
          12797595,12798015,12798048,12798258,12798504,12799119,12799155,12799419,12799839,12800640,
          12802278,12802509,12804210,12804648,12805125,12805590,12805944,12806430,12806829,12807864,
          12808155,12809205,12809598,12809703,12809934,12810480,12810489,12810819,12810999,12811053,
          12811680,12811734,12811809,12812475,12812979,12814185,12814359,12815424,12815718,12815913,
          12815919,12816198,12816300,12817503,12817524,12817938,12819030,12819048,12819168,12819300,
          12820140,12820659,12820989,12821133,12821253,12821388,12821634,12821760,12822639,12823284,
          12823614,12823944,12824109,12824340,12824355,12825084,12825279,12825729,12826203,12826320,
          12826695,12826728,12827160,12827163,12827280,12827409,12827685,12827820,12828654,12828750,
          12828774,12829053,12829764,12830529,12830619,12830628,12830790,12830943,12831018,12831033,
          12831174,12831195,12831825,12831999,12832209,12832404,12832890,12834738,12834783,12834918,
          12835023,12835485,12835515,12836400,12836568,12837153,12837468,12837564,12837825,12838524,
          12839019,12841575,12841848,12841863,12842484,12843375,12843564,12845109,12845244,12845343,
          12845700,12846039,12846105,12846270,12846855,12847464,12847539,12847608,12847653,12848034,
          12848223,12848520,12849633,12850068,12850095,12850893,12851709,12852063,12852384,12852405,
          12853173,12853200,12853203,12853824,12853995,12856134,12856464,12856518,12857310,12857913,
          12858669,12858720,12859320,12859620,12860049,12860565,12860748,12861090,12861138,12861288,
          12861558,12862545,12862833,12862875,12862905,12863058,12863094,12863625,12863718,12864285,
          12864549,12864558,12864765,12865038,12865773,12865968,12866199,12866340,12866409,12866448,
          12867348,12867669,12867900,12868119,12868860,12869199,12869709,12869730,12870360,12870765,
          12870840,12871023,12871053,12871383,12871488,12871719,12871878,12871920,12872223,12872388,
          12873699,12874104,12874749,12875373,12876603,12877473,12877653,12877725,12877998,12878535,
          12878715,12878934,12879030,12879600,12880278,12881028,12881274,12881424,12881544,12881679,
          12882699,12883533,12883650,12884058,12884088,12884385,12885039,12885114,12885438,12885738,
          12885753,12885828,12885855,12885954,12886263,12886284,12886293,12886923,12888090,12889608,
          12889638,12889659,12889863,12890094,12890274,12890343,12891189,12891480,12891708,12892068,
          12893304,12893709,12893733,12893790,12895050,12895125,12895545,12896364,12896499,12896889,
          12897114,12897594,12897855,12898350,12898494,12898518,12899064,12899205,12899634,12899904,
          12899988,12900285,12900558,12902223,12902274,12902673,12902733,12902739,12902769,12903090,
          12903384,12903609,12903705,12903993,12904638,12905238,12905469,12905529,12906030,12906123,
          12906288,12907419,12907488,12907725,12908580,12908895,12909060,12909099,12909225,12909894,
          12910134,12910155,12910299,12910593,12910659,12910785,12910824,12910875,12911274,12912273,
          12912549,12914004,12914769,12914775,12915180,12915858,12915900,12916623,12916923,12916995,
          12917190,12917223,12917559,12918078,12918279,12918405,12919449,12919494,12919620,12919668,
          12919728,12919743,12919989,12920604,12920628,12920898,12921543,12921879,12922269,12922494,
          12923019,12924054,12924663,12925344,12925770,12925818,12926163,12926709,12926793,12927183,
          12928194,12928305,12928803,12928908,12929118,12929208,12929934,12930189,12930369,12930810,
          12931614,12931758,12932079,12932763,12933198,12933288,12933660,12934155,12934305,12934395,
          12934569,12935055,12935634,12935934,12936243,12936654,12936948,12937245,12937323,12937755,
          12937830,12939699,12940533,12940689,12940920,12941103,12941799,12942093,12943299,12943455,
          12944025,12944460,12945693,12945735,12946218,12947070,12947088,12947094,12947550,12947739,
          12948033,12948114,12948915,12949254,12949563,12949593,12949884,12950124,12950280,12950490,
          12950664,12951348,12951669,12952713,12953454,12953703,12954858,12955194,12955914,12956019,
          12956298,12957423,12958329,12958368,12958503,12958938,12959355,12959460,12959853,12959940,
          12960030,12960210,12960738,12961269,12961344,12961578,12962019,12962193,12962529,12962625,
          12962823,12963048,12964104,12964599,12964755,12964839,12964929,12965055,12965160,12965739,
          12966834,12967419,12967650,12968133,12968793,12969408,12969429,12969849,12970314,12970500,
          12971508,12972438,12972579,12972750,12972768,12973005,12973020,12973083,12973644,12973680,
          12973839,12974778,12975045,12975219,12975648,12975735,12975969,12976473,12977013,12977415,
          12977418,12977493,12977949,12978300,12978633,12978990,12979005,12979719,12979788,12979938,
          12980478,12981084,12981090,12982254,12983313,12984270,12984930,12985140,12985440,12985719,
          12985959,12986025,12986385,12986418,12986445,12986613,12987315,12987999,12988113,12988254,
          12988500,12988584,12988890,12989184,12989298,12989694,12989970,12990198,12990579,12990675,
          12990684,12991230,12991353,12991839,12991908,12992130,12992559,12993393,12993573,12993708,
          12993915,12994005,12994110,12994233,12994380,12994629,12994653,12995349,12995358,12995493,
          12996435,12996693,12996750,12996819,12996945,12997254,12997383,12997788,12998265,12998928,
          12999720,13000155,13000188,13000329,13000740,13000845,13001694,13001763,13002408,13002525,
          13002534,13003410,13004073,13005453,13005510,13006080,13006194,13006584,13006830,13007250,
          13007343,13007928,13008159,13008240,13008303,13008390,13008405,13008603,13009428,13009458,
          13009848,13010043,13010364,13011813,13012683,13013250,13013283,13013385,13013439,13014819,
          13015359,13015455,13015623,13016118,13016178,13016259,13016400,13016895,13016910,13017294,
          13017714,13017765,13018869,13019388,13019394,13019874,13020480,13021008,13021068,13021434,
          13021788,13021953,13022295,13022490,13022628,13023084,13023720,13023744,13024254,13024464,
          13024539,13025058,13025220,13026180,13028364,13028694,13028763,13029219,13030038,13030065,
          13030584,13030665,13030848,13030953,13030965,13031004,13031529,13031814,13031925,13032750,
          13032885,13033200,13033548,13033674,13033914,13034154,13034214,13034409,13035123,13035774,
          13035795,13036209,13036398,13036764,13037265,13037490,13038414,13038588,13038843,13038939,
          13038960,13040508,13040544,13041039,13041168,13041285,13041438,13041669,13041699,13043250,
          13043379,13044360,13044465,13044759,13045119,13045233,13045374,13046148,13046745,13047495,
          13047573,13048404,13048503,13048854,13050405,13050474,13050483,13050993,13051644,13051974,
          13052865,13053849,13054074,13054275,13054734,13054800,13054824,13055319,13055334,13055769,
          13056015,13056153,13056588,13056753,13056999,13057170,13057245,13057749,13058490,13058898,
          13059105,13059183,13059864,13060635,13060905,13061130,13061754,13063203,13064064,13065654,
          13066365,13066668,13067100,13067430,13067499,13067625,13067634,13068243,13068270,13068594,
          13069038,13069830,13070190,13071009,13071180,13071390,13071513,13071663,13071729,13071894,
          13072104,13072479,13073085,13073130,13073175,13073385,13073739,13073745,13074030,13074789,
          13075053,13075173,13075578,13075734,13076958,13077033,13077153,13077165,13078188,13078293,
          13078770,13078845,13078848,13078905,13079448,13079595,13080378,13081038,13082160,13082433,
          13082559,13082823,13083375,13083909,13084560,13084713,13084875,13085058,13085175,13085205,
          13086969,13087170,13087269,13087308,13087548,13087623,13088640,13088814,13088928,13089279,
          13089465,13090329,13091130,13091298,13091460,13091529,13091775,13092168,13093080,13094325,
          13094364,13094535,13095138,13096458,13096923,13097298,13097340,13097364,13097649,13097913,
          13097928,13097934,13098084,13098258,13098795,13099323,13099818,13099989,13100034,13100538,
          13100805,13100979,13102095,13102704,13103025,13103223,13104195,13105644,13105749,13105980,
          13106259,13106778,13106994,13107195,13107363,13107429,13107489,13107588,13107870,13109628,
          13109715,13109808,13110165,13110195,13110660,13111209,13111245,13111410,13111704,13112589,
          13113015,13113084,13113519,13114098,13114983,13114995,13115004,13115235,13115574,13115613,
          13115718,13116213,13116225,13117200,13117629,13117713,13117998,13118160,13118220,13118283,
          13118388,13118973,13119903,13120359,13120713,13120854,13120869,13121178,13121220,13121364,
          13121580,13122528,13123353,13123809,13124004,13124499,13124688,13125159,13125783,13126203,
          13127268,13128024,13128093,13128603,13128723,13129500,13129854,13129875,13130100,13130169,
          13131009,13131240,13131360,13131654,13132035,13132395,13132398,13132539,13133103,13133418,
          13133595,13133664,13133769,13134264,13134600,13134924,13135314,13136028,13136448,13136745,
          13137369,13137663,13137765,13138899,13139448,13140459,13140540,13140795,13140813,13141023,
          13141029,13142394,13142553,13143039,13144194,13144698,13144785,13145604,13146249,13146588,
          13146684,13146924,13147320,13148148,13148229,13148523,13148898,13149780,13150098,13150764,
          13150779,13151148,13151340,13152108,13153035,13153434,13153839,13154043,13154250,13154628,
          13154970,13154985,13155120,13155168,13155189,13155219,13155243,13155258,13155618,13155804,
          13155873,13156155,13156395,13156440,13157268,13157529,13157850,13157949,13158213,13158228,
          13159125,13159284,13159374,13159689,13159740,13159809,13161369,13161600,13161609,13161819,
          13162005,13162833,13162908,13162923,13163028,13163703,13164168,13164639,13164759,13164975,
          13165443,13165743,13166124,13166418,13166445,13167399,13169355,13169778,13169793,13170528,
          13171119,13171674,13171884,13172535,13173264,13173600,13173660,13174158,13174479,13174959,
          13175043,13176198,13176219,13176405,13176483,13177014,13177164,13177209,13177779,13177818,
          13177989,13178043,13179498,13179963,13180200,13180293,13180479,13180920,13180983,13181055,
          13181094,13181250,13181643,13182168,13182435,13182993,13183449,13183623,13183800,13183884,
          13184625,13185228,13185519,13185900,13186605,13187460,13188399,13188900,13188915,13189110,
          13191360,13191468,13192374,13192554,13192578,13193760,13194198,13194699,13195440,13195515,
          13195608,13195998,13196274,13196295,13196343,13196595,13196634,13196889,13197489,13198098,
          13198659,13199388,13199529,13201005,13201110,13201200,13201479,13202004,13202109,13202298,
          13202703,13203258,13204524,13204884,13206918,13207068,13207680,13207878,13208109,13208634,
          13208649,13209384,13209825,13209948,13210383,13210713,13211244,13211820,13212303,13213260,
          13213623,13213749,13213758,13214919,13215174,13215318,13215663,13215678,13216455,13216458,
          13216704,13217424,13217823,13217865,13217925,13218240,13218393,13218594,13219254,13220133,
          13220400,13220844,13221498,13221705,13222233,13222488,13222998,13223244,13223259,13223529,
          13224084,13224474,13224558,13225014,13225653,13226364,13227339,13228428,13228740,13229769,
          13230363,13230630,13230909,13231134,13231365,13231593,13232163,13233960,13234218,13235409,
          13236060,13236090,13236528,13236555,13236930,13237014,13237404,13237509,13237713,13238970,
          13240260,13240329,13240695,13240785,13240854,13241394,13241718,13241949,13242123,13242264,
          13242618,13243488,13243650,13243983,13244160,13244214,13244343,13245594,13245669,13246848,
          13247478,13247520,13247904,13248078,13248603,13249803,13249878,13250130,13250388,13250670,
          13250814,13251444,13251783,13252965,13254174,13254903,13256145,13256289,13256598,13256898,
          13257720,13258290,13259538,13260615,13261218,13261359,13262988,13263663,13264878,13265010,
          13265529,13266063,13266510,13267104,13267869,13268388,13268514,13268640,13268679,13268874,
          13269228,13269234,13269303,13269339,13269834,13270554,13270995,13271163,13271838,13271898,
          13272465,13273518,13274229,13275153,13275213,13275519,13275525,13275660,13276539,13277283,
          13277514,13277673,13278258,13278354,13278534,13278720,13278963,13280544,13282065,13283319,
          13283613,13283694,13285005,13285725,13286175,13287279,13287663,13287735,13288674,13288695,
          13288950,13289535,13289559,13290114,13290639,13290690,13291143,13291239,13291698,13291788,
          13292334,13292529,13294845,13294935,13295469,13296624,13298493,13298733,13299675,13300200,
          13302138,13303359,13303449,13303815,13303884,13304010,13304154,13304403,13304445,13304493,
          13304844,13304910,13305249,13305624,13305900,13306389,13307700,13308900,13309119,13310070,
          13310478,13310835,13311108,13311165,13311618,13311735,13312824,13313478,13313544,13314054,
          13314075,13314168,13314369,13315428,13315554,13315803,13315860,13316190,13316208,13316853,
          13316898,13317414,13317525,13318218,13318779,13318914,13318989,13320885,13321509,13321914,
          13321923,13322229,13322403,13322880,13324308,13324668,13325589,13325679,13326435,13326813,
          13327110,13328565,13328958,13328964,13329690,13329834,13330044,13330155,13332063,13332630,
          13333080,13333233,13333353,13333599,13334943,13335075,13335654,13336053,13336644,13337448,
          13337994,13338324,13338528,13338735,13339869,13339875,13340373,13340460,13340778,13341144,
          13341180,13341870,13342614,13343883,13343925,13344519,13344909,13345050,13345524,13345590,
          13346955,13348950,13349385,13349724,13350405,13350453,13351005,13351260,13352658,13352883,
          13353015,13353114,13353333,13353540,13354038,13355418,13356054,13356468,13357134,13357179,
          13358538,13358784,13359174,13359393,13359414,13359450,13359990,13360473,13360980,13360995,
          13361094,13361988,13362150,13362384,13362789,13362849,13363278,13363983,13364328,13364343,
          13364838,13364928,13365729,13365849,13366785,13367280,13367364,13368543,13369284,13369599,
          13369614,13369710,13369983,13371000,13371174,13371495,13371648,13371714,13371813,13372008,
          13372560,13372614,13372923,13373520,13374045,13375089,13375113,13375170,13375485,13376445,
          13376844,13376850,13376970,13377699,13377810,13378293,13378524,13378890,13379118,13379709,
          13379889,13379973,13380150,13380675,13380834,13381368,13382340,13382808,13382913,13382940,
          13383219,13383843,13384179,13384293,13384335,13385355,13386450,13386540,13387014,13387035,
          13387125,13387224,13387419,13387710,13387983,13388343,13388583,13389450,13389459,13389654,
          13389855,13389918,13390038,13390803,13391655,13391844,13392099,13392270,13392819,13393023,
          13393254,13393413,13393845,13393854,13394220,13394514,13395093,13395225,13395360,13396110,
          13396374,13396743,13397733,13397979,13398468,13398903,13399614,13400118,13400784,13400793,
          13401603,13401693,13402038,13403094,13403208,13406139,13406370,13406670,13406718,13407075,
          13407105,13407723,13408164,13408353,13408524,13408728,13408755,13408779,13409484,13410390,
          13410495,13412004,13412223,13413105,13413459,13413504,13415064,13415370,13415394,13417155,
          13417824,13417935,13418109,13418193,13418613,13418760,13421625,13421658,13421784,13422195,
          13422609,13422744,13422843,13423080,13423158,13423305,13423350,13423935,13424208,13424463,
          13425033,13425228,13425279,13425558,13426269,13426335,13426413,13426725,13427244,13427385,
          13428093,13428414,13428750,13428849,13430604,13431228,13431519,13431984,13432608,13432698,
          13433508,13433700,13433703,13434564,13435113,13435380,13436379,13436604,13437249,13437393,
          13437885,13438815,13439010,13439214,13439475,13439529,13439955,13440969,13441179,13441224,
          13441308,13442838,13443468,13443630,13443804,13444359,13445730,13446600,13446978,13447794,
          13448445,13448523,13448544,13449264,13449525,13449804,13450233,13450533,13450848,13451058,
          13451220,13452234,13453068,13453863,13453965,13454223,13455078,13455153,13456128,13456308,
          13456680,13457028,13457139,13457430,13457568,13457883,13458675,13458690,13458879,13459899,
          13460433,13460835,13460844,13461069,13461453,13462014,13462239,13463784,13464468,13465485,
          13465788,13466268,13466400,13466730,13467069,13467174,13467213,13469490,13469589,13470630,
          13470645,13470894,13470924,13471149,13472220,13472289,13472445,13473144,13473219,13474068,
          13474143,13474458,13475004,13475010,13475070,13475319,13475364,13475679,13475739,13476600,
          13476708,13477503,13477734,13478283,13478325,13478784,13479375,13479864,13480005,13480149,
          13481229,13481628,13482165,13483014,13483200,13483260,13483830,13483839,13484223,13484328,
          13484604,13484790,13484985,13485378,13485483,13485840,13487295,13489500,13489539,13490160,
          13490355,13490883,13492248,13492674,13492713,13492905,13493400,13493913,13494390,13494849,
          13495125,13495650,13495674,13495713,13495989,13496229,13497000,13497333,13498233,13498908,
          13499349,13499433,13501323,13501884,13502004,13502073,13502094,13502535,13502970,13503039,
          13503060,13503300,13503978,13504119,13504365,13505019,13505778,13505904,13506168,13506903,
          13506948,13507689,13507905,13508103,13508199,13508943,13509138,13509333,13509759,13510728,
          13510815,13511610,13511778,13511964,13512135,13512510,13512810,13512855,13513503,13514289,
          13514595,13514655,13514688,13515369,13515639,13516080,13516503,13516524,13517055,13517529,
          13517538,13517784,13517880,13518153,13518330,13519125,13519188,13519875,13520358,13520394,
          13520790,13520913,13521945,13522830,13522878,13522920,13523895,13524054,13524090,13524189,
          13524315,13524348,13524459,13525329,13526064,13526505,13526880,13526889,13527654,13528224,
          13528794,13528989,13529484,13530054,13530345,13530954,13531053,13531413,13532265,13532964,
          13533159,13533324,13533558,13534098,13534608,13534668,13534758,13535655,13535709,13535739,
          13536360,13536474,13536843,13537059,13538298,13539648,13539978,13540218,13541343,13541364,
          13541574,13541583,13541694,13541910,13541940,13542009,13542045,13542078,13542093,13543113,
          13544388,13544580,13544745,13545714,13545843,13545930,13546173,13546524,13546659,13547040,
          13547349,13547628,13547943,13548450,13548750,13549140,13549350,13549374,13549998,13550193,
          13550274,13551234,13551648,13551885,13552620,13552704,13553403,13554069,13554810,13555149,
          13555449,13555548,13555983,13556403,13556745,13556898,13557150,13557669,13558740,13559238,
          13559259,13559598,13559868,13560144,13560669,13560993,13562454,13562988,13563165,13563795,
          13563813,13563939,13564053,13564614,13564779,13564905,13565349,13565370,13567020,13567119,
          13567554,13567560,13567824,13567839,13567875,13568679,13569153,13569513,13569819,13569903,
          13569933,13570074,13570119,13571214,13571514,13571718,13573629,13574820,13574880,13576059,
          13578393,13579233,13579299,13579479,13579548,13579818,13581435,13582470,13582749,13583079,
          13583253,13583430,13583658,13583934,13584093,13584255,13584330,13585050,13585299,13586205,
          13586454,13587189,13587369,13587840,13587843,13588035,13588365,13588740,13588869,13589589,
          13589964,13589985,13590420,13590624,13591245,13592094,13592904,13594200,13594305,13594584,
          13595169,13596303,13596495,13597035,13597479,13597644,13598568,13598694,13598763,13600983,
          13601340,13602615,13603239,13603275,13603854,13604343,13604685,13604703,13604835,13605168,
          13605210,13605270,13605549,13605870,13606005,13606164,13606884,13607319,13607520,13607808,
          13608969,13609278,13609410,13609554,13610019,13610685,13610790,13610943,13612218,13612725,
          13613439,13613514,13613808,13613934,13614354,13614600,13614975,13615728,13615755,13615815,
          13616235,13617258,13618323,13618545,13618608,13619343,13620498,13620948,13621629,13621698,
          13621800,13622073,13622160,13622235,13622445,13622670,13622994,13623354,13624650,13624863,
          13625430,13626078,13626129,13626144,13626945,13627605,13628895,13628934,13628940,13630068,
          13630785,13631544,13631595,13632090,13632570,13632840,13632939,13633008,13633533,13634394,
          13634439,13634985,13635138,13635720,13635744,13635933,13636503,13636515,13637013,13637238,
          13637778,13638090,13638114,13638378,13638468,13639269,13639398,13639608,13640508,13641744,
          13641834,13642380,13642509,13643634,13645215,13645329,13645470,13645548,13646835,13647018,
          13647633,13647834,13647963,13649004,13649424,13649790,13650045,13650318,13650720,13651083,
          13651203,13651554,13652229,13653393,13653540,13654308,13654413,13654920,13655103,13655148,
          13655775,13656018,13656303,13656444,13656648,13657704,13657929,13657965,13658064,13658070,
          13658340,13658538,13658658,13658670,13659030,13659273,13659744,13660380,13660728,13660923,
          13661043,13661070,13661463,13661808,13662114,13662345,13662543,13662939,13663620,13663908,
          13664514,13664643,13665390,13665585,13665624,13665840,13665960,13666518,13667328,13667400,
          13667724,13667973,13668210,13668339,13668465,13668918,13668984,13669758,13669794,13669893,
          13670520,13670544,13672005,13673268,13673910,13674540,13675149,13675233,13675458,13675569,
          13675644,13676394,13677480,13677720,13677888,13678314,13678629,13679418,13679700,13679760,
          13681335,13681338,13681629,13682760,13683054,13683078,13683213,13684200,13684398,13684404,
          13685124,13685430,13685628,13685655,13686420,13687149,13687608,13688595,13688835,13688925,
          13689240,13690128,13690449,13690788,13690905,13691034,13691205,13691514,13691985,13692060,
          13692630,13693935,13694463,13696095,13696539,13696563,13697355,13698495,13699293,13699878,
          13699920,13700043,13700895,13701309,13701369,13701789,13702479,13702878,13703595,13704795,
          13705089,13705353,13705440,13705884,13705920,13706208,13706550,13706844,13706913,13707090,
          13707180,13707300,13707720,13708365,13708908,13709280,13709574,13709883,13710045,13710834,
          13710843,13711059,13711194,13712010,13712703,13713054,13713315,13713573,13714698,13715880,
          13716630,13716993,13717305,13717434,13718268,13718289,13719243,13719270,13720143,13720479,
          13721895,13722114,13722225,13723428,13723458,13723755,13724070,13724133,13724484,13725075,
          13725225,13726185,13726410,13726440,13726860,13727874,13727928,13728783,13729818,13729884,
          13730610,13731294,13731753,13732359,13732458,13732830,13733328,13733739,13733898,13733985,
          13734654,13734804,13735473,13736883,13737234,13737363,13737903,13737924,13738098,13738515,
          13739115,13739289,13739319,13739745,13741728,13742244,13742799,13743324,13743834,13744170,
          13744308,13744644,13744764,13745925,13747269,13747965,13747989,13748493,13748559,13748703,
          13748760,13749405,13749834,13749939,13750224,13751328,13751904,13752225,13752294,13752639,
          13752774,13752795,13753680,13753779,13753935,13754250,13754289,13754349,13754538,13755264,
          13756203,13756308,13756320,13756599,13756869,13756974,13757145,13757310,13758423,13759983,
          13760493,13760760,13761354,13761543,13762320,13763118,13763433,13764189,13764225,13764594,
          13765899,13766253,13767003,13767309,13767759,13768053,13768584,13768605,13768803,13768935,
          13769340,13769409,13769469,13770039,13770714,13770900,13771299,13771698,13772184,13773144,
          13773213,13773480,13773660,13773849,13774500,13775058,13775313,13776210,13778175,13778658,
          13778679,13778700,13780023,13780254,13780605,13780953,13781130,13781415,13781649,13782423,
          13782738,13784133,13784229,13784295,13784508,13784904,13785210,13785288,13785783,13786128,
          13786629,13786680,13787064,13787403,13787865,13788255,13788603,13789188,13789404,13789668,
          13789845,13791735,13791900,13793055,13794870,13796145,13796409,13796604,13797249,13797690,
          13797990,13798428,13798503,13798713,13798740,13799118,13799448,13799484,13799643,13800408,
          13800570,13800798,13801050,13801224,13801710,13802100,13802190,13803240,13803354,13803825,
          13803993,13804098,13804620,13805505,13806420,13806819,13807098,13807245,13807545,13808088,
          13808283,13808448,13808535,13808655,13810074,13811055,13811109,13811913,13812063,13812084,
          13812939,13813119,13813128,13813275,13813404,13813755,13813764,13814475,13814784,13814925,
          13815060,13815444,13815483,13815564,13816065,13817079,13818003,13818018,13818615,13820580,
          13820754,13820940,13821090,13821429,13821489,13821918,13822164,13822539,13822830,13824663,
          13825110,13825395,13825719,13825815,13826124,13826403,13826454,13826574,13826988,13827684,
          13828605,13829325,13829403,13829898,13830414,13831164,13831485,13831929,13832178,13832910,
          13833348,13833399,13833963,13834314,13834413,13834845,13836618,13836690,13836963,13837143,
          13837233,13837269,13837563,13838199,13838208,13838289,13839669,13839810,13840089,13840203,
          13841649,13842045,13842408,13842468,13843653,13844523,13844985,13845153,13845180,13845375,
          13845453,13846608,13846668,13846683,13846839,13846920,13847664,13847739,13847778,13848240,
          13848828,13848960,13849560,13849758,13850133,13850295,13850364,13850784,13850913,13851354,
          13852068,13852194,13852563,13852608,13852629,13852674,13853118,13854483,13854588,13855098,
          13855119,13855434,13855755,13855803,13856163,13856373,13857060,13857459,13857618,13858848,
          13858890,13859100,13859775,13860528,13860858,13861179,13861509,13861764,13861908,13862469,
          13863135,13863288,13864065,13864920,13865103,13865829,13866093,13866474,13866768,13867083,
          13867935,13868214,13868265,13868340,13868439,13868553,13868595,13869210,13869600,13869705,
          13870059,13870344,13870563,13870959,13871478,13871928,13871940,13871970,13872135,13875120,
          13875225,13875678,13876104,13876638,13877874,13878210,13878339,13878408,13878480,13878543,
          13878585,13878690,13879038,13880640,13880703,13880919,13881159,13881255,13881264,13881315,
          13882488,13882578,13882998,13883058,13883394,13883880,13884150,13884168,13885539,13886283,
          13887180,13888164,13888179,13888515,13889043,13889400,13889469,13889538,13889589,13889979,
          13890198,13890210,13890405,13890558,13892289,13892574,13892703,13893474,13893585,13894500,
          13894548,13895040,13895895,13896228,13896249,13896609,13896789,13897140,13897533,13897764,
          13898010,13898238,13898493,13898499,13899105,13899450,13899963,13900233,13900548,13900788,
          13900803,13901283,13901328,13901979,13902003,13902054,13902354,13903089,13903455,13904358,
          13904688,13905420,13905960,13907250,13907325,13907484,13907613,13907898,13908669,13908678,
          13908933,13909620,13909920,13909959,13910154,13911174,13911558,13912728,13912923,13913100,
          13913385,13913529,13914114,13914795,13914873,13915083,13915398,13915473,13916025,13916574,
          13917624,13917930,13918590,13918800,13919910,13920633,13920840,13921023,13921344,13921614,
          13921890,13921908,13922055,13922370,13922739,13922844,13922919,13923060,13923360,13923594,
          13923858,13924053,13924494,13924545,13924908,13925100,13925595,13925733,13926714,13927023,
          13927674,13927680,13927854,13928109,13928400,13929024,13929303,13929363,13929459,13929843,
          13929888,13930479,13930740,13931160,13931445,13931679,13932273,13932393,13932498,13932525,
          13932645,13932903,13933689,13934043,13934133,13934634,13934973,13935204,13936935,13937124,
          13937283,13937319,13937355,13937748,13937934,13937973,13938018,13938048,13938060,13938249,
          13938918,13939035,13940139,13940184,13940310,13940433,13941819,13942368,13942563,13943124,
          13944123,13944195,13945035,13945524,13946925,13947399,13947738,13948023,13948134,13948380,
          13948809,13948968,13949610,13949634,13950114,13950333,13950360,13950849,13951215,13951623,
          13951830,13952370,13953348,13953450,13953510,13953819,13954164,13954905,13955409,13956003,
          13956030,13956465,13956663,13957083,13957398,13957605,13958559,13959078,13959510,13959564,
          13959855,13960314,13960839,13960908,13960953,13960995,13961538,13963485,13963620,13963725,
          13963998,13964268,13964580,13964844,13964928,13965045,13965375,13965738,13965945,13966050,
          13966209,13966293,13966323,13967040,13967733,13968198,13968864,13969518,13970688,13970694,
          13971090,13971123,13971303,13972599,13972749,13972875,13973349,13973928,13974210,13974615,
          13975230,13975374,13975965,13976154,13976283,13976319,13976799,13977240,13977603,13979103,
          13979229,13979298,13979334,13979754,13980210,13980405,13980519,13980873,13981455,13981764,
          13982049,13983375,13983423,13983780,13984158,13985058,13985073,13985535,13985538,13986249,
          13986648,13986999,13987155,13988139,13988433,13988484,13989525,13989729,13991235,13991400,
          13992285,13992528,13992870,13993920,13994364,13994760,13994763,13995168,13995588,13996443,
          13996548,13996839,13996995,13998474,13999719,13999725,13999950,13999983,14000544,14000649,
          14000700,14000808,14001180,14001420,14001750,14002098,14002464,14002818,14002845,14003808,
          14003829,14004123,14004204,14004249,14004339,14004633,14004948,14005113,14005404,14005794,
          14005950,14007054,14007570,14008029,14009580,14010045,14010780,14011239,14011275,14011968,
          14012088,14012163,14012289,14012499,14012589,14013174,14013444,14013894,14013948,14014083,
          14014230,14014494,14014824,14015883,14016618,14017554,14018025,14018394,14018688,14018778,
          14018823,14019480,14020128,14020809,14020914,14021133,14021325,14021328,14021664,14022495,
          14022579,14023035,14023338,14023728,14024685,14024850,14025219,14025540,14026284,14026320,
          14026425,14026488,14027124,14027199,14027565,14027745,14028090,14030184,14031219,14031423,
          14031660,14031765,14032758,14032893,14033250,14033925,14035203,14035245,14035839,14035980,
          14036319,14036784,14036910,14037069,14037264,14037729,14038059,14038239,14038773,14039058,
          14039424,14039883,14040219,14040480,14040558,14041530,14041569,14041830,14041893,14041929,
          14042634,14044293,14044359,14044485,14045295,14045688,14045745,14045769,14046018,14047215,
          14047638,14048058,14048214,14049315,14049360,14049480,14050215,14050224,14050299,14050410,
          14050770,14051019,14051139,14051370,14051853,14051874,14052318,14052699,14052855,14053485,
          14053623,14053920,14054670,14055333,14055879,14056014,14056080,14057718,14057784,14058093,
          14058105,14058138,14058573,14058600,14058705,14060325,14060388,14060745,14060784,14060994,
          14061213,14061864,14061885,14062170,14062278,14062314,14063403,14063514,14063748,14064399,
          14064579,14064720,14064879,14065125,14065545,14067420,14067438,14067708,14067840,14067969,
          14069094,14069649,14069754,14070075,14070180,14070705,14071239,14072649,14072799,14072889,
          14072910,14073954,14074665,14075403,14075715,14075718,14076669,14076738,14076774,14077518,
          14077539,14078085,14078328,14079825,14079960,14080035,14080209,14081688,14081925,14081988,
          14082204,14082375,14083284,14083359,14083569,14084949,14085039,14085678,14086050,14087430,
          14087769,14087814,14088168,14088483,14088525,14088645,14090109,14091699,14091840,14091903,
          14092104,14093238,14093694,14094204,14094213,14095014,14095179,14095665,14095710,14096493,
          14096703,14097450,14097828,14098140,14098185,14098209,14098719,14099760,14100240,14100534,
          14101155,14101164,14101185,14101524,14101815,14102463,14102808,14102814,14102910,14102949,
          14103183,14103264,14103960,14104314,14104479,14104608,14104683,14104695,14105013,14105949,
          14107428,14109549,14110005,14110170,14110320,14111289,14111394,14111625,14111790,14111895,
          14111913,14112123,14112354,14113068,14113575,14113770,14115279,14116119,14116134,14116413,
          14116470,14116569,14117355,14118879,14119089,14119593,14119635,14119839,14120403,14120778,
          14121399,14121750,14121870,14122155,14122314,14122605,14123658,14123868,14124045,14124144,
          14125254,14126949,14126973,14127039,14127174,14127678,14128029,14128404,14129283,14129379,
          14129820,14130423,14130483,14131305,14131464,14132073,14133375,14133594,14133963,14133969,
          14134623,14134650,14135169,14135853,14135925,14136510,14137395,14138403,14138673,14140059,
          14140494,14140578,14140689,14140794,14141253,14142048,14142978,14143233,14143749,14143944,
          14144004,14144220,14144883,14145318,14145324,14145654,14146998,14147055,14147313,14147325,
          14147493,14147649,14147754,14147958,14148054,14148078,14148189,14148210,14148453,14148783,
          14148918,14149665,14150304,14150829,14150919,14151303,14151435,14151714,14152284,14153265,
          14153298,14153304,14154399,14154993,14155173,14156439,14157429,14157945,14158455,14158578,
          14160723,14160930,14161185,14161404,14162790,14162895,14163258,14163729,14163810,14164260,
          14164449,14165379,14165619,14165940,14165973,14166828,14167698,14167878,14167884,14168004,
          14168508,14168784,14168985,14170008,14170224,14170593,14171064,14171409,14171994,14172039,
          14172135,14172480,14172879,14173008,14173248,14174454,14174979,14175363,14175615,14175678,
          14175705,14175858,14176365,14176575,14176725,14177208,14177310,14178084,14178150,14178918,
          14179308,14179473,14181048,14181270,14181684,14182773,14183280,14183505,14183553,14185665,
          14185938,14186283,14186634,14187414,14187540,14187885,14188818,14188893,14189538,14190189,
          14191953,14192178,14192640,14193018,14194515,14194674,14195829,14196159,14197089,14198454,
          14198778,14199573,14199855,14200080,14200113,14200443,14200788,14200920,14201718,14201778,
          14201928,14202018,14202135,14202495,14202963,14203089,14204124,14205138,14205468,14205645,
          14205834,14206020,14206638,14206875,14206944,14207745,14208255,14209254,14210475,14210685,
          14211564,14212089,14212644,14212728,14212740,14213289,14213325,14213433,14214015,14214819,
          14215134,14215158,14215458,14215614,14215704,14215764,14215935,14216103,14216403,14217279,
          14218029,14218599,14218638,14218845,14219343,14219835,14220099,14220783,14221554,14221773,
          14222169,14222373,14223759,14224188,14224308,14224629,14224689,14225250,14225454,14225565,
          14225610,14225760,14225973,14226510,14226645,14227038,14227413,14228109,14228238,14229474,
          14229753,14230299,14230353,14230488,14231133,14231514,14231958,14231964,14232174,14232399,
          14233425,14234094,14235009,14235759,14235969,14236059,14236170,14236488,14236815,14237283,
          14237370,14237454,14238243,14239488,14240064,14240184,14240328,14240583,14240979,14241015,
          14241183,14241483,14242098,14242995,14243064,14244240,14245104,14246133,14246328,14247450,
          14247705,14247714,14247720,14247918,14248629,14248674,14249424,14249430,14249634,14250249,
          14250339,14250348,14250450,14251338,14251380,14251920,14251965,14252133,14252754,14253144,
          14253264,14253495,14254380,14254614,14255394,14255610,14256024,14256498,14257878,14258430,
          14258538,14260155,14260524,14260743,14262414,14262630,14262843,14263158,14263704,14264040,
          14264274,14264544,14264613,14264949,14265375,14265468,14265573,14267169,14268513,14268834,
          14268939,14269290,14269293,14269455,14270718,14270913,14271864,14272605,14272668,14273154,
          14273769,14273784,14275308,14275359,14275434,14275713,14275764,14275944,14277309,14278605,
          14278893,14278905,14279874,14279979,14280663,14281029,14281539,14283225,14283930,14284080,
          14285235,14285418,14285529,14285568,14285814,14286009,14286045,14286069,14286480,14288139,
          14288475,14289525,14289594,14289813,14290554,14290608,14290638,14291940,14293170,14293719,
          14294013,14294160,14294208,14294439,14296383,14296638,14296854,14297079,14297265,14297904,
          14298189,14298198,14298228,14298798,14298900,14299320,14300058,14300109,14301024,14301165,
          14302035,14302098,14302683,14302830,14302959,14303169,14303799,14303820,14303985,14304114,
          14304129,14304930,14306193,14306214,14306985,14307198,14308440,14308560,14309070,14310384,
          14310615,14311770,14312163,14312385,14312994,14313375,14313549,14313864,14314944,14315109,
          14315139,14315529,14315658,14316468,14316648,14316930,14317020,14317845,14318310,14319780,
          14320509,14320998,14321130,14321433,14321835,14322045,14322840,14322864,14323014,14323179,
          14323413,14323749,14323803,14324148,14324250,14324400,14324580,14324853,14325330,14325363,
          14325594,14325864,14326578,14327085,14327268,14327439,14328300,14328465,14328909,14329143,
          14329185,14329308,14329419,14329494,14329584,14329899,14330154,14330364,14330979,14330988,
          14331309,14331420,14331723,14331849,14332143,14332869,14333499,14334669,14335215,14335230,
          14335305,14335593,14335620,14336250,14336313,14336535,14337048,14337159,14337414,14337813,
          14337894,14338203,14339394,14339478,14340189,14340408,14340525,14341128,14341233,14342013,
          14342124,14342529,14342934,14343438,14343528,14343543,14343570,14343675,14344440,14345490,
          14345499,14345568,14345838,14346168,14346639,14347995,14348373,14348628,14348793,14349510,
          14349849,14350140,14350230,14350278,14350368,14350980,14351865,14352009,14352063,14352084,
          14352705,14352789,14352960,14353569,14354574,14354595,14354673,14355123,14355990,14356398,
          14358105,14358789,14358855,14359524,14360118,14360703,14360805,14361003,14361168,14361945,
          14363124,14363163,14363643,14364333,14364405,14364444,14364465,14364759,14364888,14364903,
          14365299,14365848,14366505,14366628,14366694,14367885,14368203,14368665,14368728,14369508,
          14370534,14370639,14371290,14371560,14372025,14372049,14372349,14372538,14372964,14373279,
          14373285,14374014,14374170,14374188,14374395,14374899,14374938,14374944,14375178,14376183,
          14376264,14376423,14377080,14378895,14379018,14379090,14379138,14379915,14380245,14380308,
          14380548,14380629,14380695,14380839,14380860,14381568,14381988,14382105,14383053,14383368,
          14383509,14383659,14383824,14384040,14384370,14385168,14385210,14385420,14385783,14385903,
          14385999,14386839,14387769,14388234,14389809,14389953,14390073,14390775,14391468,14392329,
          14392875,14393424,14393943,14395359,14396199,14397039,14397078,14397444,14397585,14398989,
          14399703,14399844,14399994,14400705,14400819,14401230,14401854,14402118,14402184,14402784,
          14402973,14403045,14404134,14404164,14404779,14404878,14405124,14405559,14405814,14406915,
          14406945,14407848,14408778,14409210,14409450,14410050,14410263,14410668,14410980,14411130,
          14411715,14411838,14412129,14412234,14412444,14412513,14412948,14413104,14413125,14413398,
          14413665,14413719,14414139,14414439,14414655,14415315,14415420,14415600,14415720,14415915,
          14416344,14417220,14417394,14417403,14418234,14419569,14420103,14420139,14420595,14420955,
          14421378,14422125,14422365,14422743,14422974,14423259,14423349,14424759,14424834,14424948,
          14425239,14425494,14425584,14425890,14426493,14426880,14427633,14427654,14427945,14428980,
          14429019,14429505,14430363,14430855,14431878,14432310,14432709,14432928,14433279,14433333,
          14433438,14433465,14433555,14433663,14434353,14434830,14434833,14435334,14435355,14435490,
          14435754,14436219,14436510,14436939,14436954,14437185,14437668,14437995,14438319,14439354,
          14439519,14439879,14440020,14440863,14441340,14442153,14442489,14442645,14443125,14443968,
          14444079,14444325,14444499,14444520,14444790,14445675,14445828,14446323,14446488,14446620,
          14446893,14447208,14447403,14448000,14448510,14448684,14448843,14449413,14449518,14449680,
          14450754,14451168,14451330,14451339,14451513,14451645,14452389,14452644,14452899,14452974,
          14453058,14453109,14453148,14453460,14453478,14453499,14453715,14453829,14453859,14454243,
          14455005,14455284,14455413,14455539,14456364,14456673,14457810,14458239,14459235,14459253,
          14459469,14460570,14460648,14461248,14461593,14462010,14462115,14462643,14462805,14462949,
          14463288,14463714,14464125,14464194,14464359,14464518,14466465,14466963,14467365,14467395,
          14467905,14468019,14469570,14470053,14470200,14470323,14470389,14470524,14470890,14470950,
          14471853,14471943,14472468,14472855,14473119,14473518,14473770,14473953,14474094,14474505,
          14474673,14475003,14475318,14476305,14476509,14476608,14476950,14477145,14477649,14478435,
          14478798,14478813,14478870,14478975,14479983,14480358,14481204,14481444,14481759,14482773,
          14482824,14484054,14484099,14484144,14484915,14485308,14485365,14485608,14485845,14486049,
          14487165,14487225,14487399,14487564,14487753,14487828,14488053,14488275,14488485,14488884,
          14488929,14489298,14490018,14490063,14492715,14493360,14493924,14494539,14495100,14496195,
          14496264,14496438,14497038,14497110,14497560,14498364,14498868,14499600,14499699,14499729,
          14500239,14501025,14501178,14501235,14501568,14501679,14501808,14502108,14503200,14504754,
          14504913,14505228,14506869,14508120,14508198,14508654,14508735,14509074,14510115,14511105,
          14511129,14511588,14513469,14514063,14514834,14515065,14515245,14515275,14516424,14516688,
          14517009,14517318,14517489,14517528,14517768,14517969,14518683,14518809,14518965,14519334,
          14519760,14520120,14520630,14520915,14521023,14521233,14521290,14521848,14522598,14523075,
          14523369,14523555,14523963,14524908,14525259,14525613,14526273,14526615,14526678,14526834,
          14527068,14527119,14528079,14528289,14528310,14528379,14528793,14529294,14529774,14530449,
          14530620,14530680,14530884,14531100,14531523,14531775,14531919,14532705,14532798,14533278,
          14533824,14534370,14534988,14535888,14536218,14536434,14537298,14537379,14537439,14539104,
          14539308,14539458,14539788,14540004,14540028,14540193,14541264,14541975,14542149,14542518,
          14542545,14543364,14543508,14543799,14544015,14544225,14544534,14545809,14545944,14547060,
          14547354,14549385,14550000,14550129,14550309,14550738,14550885,14551074,14551233,14552139,
          14552403,14552583,14553159,14553720,14554158,14554293,14554488,14554578,14555904,14556069,
          14556105,14556399,14556924,14557053,14557164,14557470,14557653,14558043,14558940,14559138,
          14559678,14560164,14561139,14561475,14562408,14563623,14563689,14563755,14564274,14564550,
          14564553,14564745,14565438,14565858,14565885,14566089,14566578,14566725,14567445,14569350,
          14569644,14569779,14569890,14569974,14570133,14570160,14570358,14570679,14572740,14572788,
          14573355,14574258,14574378,14574810,14574825,14575638,14576169,14576523,14576799,14578260,
          14578515,14578764,14578830,14579040,14579043,14579109,14579403,14579478,14580093,14580150,
          14581083,14581755,14582565,14583033,14583069,14583495,14584959,14585199,14585340,14586024,
          14586345,14586585,14587200,14588334,14588865,14589063,14589390,14590428,14590674,14591079,
          14592549,14592693,14593563,14595048,14595255,14596308,14596560,14596659,14596953,14597265,
          14597478,14597505,14597694,14597943,14598423,14598588,14598609,14600388,14601534,14602020,
          14602794,14603025,14603424,14603634,14603769,14604363,14604624,14604639,14604849,14604924,
          14605155,14605335,14605428,14605485,14605965,14607255,14607759,14607918,14607939,14608074,
          14608263,14608443,14609235,14609469,14610879,14611224,14611380,14612064,14612490,14613105,
          14613183,14613204,14613330,14613555,14613765,14614248,14614353,14614449,14614593,14614635,
          14614710,14615340,14616234,14616663,14617629,14618154,14618895,14619660,14620080,14620149,
          14620203,14620350,14620368,14620500,14620638,14621355,14621688,14621943,14621964,14623560,
          14625699,14626044,14626164,14626248,14626323,14626503,14626923,14627010,14627280,14627604,
          14628120,14628228,14628585,14628684,14629614,14629653,14630538,14630580,14630769,14630985,
          14631348,14631363,14631435,14631825,14631858,14631894,14632260,14632800,14632884,14633370,
          14633379,14633559,14633658,14633688,14633730,14634204,14634714,14635110,14635719,14635884,
          14636250,14637084,14637525,14637543,14637609,14637759,14637843,14637900,14639043,14639400,
          14639979,14640330,14641653,14641968,14641974,14642394,14642649,14642880,14643270,14643633,
          14643915,14643963,14644314,14644335,14644530,14644998,14645004,14645454,14645700,14645820,
          14646618,14647944,14647989,14648508,14648535,14648829,14649414,14649639,14649750,14649789,
          14650083,14650944,14651088,14651559,14651649,14651829,14652069,14652399,14652663,14653665,
          14653785,14653854,14653944,14654100,14654610,14655009,14655333,14656113,14656353,14656548,
          14656659,14657244,14658033,14658249,14658363,14658825,14659260,14659314,14659398,14659593,
          14659824,14660085,14660670,14660685,14660874,14661099,14661738,14662905,14663355,14664345,
          14664843,14664969,14664999,14666763,14667609,14667708,14667729,14667903,14667960,14668569,
          14668710,14669088,14669424,14669940,14670249,14670660,14670669,14670765,14671650,14672670,
          14672760,14673315,14673363,14673390,14673693,14674014,14674638,14674749,14675178,14675799,
          14675853,14675874,14675895,14675940,14676015,14676093,14676114,14676393,14676753,14677299,
          14677500,14677809,14678298,14678325,14678745,14678919,14679048,14680008,14680119,14680614,
          14681769,14682414,14682615,14682738,14682759,14683134,14683569,14683638,14683980,14684418,
          14685300,14685318,14686143,14686383,14686545,14687040,14687238,14687280,14687634,14687910,
          14688420,14689119,14689749,14690010,14690064,14690805,14690973,14691480,14691669,14693025,
          14693130,14693574,14693643,14694120,14694180,14694273,14694285,14694585,14695065,14695323,
          14695365,14695593,14696325,14697123,14697630,14698719,14699124,14699844,14700678,14700810,
          14700840,14700879,14701053,14701140,14701308,14701713,14701929,14702160,14702379,14702649,
          14702694,14702835,14703813,14704014,14704155,14704893,14705268,14705943,14707089,14707164,
          14707248,14707635,14708160,14708508,14709159,14709798,14709819,14710128,14710938,14711148,
          14711553,14711949,14712033,14712249,14712495,14712684,14712990,14713305,14713494,14714004,
          14714304,14715603,14715714,14715960,14716083,14716278,14716350,14716593,14716635,14717058,
          14717280,14717304,14717889,14718015,14718045,14718423,14718918,14719530,14719908,14721588,
          14721759,14722083,14722509,14723085,14723679,14724645,14724843,14725749,14725794,14726529,
          14727003,14727138,14727240,14727345,14727789,14727888,14727990,14728878,14729055,14729610,
          14729670,14729673,14729880,14730663,14730699,14730804,14731170,14731248,14731569,14731890,
          14732259,14732283,14732400,14732469,14732598,14732709,14733075,14734269,14734290,14734398,
          14735718,14736084,14737254,14737260,14737470,14737674,14737833,14737968,14738160,14739123,
          14739288,14739315,14741475,14741838,14742018,14742150,14742354,14742459,14743050,14743740,
          14744103,14744280,14744868,14744988,14745084,14745150,14745363,14745378,14745660,14745813,
          14745885,14746269,14746470,14746878,14747004,14747205,14747724,14748993,14749560,14750508,
          14750553,14750559,14750973,14751369,14751420,14751498,14751813,14751903,14753388,14754108,
          14754270,14754324,14754645,14755065,14755494,14755614,14755788,14756010,14756088,14756130,
          14756319,14756370,14757489,14758023,14759295,14760165,14760648,14761023,14761089,14761368,
          14761428,14762244,14762430,14763255,14763279,14763825,14764104,14764194,14764203,14764809,
          14765784,14766315,14767149,14767269,14767368,14767458,14767665,14768025,14768493,14768520,
          14768550,14768823,14768943,14770320,14770494,14770623,14771103,14771328,14771925,14771985,
          14772300,14772345,14772555,14772573,14772939,14773134,14773365,14773710,14773728,14773764,
          14774763,14775774,14776110,14776389,14776830,14777019,14777298,14777304,14778924,14779485,
          14779539,14780055,14780070,14780574,14780748,14780925,14781198,14782680,14782905,14783298,
          14783454,14783838,14784210,14784285,14784318,14784363,14785698,14786070,14786730,14786895,
          14786964,14787024,14787093,14787414,14787750,14788014,14788548,14788848,14789094,14789268,
          14789754,14789898,14790033,14790429,14792775,14792973,14793114,14793243,14793594,14793765,
          14794044,14794350,14794419,14794464,14795388,14795430,14795448,14795478,14796099,14796453,
          14796885,14797905,14798403,14798559,14798619,14798664,14799069,14799375,14800260,14800335,
          14801484,14801778,14801874,14802798,14803275,14803695,14804004,14804970,14805213,14806155,
          14806518,14806629,14806803,14807673,14808384,14808645,14810544,14810778,14811390,14811600,
          14811723,14811900,14812005,14812263,14812440,14812503,14812614,14812668,14813364,14813370,
          14813889,14814084,14814183,14814735,14814819,14815149,14815695,14816430,14818440,14819238,
          14819370,14819805,14819868,14820123,14820909,14822478,14823375,14824029,14824143,14824320,
          14824464,14825109,14825340,14826090,14826153,14826549,14827524,14827539,14827740,14827824,
          14827845,14828190,14828274,14829045,14829315,14829489,14830164,14830395,14830443,14830470,
          14830815,14830983,14833293,14833698,14833965,14834088,14834313,14834685,14834883,14835348,
          14835369,14835468,14836128,14837004,14838054,14838354,14838759,14839188,14839989,14840535,
          14840955,14841510,14842350,14842383,14842800,14843169,14843199,14844450,14845479,14845485,
          14845578,14845668,14846100,14846103,14846229,14846514,14846724,14847993,14848113,14848638,
          14849313,14849454,14849880,14850615,14850654,14851233,14851374,14851479,14852019,14852079,
          14852169,14852214,14852604,14852754,14853198,14853930,14854950,14855610,14855865,14855889,
          14856705,14856798,14856855,14857314,14857353,14858700,14858844,14859009,14859099,14859318,
          14860104,14860284,14861118,14861223,14861574,14862414,14863113,14863428,14863659,14864283,
          14865480,14865765,14865834,14866038,14866695,14866794,14867193,14867424,14867979,14868369,
          14868495,14868690,14868903,14869095,14869263,14870523,14870628,14871015,14871090,14871750,
          14872245,14872263,14873190,14873865,14874345,14874699,14875389,14876865,14877495,14878875,
          14879589,14879760,14880129,14880780,14881185,14881209,14882013,14882724,14882808,14883210,
          14883930,14884023,14884425,14884524,14884680,14884905,14884944,14885973,14886105,14886525,
          14886840,14887470,14887743,14887773,14887983,14888235,14889105,14889990,14890119,14890650,
          14890788,14891250,14891973,14892195,14892498,14892930,14893428,14893494,14893584,14894079,
          14894289,14894409,14894508,14894520,14895159,14896089,14896173,14896419,14896518,14896599,
          14896824,14897343,14897568,14898030,14898114,14899638,14899695,14899983,14900388,14900463,
          14900760,14902299,14902614,14902689,14902920,14902989,14903094,14903220,14904000,14904084,
          14904168,14904573,14904858,14904894,14905209,14905803,14906268,14906394,14906598,14906658,
          14907123,14908599,14908653,14908884,14909355,14909643,14910543,14910678,14910984,14911074,
          14911578,14911623,14911929,14913210,14913363,14913573,14913780,14913834,14913924,14914518,
          14915100,14915178,14915205,14915235,14915703,14915793,14915898,14915940,14916138,14916453,
          14917014,14917479,14917650,14918238,14919135,14919294,14919960,14920449,14920560,14920584,
          14920734,14920818,14921679,14922333,14923233,14923563,14923704,14923824,14924109,14924133,
          14924448,14924514,14924529,14925768,14925774,14926530,14926728,14926980,14927409,14927598,
          14927829,14927883,14928198,14928339,14928828,14928933,14929458,14929764,14930205,14930955,
          14931195,14931249,14931564,14931705,14932713,14932788,14933280,14933313,14933853,14933919,
          14934393,14934699,14935374,14936550,14936565,14936913,14937345,14937474,14937585,14937828,
          14938035,14939964,14940054,14940063,14940189,14940750,14940960,14941248,14941545,14942625,
          14942793,14942823,14942868,14943975,14943999,14944368,14945034,14945235,14945523,14945700,
          14946480,14946678,14946834,14947008,14947044,14947629,14947860,14948070,14948073,14948790,
          14948958,14949045,14949288,14950068,14950128,14950200,14950689,14951193,14951235,14951619,
          14952348,14952993,14953050,14953494,14953740,14953974,14954055,14954439,14954730,14954988,
          14955504,14956185,14956743,14956815,14956893,14957079,14957904,14958069,14958495,14959923,
          14960169,14960550,14961114,14961513,14961645,14962113,14962413,14962668,14963004,14963304,
          14963850,14964078,14965530,14965548,14966259,14966754,14967540,14967573,14968530,14968713,
          14968779,14969043,14969154,14969295,14969328,14969730,14971059,14971254,14971500,14971704,
          14971740,14972199,14972559,14972760,14972928,14973084,14973255,14973294,14973348,14973579,
          14974413,14974539,14974854,14976633,14976840,14977725,14977875,14978100,14978598,14978694,
          14978964,14979894,14980440,14980965,14981139,14981544,14981595,14981988,14982210,14983083,
          14983290,14983680,14984409,14984688,14985834,14985918,14986683,14986824,14987004,14987313,
          14987538,14987775,14988645,14989218,14989338,14989440,14989590,14989869,14990079,14990163,
          14990253,14990349,14990868,14991438,14991864,14992995,14993124,14993313,14994570,14995095,
          14996013,14996250,14997183,14997483,14997675,14997798,14998008,14998785,14999100,14999403,
          14999613,14999718,14999898,15000144,15000174,15001350,15002250,15002523,15002679,15002784,
          15002868,15003348,15003363,15004434,15004503,15004629,15006015,15006060,15006243,15006423,
          15006555,15006873,15006969,15007335,15007515,15007608,15008139,15008259,15008364,15008613,
          15008784,15009258,15009393,15010104,15010209,15010293,15011364,15011538,15011658,15012144,
          15012525,15012528,15012639,15013179,15013323,15014109,15015945,15016389,15016434,15016788,
          15016845,15017085,15017553,15018189,15018360,15018570,15018633,15019095,15019269,15019848,
          15020004,15020145,15020229,15021264,15022530,15022998,15023040,15023154,15023280,15023340,
          15023799,15023874,15024939,15025065,15025185,15025188,15025953,15026385,15026589,15026934,
          15027018,15027960,15028095,15028200,15028230,15028278,15028485,15029508,15029739,15030180,
          15030984,15031308,15031545,15031923,15031959,15032454,15032910,15032934,15032940,15033165,
          15033534,15033675,15034068,15034128,15034890,15035208,15035769,15035949,15036753,15037824,
          15038733,15038790,15039393,15040059,15040434,15040500,15041544,15041610,15042675,15042849,
          15044133,15044193,15044235,15044595,15044853,15044964,15045093,15045405,15045714,15045933,
          15046713,15046959,15047550,15047625,15048159,15048585,15048624,15048990,15049083,15049128,
          15049380,15049410,15049905,15050208,15050619,15051840,15051855,15051894,15052359,15052980,
          15053070,15053073,15054078,15054084,15054714,15054969,15055680,15055968,15057144,15057453,
          15058623,15059079,15059334,15060168,15060519,15060534,15060729,15060933,15060990,15061365,
          15061773,15062235,15062418,15062820,15063513,15063780,15063870,15063930,15064893,15065085,
          15065154,15065505,15065868,15066393,15067038,15068919,15068928,15069183,15069774,15069960,
          15070068,15070254,15070419,15070443,15070653,15071049,15071529,15071805,15073173,15073695,
          15073875,15074829,15075393,15075765,15076155,15076278,15076704,15076905,15077088,15077094,
          15077475,15078243,15078504,15078693,15078768,15078894,15078945,15079224,15079263,15079593,
          15080499,15080595,15080988,15081609,15081720,15082353,15082443,15082464,15082518,15082968,
          15083079,15083634,15083775,15084195,15084258,15084783,15084885,15086274,15086610,15086868,
          15086973,15087600,15087819,15087834,15088083,15088185,15088548,15088755,15089058,15089073,
          15089379,15089793,15089889,15090534,15091164,15091374,15092214,15092355,15093159,15093645,
          15094593,15094644,15094995,15095013,15095988,15096549,15096744,15097263,15097704,15097920,
          15098544,15098559,15098934,15099084,15099108,15100599,15101043,15101649,15102639,15102828,
          15103044,15103143,15103338,15104100,15105024,15105090,15105705,15107733,15107895,15108345,
          15108855,15109314,15109674,15110913,15111660,15111663,15112275,15112650,15113544,15113550,
          15113574,15113850,15114690,15116178,15116280,15116910,15116958,15117654,15118095,15118593,
          15119115,15119370,15119550,15120375,15120480,15120630,15120693,15121728,15121980,15122013,
          15122085,15122118,15122310,15122418,15122583,15122625,15123504,15123618,15124263,15124620,
          15124863,15124914,15125913,15126354,15126963,15127059,15127194,15128130,15128379,15128559,
          15128565,15128949,15129903,15130890,15131289,15131589,15131778,15131808,15132243,15132429,
          15133005,15133254,15133335,15134010,15134019,15134070,15134658,15135054,15135960,15136215,
          15136728,15137673,15137724,15138288,15138843,15138984,15139005,15139068,15139278,15139290,
          15139695,15140754,15141189,15141585,15141753,15141759,15141789,15141879,15142278,15142335,
          15142644,15142824,15143895,15144003,15145959,15146673,15147213,15147219,15147279,15147690,
          15148308,15148353,15148689,15148938,15149298,15149340,15149763,15150048,15150264,15150918,
          15151329,15152094,15152235,15152469,15153018,15153729,15154320,15155250,15155265,15155949,
          15156153,15156798,15156813,15157749,15158190,15159024,15159078,15159948,15160005,15160353,
          15160488,15160620,15160668,15161559,15162810,15162873,15163119,15163140,15163350,15163425,
          15163473,15164259,15164628,15164874,15166014,15166584,15166638,15167169,15167718,15167835,
          15168174,15168933,15169140,15169488,15169734,15170034,15170358,15170400,15170568,15170589,
          15170595,15170823,15171903,15172869,15173613,15174075,15174495,15174579,15174765,15175023,
          15176469,15176580,15177474,15178209,15178734,15178923,15180858,15180948,15181044,15181950,
          15182115,15182445,15182508,15182898,15182964,15183174,15183453,15183675,15184344,15184410,
          15184749,15184848,15185040,15185904,15186624,15186633,15186834,15187218,15187515,15188274,
          15188484,15188610,15188808,15188943,15189828,15190308,15190620,15190830,15191148,15191718,
          15191868,15192369,15193419,15193554,15193659,15193710,15193728,15193995,15195108,15195240,
          15196128,15196860,15196899,15197844,15198384,15199254,15199359,15199734,15200100,15200289,
          15200748,15200793,15201108,15202248,15203418,15203508,15203565,15203958,15204249,15204654,
          15205575,15205929,15206685,15207153,15207273,15208140,15208410,15208875,15208878,15209019,
          15209418,15210009,15210753,15210759,15210975,15211404,15211794,15211875,15212139,15212253,
          15212439,15212568,15212895,15212964,15214020,15214038,15214314,15214353,15214608,15215199,
          15215343,15216765,15216975,15216984,15217878,15218073,15218424,15218733,15219039,15219069,
          15219918,15220959,15221289,15222030,15222063,15222123,15223374,15225033,15225630,15225930,
          15226764,15227079,15227988,15228615,15229143,15229533,15229680,15229764,15231468,15231579,
          15232770,15232893,15232899,15233085,15233490,15233760,15234009,15235563,15235629,15235644,
          15236100,15236598,15236883,15237024,15237303,15237513,15237885,15239229,15239424,15241350,
          15241380,15241638,15241833,15242415,15242499,15243234,15243735,15243990,15244449,15244575,
          15244605,15245265,15245859,15246159,15246510,15246573,15246699,15247050,15247095,15248853,
          15249948,15250500,15251655,15251964,15252999,15253158,15253620,15254700,15254784,15254805,
          15256428,15256863,15256980,15257379,15258834,15259104,15259179,15259278,15259299,15259800,
          15260049,15260118,15260580,15260655,15262338,15264078,15264585,15264723,15264864,15265803,
          15266934,15266943,15266958,15267315,15267648,15267858,15268473,15269565,15269649,15270318,
          15270870,15271773,15272730,15272760,15273405,15275484,15275580,15275700,15276063,15276555,
          15277818,15277869,15278205,15278799,15278970,15279270,15279705,15280284,15280599,15280779,
          15281139,15282000,15282123,15282315,15282393,15282783,15282888,15282993,15282999,15283194,
          15283845,15284070,15284664,15284910,15285240,15285459,15285819,15286239,15286614,15286788,
          15288174,15288354,15288420,15288630,15289005,15289608,15290145,15292464,15292479,15292815,
          15292914,15293403,15293850,15294003,15294144,15294543,15294843,15295833,15296610,15296775,
          15296943,15297033,15297573,15297579,15297618,15299235,15300165,15300978,15301488,15301818,
          15302070,15302784,15303540,15304443,15304740,15305469,15305535,15306504,15307908,15308640,
          15309900,15310119,15311124,15311475,15312783,15312924,15314268,15315024,15315195,15315579,
          15315690,15316140,15316845,15317340,15317403,15317895,15318159,15319128,15319374,15319413,
          15319713,15320304,15320364,15321369,15321618,15321708,15321765,15322044,15322395,15322548,
          15322860,15323013,15324018,15324123,15324315,15325014,15325608,15325758,15326253,15326814,
          15327774,15327819,15329109,15329283,15329418,15329454,15329748,15330165,15330648,15331308,
          15331449,15331959,15331998,15332793,15333045,15333114,15333834,15334140,15334605,15334974,
          15335229,15336039,15337203,15337209,15337290,15337413,15337578,15338109,15338400,15338613,
          15338763,15339048,15340434,15340650,15341343,15341463,15341934,15342129,15342339,15342954,
          15342999,15343074,15343374,15343908,15344328,15344775,15345309,15345873,15346050,15346860,
          15346929,15347304,15348654,15348975,15349359,15350433,15350775,15352323,15352518,15352818,
          15353604,15353988,15354105,15354195,15354930,15355395,15355638,15356268,15357300,15357705,
          15357738,15358914,15358950,15358980,15359685,15359928,15360894,15361995,15362658,15362709,
          15363585,15363780,15363978,15364275,15364668,15364824,15366708,15366894,15367008,15369315,
          15370173,15370368,15370743,15371853,15373260,15373368,15373953,15374910,15375693,15376329,
          15376473,15377535,15377673,15377928,15378228,15378465,15379110,15379389,15379434,15380235,
          15380238,15381468,15381525,15381609,15381723,15381930,15382923,15383445,15383634,15383934,
          15384309,15385338,15385383,15386244,15386700,15386913,15387924,15388839,15388950,15389265,
          15389364,15389514,15390225,15390438,15390555,15390933,15391305,15391863,15392220,15392523,
          15392949,15393069,15393180,15395553,15395670,15395964,15396345,15396468,15396990,15397074,
          15398625,15399885,15400038,15400704,15401148,15401379,15402225,15402450,15402705,15403059,
          15403128,15403500,15404070,15404175,15404358,15404505,15404634,15405114,15405240,15405549,
          15407403,15407460,15407565,15407739,15407868,15408063,15408855,15409314,15409404,15409728,
          15409740,15410274,15410289,15410568,15410715,15411483,15411753,15411780,15412023,15412110,
          15412383,15413118,15413268,15414339,15414423,15415845,15416238,15416295,15416484,15416874,
          15417450,15418464,15418749,15419010,15419199,15419823,15420879,15421269,15421560,15421878,
          15422160,15422193,15423075,15423105,15423324,15423684,15423810,15424695,15425898,15426690,
          15426705,15426900,15427788,15428160,15428685,15429543,15429600,15429615,15430230,15431085,
          15431295,15431325,15431604,15431673,15431979,15432318,15432399,15432519,15433089,15433110,
          15433269,15433428,15433983,15434145,15434163,15434874,15435228,15435510,15435549,15436788,
          15437604,15437679,15437925,15438933,15439014,15439098,15439434,15439494,15440820,15440925,
          15441318,15442059,15443043,15443229,15443538,15443700,15443865,15444429,15444594,15445323,
          15445545,15446568,15447480,15448338,15448545,15449004,15449103,15449229,15449238,15449343,
          15449349,15449490,15449493,15449763,15450144,15450204,15450330,15450390,15450789,15450903,
          15450924,15451224,15451299,15451908,15452013,15452415,15453228,15453498,15453549,15454848,
          15455685,15455760,15456189,15456279,15457029,15458775,15458778,15460065,15460389,15461550,
          15461619,15461985,15461988,15463374,15463770,15463914,15463923,15464055,15464574,15464739,
          15464790,15465288,15465729,15466443,15466539,15466545,15466749,15467028,15467280,15467319,
          15467478,15467499,15467574,15468729,15468939,15469194,15469215,15469704,15469920,15470193,
          15470439,15471153,15471924,15472743,15473274,15473994,15474003,15474120,15474549,15475089,
          15476178,15476718,15477375,15477714,15477795,15477915,15478509,15478539,15478629,15479100,
          15479133,15479775,15480105,15480114,15480135,15480339,15481854,15482253,15482493,15483360,
          15484455,15484683,15484824,15485298,15485643,15486198,15486600,15486639,15487080,15487203,
          15487860,15487923,15488088,15488148,15488364,15489165,15489765,15490173,15490914,15491019,
          15491304,15491739,15491910,15493149,15494619,15495375,15495648,15496359,15497013,15497229,
          15497373,15497433,15497604,15498024,15498333,15498339,15498564,15498903,15499455,15500238,
          15500334,15500685,15500898,15500919,15501654,15502638,15503058,15503109,15503283,15504024,
          15504039,15505053,15505350,15505809,15506145,15506334,15507750,15507918,15508119,15508548,
          15508569,15508815,15508938,15509478,15509505,15509724,15509739,15509784,15510060,15510255,
          15510663,15510738,15510879,15510915,15512013,15512283,15512829,15513258,15513840,15514509,
          15515244,15515589,15515703,15515778,15516549,15517563,15517695,15518328,15519465,15519600,
          15519633,15520308,15520824,15521100,15521190,15522399,15522765,15522993,15523014,15523050,
          15523794,15523800,15523854,15524268,15524304,15525423,15525969,15526398,15526440,15527118,
          15527844,15528009,15528435,15528603,15528624,15528744,15528903,15529860,15530409,15530520,
          15530574,15531144,15532125,15532179,15532263,15532650,15534435,15535104,15535785,15536304,
          15536430,15536595,15537228,15537735,15537990,15538170,15538689,15538848,15539193,15539298,
          15539859,15539895,15539934,15540108,15540615,15541134,15541140,15541383,15541440,15543120,
          15544353,15544794,15544935,15545523,15545535,15546339,15546600,15547263,15547614,15547824,
          15547839,15547908,15548985,15549414,15549693,15550248,15550899,15551073,15551130,15551793,
          15551868,15552990,15553458,15553473,15554325,15554550,15554649,15555183,15555369,15555564,
          15556365,15556524,15556875,15557238,15557409,15557715,15557799,15558345,15558738,15558939,
          15560025,15560844,15560874,15561420,15561633,15562014,15562434,15562638,15562914,15563019,
          15563154,15563268,15563793,15564093,15564153,15564288,15564945,15565995,15566229,15566583,
          15566640,15569004,15569424,15569613,15569769,15570384,15570525,15570840,15570888,15571980,
          15572073,15572163,15572634,15573054,15573108,15573165,15573810,15573948,15574614,15575103,
          15575343,15575355,15576144,15576228,15576243,15576468,15576930,15577029,15577128,15577365,
          15577554,15578925,15579030,15579225,15580494,15580719,15581118,15581235,15581604,15583263,
          15583308,15583623,15583914,15584124,15584223,15584439,15584793,15585294,15585630,15585828,
          15585930,15586233,15587124,15587325,15587415,15587655,15587838,15588213,15588654,15588753,
          15589599,15589998,15590580,15591303,15591975,15592029,15592050,15592128,15593340,15594474,
          15594744,15594939,15594954,15595284,15595740,15595779,15596508,15596853,15597075,15597378,
          15597498,15597813,15598125,15598209,15599205,15600309,15600465,15600519,15602019,15602853,
          15603963,15604740,15604833,15605265,15605589,15605910,15606000,15606315,15608079,15609039,
          15609363,15609954,15610095,15610374,15610398,15610683,15610755,15610794,15611280,15611859,
          15612099,15612735,15613818,15614310,15615183,15615243,15615639,15616053,15616425,15616488,
          15616755,15617385,15617418,15617640,15618075,15618525,15619110,15619119,15620289,15621144,
          15621519,15623565,15623625,15623685,15625215,15625473,15625524,15625623,15626958,15627450,
          15627849,15628113,15628674,15629250,15629358,15629760,15629778,15630165,15630348,15630648,
          15630654,15630843,15631089,15631299,15632049,15632985,15633288,15633315,15633324,15633345,
          15633378,15633384,15633600,15633624,15633909,15634434,15634869,15634905,15635589,15635604,
          15635793,15635850,15636318,15636459,15636684,15636849,15637080,15637110,15638439,15638595,
          15638958,15639354,15640230,15640530,15640884,15641535,15641730,15642060,15642360,15642555,
          15642630,15642963,15644310,15644580,15644919,15645018,15645405,15645678,15645915,15646449,
          15647250,15647853,15648234,15648435,15648489,15648720,15649140,15649218,15649263,15649899,
          15650010,15650163,15651705,15651948,15652194,15653820,15654114,15654204,15655050,15655065,
          15655755,15656004,15656064,15656205,15656400,15656553,15657753,15658248,15659544,15660603,
          15660858,15661254,15661629,15662325,15662694,15662745,15662955,15663249,15663645,15664995,
          15665460,15665775,15667608,15668604,15668769,15669414,15669594,15669624,15669765,15669945,
          15670494,15670518,15671523,15671799,15672075,15672384,15672405,15672615,15672900,15673284,
          15674334,15674508,15675390,15675903,15676275,15676353,15676419,15677400,15677463,15677514,
          15677784,15677808,15678075,15678453,15678570,15678618,15678894,15679005,15679125,15679284,
          15679524,15680244,15682779,15682860,15682923,15683118,15683715,15684213,15684399,15684849,
          15684963,15685044,15685128,15685143,15685683,15685950,15686199,15686835,15687795,15688029,
          15688188,15689820,15690153,15690174,15690549,15690738,15691395,15692010,15692190,15693369,
          15693675,15693678,15693999,15694143,15694284,15694425,15695985,15696894,15698235,15699159,
          15699288,15699690,15701160,15701334,15701529,15701703,15701868,15702225,15702288,15702330,
          15702684,15702999,15703749,15704409,15704538,15704748,15705225,15705339,15705399,15705714,
          15705759,15705933,15706023,15706824,15706974,15707058,15707073,15707439,15707535,15707604,
          15707970,15708390,15708585,15709134,15709755,15709950,15710079,15711315,15711783,15712248,
          15713325,15713688,15714384,15714459,15714669,15714978,15715524,15715875,15715893,15716574,
          15716628,15717735,15717915,15718629,15718659,15718674,15719283,15719364,15719829,15720045,
          15721128,15721359,15722238,15723069,15723753,15724005,15724779,15724965,15725898,15725925,
          15726249,15726603,15727473,15727788,15728394,15728790,15729570,15729678,15729783,15730098,
          15730224,15730230,15730893,15732468,15732483,15732729,15733833,15734094,15734124,15734229,
          15734274,15735054,15735720,15735975,15735999,15736413,15737193,15737298,15737979,15738960,
          15740289,15740823,15741375,15741633,15741705,15741789,15741894,15742095,15742383,15743139,
          15743580,15744090,15744750,15745065,15745128,15745533,15745545,15746814,15747588,15747753,
          15748260,15748719,15748935,15749223,15749793,15750474,15751509,15751680,15751728,15751770,
          15752055,15752520,15752538,15752589,15752670,15752784,15753645,15753699,15753759,15754674,
          15754725,15755583,15756108,15757230,15757299,15758259,15758340,15758760,15759378,15759450,
          15759765,15759924,15760014,15760338,15760713,15761298,15761340,15761844,15762309,15762513,
          15762675,15763023,15764214,15764223,15764364,15765573,15765879,15766140,15766524,15766539,
          15766875,15767175,15768270,15768813,15769254,15769380,15769569,15769845,15769953,15770004,
          15770073,15770298,15770823,15770985,15771249,15771984,15772299,15772539,15772944,15773658,
          15773904,15774255,15774759,15775368,15775953,15776145,15778053,15778185,15778644,15778899,
          15778983,15779403,15779559,15779790,15779820,15780264,15780315,15780384,15780504,15780573,
          15780978,15781035,15781128,15781275,15781695,15782085,15782199,15782778,15783234,15783453,
          15783459,15784209,15785313,15785910,15786600,15787338,15788784,15789498,15790059,15790824,
          15790950,15790974,15791058,15791100,15791265,15791529,15791844,15791949,15792000,15792045,
          15792468,15792684,15792840,15793755,15793839,15794028,15794670,15794925,15795048,15795174,
          15795324,15795720,15796968,15797130,15797358,15798744,15798774,15798795,15798930,15799599,
          15800223,15800784,15801708,15801819,15802518,15803625,15804729,15805068,15805374,15805485,
          15806229,15806409,15806433,15807453,15807789,15807930,15808194,15808218,15808323,15808530,
          15809325,15810609,15811029,15811128,15811254,15811848,15812625,15812748,15813273,15813468,
          15813525,15813663,15814635,15814713,15814845,15815694,15815838,15816129,15816273,15816708,
          15817143,15817395,15818004,15819138,15819915,15819993,15821148,15821244,15821253,15821490,
          15821790,15822078,15822840,15823020,15823308,15823314,15823539,15823728,15824193,15824325,
          15824379,15824490,15824898,15825348,15825765,15828288,15828420,15828978,15829209,15829533,
          15829593,15829629,15829770,15830178,15830190,15830748,15831294,15831618,15831630,15831798,
          15832599,15832869,15832908,15832983,15833010,15833109,15833250,15834273,15834579,15834798,
          15835293,15836583,15837009,15837255,15837834,15838659,15839145,15839298,15840219,15840285,
          15841770,15842193,15842508,15843030,15843189,15843555,15844014,15844059,15844644,15845109,
          15845409,15845505,15846795,15846900,15847425,15847515,15847593,15848559,15848934,15848970,
          15848979,15849573,15849855,15850113,15850713,15850995,15853263,15854739,15855054,15855468,
          15856470,15856545,15857469,15857520,15858360,15859038,15859344,15859764,15861348,15861489,
          15861720,15862080,15862335,15862509,15863064,15864399,15864510,15865248,15865794,15867225,
          15867810,15867864,15867939,15868044,15868965,15869073,15870189,15870225,15870438,15871344,
          15871419,15872139,15872163,15872484,15873270,15874563,15874683,15875178,15876255,15876444,
          15876690,15876819,15877908,15878028,15878394,15878559,15878754,15879594,15881745,15881904,
          15881988,15882138,15882318,15882663,15883524,15883620,15883755,15883770,15883803,15884349,
          15884673,15884895,15885015,15885198,15885555,15885870,15886524,15887205,15887520,15888663,
          15888885,15889143,15889458,15889503,15889530,15890010,15890049,15890685,15890958,15891099,
          15891963,15892014,15892068,15892533,15892548,15893310,15893325,15893433,15893589,15894408,
          15894969,15895464,15895509,15895914,15896748,15897369,15897678,15898068,15898179,15898203,
          15898935,15899058,15899373,15899415,15899604,15900423,15900954,15903090,15903129,15903528,
          15903660,15904413,15904875,15905889,15906453,15906699,15906855,15907143,15907743,15907878,
          15908070,15908073,15909369,15909438,15909624,15909768,15909873,15910125,15910443,15911460,
          15913044,15913785,15914343,15914808,15915210,15915240,15915519,15915903,15915933,15916038,
          15916275,15917010,15917583,15918048,15918084,15918210,15918354,15918453,15918894,15919068,
          15920310,15920799,15920883,15920973,15921339,15921720,15922248,15922833,15923709,15923775,
          15923814,15923823,15924825,15924843,15925038,15926244,15926355,15926463,15926694,15926823,
          15926880,15926883,15926904,15927324,15927714,15928743,15928890,15929025,15929220,15929550,
          15930270,15930324,15930393,15930765,15931080,15931335,15931458,15931590,15931809,15932544,
          15932598,15932949,15933018,15933039,15933459,15933600,15934419,15934755,15934995,15935199,
          15935499,15935799,15937614,15937878,15937935,15939069,15939105,15939279,15939528,15939684,
          15940854,15940893,15941184,15941370,15942609,15942819,15943263,15943725,15945303,15945570,
          15945978,15946083,15946173,15947013,15947130,15947250,15948615,15949245,15950010,15950415,
          15950424,15950994,15951324,15951348,15951498,15952305,15952464,15952524,15953553,15954228,
          15954405,15954579,15954708,15954999,15955050,15956205,15956619,15957240,15957330,15957339,
          15957525,15958800,15959454,15960069,15960234,15960405,15960549,15960900,15960969,15961203,
          15961725,15961923,15962784,15962838,15962889,15963003,15963048,15963435,15963945,15963969,
          15964218,15964710,15965208,15965514,15965775,15966039,15966360,15966423,15966669,15967074,
          15967425,15967560,15967770,15968160,15968508,15968568,15968664,15969624,15969783,15969789,
          15970014,15970185,15970443,15970653,15971163,15971220,15971364,15971703,15972033,15972849,
          15973383,15973815,15974094,15974529,15975228,15975354,15976713,15976719,15977115,15977148,
          15977385,15977448,15978045,15978933,15979143,15979275,15979365,15979878,15980025,15980313,
          15980388,15980769,15980775,15981255,15981354,15981375,15981438,15981789,15981840,15982719,
          15982935,15983355,15983805,15985158,15985434,15986178,15986379,15986418,15986523,15986718,
          15987069,15987195,15987723,15988374,15988425,15989259,15990075,15990084,15990594,15990708,
          15990735,15990978,15992175,15992883,15993180,15993288,15993354,15993423,15993858,15993933,
          15994818,15995334,15995433,15995850,15996315,15996945,15997119,15997548,15998043,15998598,
          15998850,15998883,15999060,15999513,15999633,15999885,15999918,16000080,16000515,16000764,
          16002363,16002558,16003110,16003239,16003284,16004373,16004469,16004595,16005330,16005525,
          16005720,16005990,16006773,16006848,16006968,16006983,16007514,16007589,16007634,16008093,
          16008723,16008759,16009740,16009920,16010349,16010673,16011000,16011219,16011678,16011819,
          16011975,16012188,16012254,16013784,16014024,16014114,16014453,16015359,16016103,16016133,
          16016244,16016298,16017048,16017105,16017369,16017663,16018674,16018890,16019073,16019490,
          16019955,16020414,16020459,16021065,16021425,16021479,16021569,16021884,16021908,16022208,
          16022328,16022769,16023090,16023648,16023714,16025484,16025649,16025835,16026210,16026279,
          16027080,16028268,16028880,16029024,16029270,16029783,16029984,16030668,16030698,16030929,
          16031340,16031799,16031853,16032033,16032519,16032909,16033065,16033413,16033920,16034373,
          16034505,16036173,16036200,16036803,16036845,16037040,16037508,16037574,16037964,16038138,
          16038225,16038390,16038825,16039308,16039455,16039695,16039749,16040553,16042038,16042173,
          16042389,16042479,16042620,16042779,16042830,16042974,16043550,16043739,16044165,16044909,
          16045215,16045494,16046394,16046595,16046988,16047255,16047429,16047624,16048623,16048680,
          16048770,16049409,16049808,16050354,16051650,16051875,16052250,16052295,16052985,16053348,
          16053555,16054044,16054050,16054239,16054269,16054440,16054653,16054890,16054974,16055385,
          16055589,16055745,16055793,16055814,16055883,16056138,16056969,16056975,16057800,16058193,
          16058364,16058619,16060335,16060455,16060569,16060923,16061055,16061139,16062093,16062525,
          16062624,16063110,16063443,16063635,16063719,16063740,16064613,16064844,16065354,16065654,
          16066014,16066329,16066635,16067700,16067919,16067958,16068240,16068393,16068540,16068693,
          16068804,16069023,16069035,16069155,16069620,16071159,16071534,16072143,16072290,16072950,
          16073664,16074264,16074699,16074720,16074855,16075533,16075584,16075743,16075965,16075974,
          16076394,16077060,16077663,16078068,16078263,16078605,16078794,16079139,16081245,16081929,
          16082283,16082490,16082958,16083255,16083738,16084038,16085613,16085664,16087194,16089315,
          16089888,16090980,16091058,16091394,16091943,16092543,16092579,16093665,16093983,16094130,
          16094160,16094169,16094424,16094490,16095555,16095630,16096449,16096665,16096818,16097358,
          16097448,16098075,16098834,16098843,16099374,16099548,16099704,16100139,16100754,16101183,
          16102488,16103289,16103598,16104003,16104420,16105059,16105599,16106844,16107810,16108560,
          16109730,16109895,16110078,16110210,16110843,16111848,16112088,16112205,16112715,16112883,
          16113285,16113660,16114104,16114119,16114650,16114713,16115313,16115463,16115775,16115844,
          16116084,16116573,16116870,16117290,16117314,16117554,16117644,16117743,16117959,16118310,
          16119054,16119543,16120005,16120164,16120263,16121019,16121175,16121634,16121784,16122288,
          16122519,16122855,16123659,16123968,16124679,16127265,16127310,16127523,16127718,16128234,
          16128255,16128654,16129053,16129299,16129638,16130658,16130793,16130985,16131024,16131405,
          16131510,16131513,16131570,16131864,16132008,16132395,16132449,16132809,16132938,16133628,
          16133778,16134663,16135803,16135815,16135944,16136838,16137069,16137384,16138785,16138854,
          16138959,16140393,16140690,16140990,16141863,16142160,16142823,16143120,16143468,16143615,
          16143825,16143858,16143963,16144449,16144638,16144860,16145049,16145154,16145493,16145619,
          16146528,16147473,16147929,16148019,16148418,16148439,16148775,16149234,16150323,16150530,
          16150620,16151154,16151499,16151700,16152048,16153029,16153200,16153218,16154649,16156503,
          16157343,16157823,16158684,16158720,16158804,16158945,16159023,16159140,16159308,16159785,
          16159923,16160820,16161369,16161423,16161519,16161633,16161864,16161870,16162269,16163115,
          16163223,16163523,16163553,16163910,16163934,16164039,16164453,16164510,16164585,16164798,
          16164840,16165869,16165923,16166274,16166493,16166979,16167693,16167918,16168248,16168254,
          16168428,16168893,16169088,16169445,16169760,16170399,16170978,16171578,16172538,16173114,
          16173279,16173855,16174098,16174203,16174284,16174410,16174683,16175073,16175424,16175610,
          16176594,16177395,16177833,16178403,16178838,16179189,16179273,16179903,16180233,16180923,
          16181253,16181343,16181463,16182288,16183200,16183278,16183653,16183905,16184193,16184283,
          16184319,16184349,16184493,16184649,16185435,16186383,16186413,16186524,16187139,16187349,
          16187430,16187853,16188534,16188903,16189038,16189530,16189563,16190844,16190934,16191258,
          16191495,16191819,16192158,16192245,16192578,16192665,16193925,16194489,16194645,16194840,
          16195764,16196544,16196703,16196733,16197438,16197615,16198539,16198698,16198920,16201554,
          16203354,16203750,16203855,16204383,16205049,16206090,16206684,16206768,16206873,16206999,
          16208769,16208913,16209294,16209645,16210074,16210158,16210194,16210449,16210719,16211394,
          16211580,16211649,16211934,16212024,16212144,16212573,16213284,16213299,16214544,16215573,
          16217058,16217394,16218465,16219203,16219434,16220424,16220448,16220460,16220610,16220859,
          16221105,16221264,16221450,16221468,16221579,16222449,16222560,16222605,16222668,16222680,
          16222995,16223094,16223175,16223259,16223394,16223409,16223835,16224135,16224264,16224684,
          16226544,16226595,16227378,16227540,16227684,16227690,16228125,16228350,16228464,16229283,
          16229610,16229724,16229988,16230273,16231479,16232208,16232229,16232523,16232760,16233735,
          16234650,16234803,16235925,16236135,16236219,16236555,16238178,16238415,16238745,16238934,
          16239129,16239690,16240734,16241145,16241208,16241349,16241544,16242273,16242285,16242624,
          16243545,16243899,16244010,16244253,16244805,16244949,16245534,16245549,16245759,16246410,
          16246590,16246893,16247049,16247613,16247808,16247829,16248099,16248588,16248768,16249785,
          16249839,16250055,16250139,16251078,16252050,16252074,16252260,16252929,16252989,16253898,
          16254339,16254675,16254678,16255284,16255659,16255764,16256160,16256310,16256394,16256628,
          16258533,16259268,16259319,16259625,16259988,16260234,16260360,16260984,16261059,16261314,
          16261830,16262028,16262265,16262595,16262634,16263453,16263468,16264248,16264569,16264605,
          16264890,16265373,16265724,16266075,16266390,16266999,16267275,16267299,16267443,16267503,
          16267800,16267815,16268364,16269054,16269204,16269354,16269519,16269693,16270020,16270455,
          16271085,16271094,16271274,16272189,16272339,16272735,16273158,16273488,16273653,16273905,
          16274040,16274433,16274979,16275060,16275348,16275474,16275738,16275894,16276683,16276785,
          16276953,16277148,16277238,16277439,16277454,16277973,16278339,16278525,16278618,16279170,
          16279353,16280379,16280814,16280844,16281090,16281468,16282620,16282725,16283244,16283508,
          16283739,16283844,16283949,16284729,16285260,16285743,16286085,16286520,16286568,16287150,
          16287219,16287270,16287288,16287303,16287603,16287789,16287879,16287963,16288935,16289649,
          16289658,16289955,16290333,16290804,16291239,16291923,16292163,16292583,16293204,16293918,
          16294095,16294248,16294614,16294920,16295025,16295040,16295850,16296153,16296249,16296279,
          16296378,16296384,16296600,16297173,16297473,16298169,16298175,16299189,16299615,16299660,
          16299933,16300185,16300695,16301298,16302234,16302510,16303014,16303203,16303875,16303980,
          16304469,16304475,16304985,16305684,16306545,16306764,16307763,16307835,16308165,16308555,
          16308780,16310208,16310613,16311000,16311165,16311495,16312098,16312839,16313058,16313223,
          16313679,16314519,16314759,16315320,16315485,16315668,16316220,16316388,16316514,16316598,
          16317105,16317300,16317378,16317489,16317675,16317909,16318425,16319229,16319295,16319784,
          16320534,16320738,16321590,16321758,16322355,16323285,16323669,16323744,16323870,16324068,
          16324644,16325214,16325460,16325589,16326279,16327359,16328049,16328745,16328928,16329855,
          16330053,16330170,16330710,16330824,16331028,16331838,16331964,16332399,16332678,16333089,
          16333419,16333569,16334223,16334388,16334913,16335564,16336149,16336443,16336485,16336578,
          16337040,16337643,16337850,16338300,16339020,16339098,16339470,16339554,16339683,16340019,
          16341555,16341870,16342350,16342875,16343340,16344033,16344048,16344195,16344228,16344453,
          16345335,16345845,16345854,16345959,16347159,16347414,16347468,16348098,16348233,16348923,
          16349070,16349784,16350963,16351569,16351614,16352124,16353264,16353414,16353669,16353735,
          16354428,16354518,16354569,16355079,16355118,16355454,16356378,16356714,16357494,16357500,
          16357950,16358130,16358328,16359375,16359678,16359888,16360539,16361205,16361349,16362345,
          16362813,16362840,16363515,16363809,16364394,16364820,16364838,16365738,16365825,16366893,
          16367070,16367214,16367343,16367643,16367760,16368420,16369044,16369209,16369500,16369533,
          16369995,16370058,16370283,16370673,16370799,16371255,16371633,16371963,16372713,16373094,
          16373349,16374309,16374369,16374768,16375485,16375758,16376253,16376514,16376520,16376538,
          16376640,16377465,16377543,16378029,16378179,16379199,16379250,16379355,16379628,16379880,
          16379919,16380594,16381074,16381155,16381698,16382040,16382049,16382478,16383444,16385733,
          16386405,16387623,16388025,16388145,16388250,16388904,16389315,16389870,16390668,16390743,
          16390839,16391088,16391205,16391430,16391619,16392018,16392453,16392459,16392645,16392723,
          16393074,16393278,16393284,16393893,16394424,16394775,16395060,16395348,16395798,16396470,
          16396665,16397358,16397769,16397853,16398420,16398585,16398858,16399080,16399149,16399299,
          16399740,16399890,16399968,16402515,16402974,16403223,16403943,16404213,16405098,16405179,
          16406409,16407753,16408110,16409529,16409634,16409775,16409964,16410789,16411023,16411134,
          16411653,16411815,16412088,16412445,16412688,16412928,16413150,16413849,16414158,16414458,
          16414668,16415328,16415418,16415679,16416225,16416369,16416564,16416810,16417593,16417614,
          16417638,16419000,16419549,16419870,16420605,16420683,16421790,16422054,16422945,16423320,
          16423389,16423404,16423659,16423743,16424148,16424853,16425003,16425219,16425498,16425513,
          16425855,16426248,16426275,16428345,16428363,16428405,16428480,16428873,16429434,16430175,
          16431618,16431720,16432125,16432923,16433079,16433610,16434039,16434330,16434534,16434879,
          16435248,16435860,16436613,16436685,16437168,16437300,16437768,16438113,16438908,16438923,
          16439244,16439898,16440858,16441233,16441248,16441320,16441719,16442040,16442670,16442748,
          16442940,16443228,16443615,16443840,16444383,16445715,16446603,16446693,16446750,16446798,
          16446870,16447338,16447359,16447794,16447974,16448799,16450725,16451238,16451253,16451349,
          16451715,16451925,16451949,16451985,16452345,16452798,16453014,16453353,16453980,16454130,
          16454190,16454409,16454745,16455465,16457178,16457979,16457994,16458945,16459833,16459944,
          16460709,16461183,16461780,16462320,16462638,16462779,16462845,16463523,16463928,16464000,
          16464123,16464573,16464615,16464945,16465770,16467168,16468149,16469214,16469289,16469304,
          16469514,16469934,16470024,16470270,16471269,16471413,16472544,16472700,16472715,16472868,
          16472880,16472994,16473000,16473243,16473768,16474734,16474743,16475043,16475289,16475478,
          16475493,16475508,16476243,16476330,16476528,16476543,16476960,16477044,16477104,16477185,
          16479315,16479720,16480734,16480824,16481169,16481223,16482135,16482513,16482603,16483428,
          16483998,16484100,16484199,16484298,16484394,16484604,16484709,16485363,16486203,16486599,
          16486725,16486923,16487118,16487175,16487439,16487580,16487835,16488150,16488405,16488483,
          16489470,16489749,16490079,16490304,16490589,16490883,16491153,16491279,16491459,16491513,
          16491534,16491705,16492038,16492215,16494225,16494468,16495269,16495539,16495644,16495770,
          16495863,16496085,16496535,16497519,16497558,16497828,16498503,16498515,16499178,16499220,
          16499244,16500063,16500159,16500228,16500840,16501533,16501623,16501875,16502010,16502430,
          16502868,16502919,16503063,16503084,16503165,16504284,16504635,16504785,16504845,16504974,
          16505145,16505583,16506588,16507449,16508145,16508439,16508448,16508859,16509363,16509804,
          16509954,16510098,16510359,16510455,16510458,16511604,16511655,16511793,16512138,16512348,
          16513068,16513599,16513698,16513710,16513749,16513923,16514718,16515789,16516119,16516248,
          16517154,16518948,16519263,16519353,16519383,16519758,16520010,16520250,16520508,16522323,
          16523265,16523688,16523724,16523793,16523940,16524414,16524513,16524690,16524969,16526985,
          16527105,16527264,16527315,16528194,16529253,16529274,16529334,16529505,16530330,16530843,
          16531305,16531644,16531758,16531983,16531989,16532379,16532463,16533123,16533228,16533528,
          16533600,16534374,16534794,16534839,16534938,16535454,16535610,16535904,16536264,16536498,
          16537503,16537815,16538970,16539633,16539885,16540128,16540650,16541010,16541493,16542054,
          16542603,16542699,16543104,16543323,16544034,16544448,16544769,16545204,16545885,16546299,
          16546773,16546800,16546890,16546950,16547115,16547913,16548060,16548150,16548375,16548633,
          16549203,16549293,16549428,16550049,16550175,16550478,16550610,16550715,16550814,16550853,
          16550988,16551339,16551483,16551528,16551675,16551765,16552029,16552074,16552338,16552410,
          16553064,16555479,16555560,16556028,16556589,16556643,16556883,16557258,16558380,16558434,
          16558905,16558938,16559304,16559490,16560015,16560918,16561545,16561965,16562010,16562328,
          16563165,16563174,16563495,16563504,16563684,16564254,16564539,16564779,16564908,16565253,
          16566120,16566465,16566633,16567374,16568019,16568298,16568688,16569279,16569444,16569720,
          16569795,16569825,16570305,16570554,16570635,16570818,16570833,16572405,16572555,16573134,
          16573263,16574073,16574394,16574724,16574835,16574844,16574955,16575264,16575864,16576035,
          16576203,16576959,16577673,16577859,16578183,16578840,16579008,16579818,16579989,16580184,
          16580205,16580808,16580820,16580889,16581108,16581183,16581204,16582758,16583133,16583319,
          16583523,16583628,16583649,16584705,16584924,16587168,16587318,16587645,16588059,16588269,
          16588575,16588605,16588668,16588803,16588929,16589508,16589649,16590483,16590699,16591215,
          16591575,16592169,16592400,16593030,16593099,16593534,16593570,16593918,16594140,16594218,
          16594380,16594665,16594770,16594938,16594980,16595199,16595499,16596564,16597098,16597173,
          16597200,16597350,16598040,16600920,16601358,16601514,16601694,16601934,16602438,16602528,
          16603179,16604418,16604934,16604970,16605573,16606320,16606803,16607283,16607703,16608939,
          16608960,16609863,16610289,16610814,16611033,16611438,16611444,16612200,16613484,16613919,
          16613994,16614009,16614603,16614975,16615374,16615515,16615659,16616418,16616880,16617594,
          16619343,16619580,16620279,16620609,16620825,16621248,16622469,16623249,16623600,16624503,
          16625874,16626288,16626720,16626813,16626888,16627020,16627098,16627608,16628010,16628034,
          16628694,16629135,16629738,16629990,16630338,16630515,16630890,16631724,16632789,16633740,
          16634070,16634103,16634505,16634709,16635444,16635618,16635864,16636248,16636428,16636980,
          16637004,16637145,16637184,16637214,16637820,16638219,16639110,16639524,16640484,16640700,
          16641033,16641069,16641345,16641615,16641735,16641870,16642584,16642854,16643184,16643610,
          16643994,16644333,16644444,16644654,16644729,16645269,16645425,16645794,16647798,16648635,
          16649220,16650354,16650429,16650735,16651134,16651359,16651563,16651815,16651905,16652424,
          16652475,16653510,16653594,16653684,16653945,16654089,16654230,16655100,16655379,16655895,
          16656318,16658439,16659075,16659195,16659570,16659690,16660473,16660650,16660965,16661034,
          16661118,16661970,16662168,16662420,16663014,16663560,16663734,16664430,16665219,16666368,
          16666590,16667760,16667868,16668564,16668840,16669614,16669989,16670169,16670238,16670415,
          16670790,16670853,16670979,16671393,16671483,16672155,16672260,16673163,16673184,16674714,
          16674798,16674864,16675110,16675194,16675854,16676364,16676490,16677435,16677759,16678269,
          16678389,16678428,16678575,16678644,16678758,16679289,16679844,16681158,16681293,16681494,
          16681845,16682175,16682328,16682568,16682874,16682988,16683180,16683198,16684038,16684629,
          16684779,16685493,16685574,16685778,16686003,16686150,16687143,16687158,16687314,16687500,
          16687509,16687809,16688964,16689120,16689393,16690050,16690113,16690128,16690488,16691073,
          16691190,16693065,16693368,16693788,16694034,16694139,16694319,16695165,16695924,16696575,
          16696713,16696950,16696965,16697988,16698135,16698534,16698729,16699158,16699368,16699584,
          16699590,16699638,16699995,16700850,16701135,16701213,16701513,16702500,16702965,16702983,
          16703244,16703985,16704615,16705128,16705143,16705254,16705503,16706130,16706238,16706280,
          16706319,16706415,16707915,16708509,16708989,16709028,16709133,16709649,16710144,16710330,
          16710894,16711170,16712070,16712493,16712625,16712664,16713210,16713234,16713735,16714053,
          16714200,16714974,16715265,16715733,16716924,16717179,16717764,16718163,16718649,16720479,
          16720893,16720899,16723068,16723350,16723515,16723524,16723668,16723704,16724910,16725624,
          16725693,16725810,16726155,16726203,16726689,16726773,16726980,16727514,16727598,16727655,
          16727823,16727955,16728360,16728513,16729410,16729443,16729965,16730088,16730199,16730565,
          16731228,16731714,16731855,16732449,16732485,16732764,16732839,16733070,16733259,16733808,
          16734294,16735080,16735779,16735815,16736208,16736394,16736829,16737363,16737699,16738518,
          16738914,16739058,16739778,16739898,16740363,16740393,16741170,16741365,16741863,16742709,
          16743174,16743783,16744005,16744290,16745214,16745343,16745385,16746183,16746768,16747455,
          16747869,16748493,16749018,16749108,16749270,16749690,16749843,16749933,16750395,16750758,
          16751409,16751439,16751574,16751595,16751769,16752120,16752174,16752483,16752630,16753770,
          16754598,16754763,16755105,16755249,16755393,16755795,16755963,16756200,16756470,16756968,
          16756995,16757010,16757094,16757439,16758504,16758690,16758810,16759194,16759890,16760163,
          16760868,16761834,16762329,16763295,16763478,16763604,16763913,16763925,16764363,16764648,
          16764780,16765524,16765578,16765665,16765704,16765950,16766760,16767015,16767174,16767498,
          16768170,16768458,16769064,16769445,16770240,16770528,16770759,16771044,16771110,16771530,
          16772409,16772460,16772619,16772700,16772760,16772910,16773063,16773138,16773270,16773873);

  type TGenMars = class
    private
      uni,s,t: extended;
      u: array[0..97] of extended;
      c,cd,cm: Extended;
      ip,jp: Integer;
      procedure init(idum: Integer; i,j,k,l: Integer);
    public
      constructor create(out s1, s2, s3, s4 : Byte); // cre le gnrateur et l'initialise
      procedure initialize(const s1,s2,s3,s4 : Byte);//initialise  l'aide des 4 graines
      function rnd: Extended; overload; // renvoie un extended entre 0 et 1
      function rnd1(coef: Longint): Longint; overload; // renvoie un entier entre 1 et coef
      function rnd0(coef: Integer): Longint; // renvoie un entier entre 0 et coef-1
    end;

  type TMwcGen = record
    mult,modu,x,carry : int64;
  end;

procedure Randinit(mu,mo,xx,ca:integer;var gm:TMwcGen;var OK:boolean);
function Rand(var gm:TMwcGen):extended;
function Rand0(max:integer;var gm:TMwcGen):integer;
function Rand1(max:integer;var gm:TMwcGen):integer;

procedure resample(W:vecteurF;n:integer;var index:vecteurI;var freqmax:integer;var GM:TMwcGen);
procedure randperm(n:integer;var index:vecteurI;var GM:TMwcGen);  //renvoit une permutation alatoire d'entiers compris entre 0 et n-1
procedure kernel_norm_dens(x,w:vecteurF;npoints:integer;mini,maxi,h:extended;var v,d:vecteurF);
           {normal kernel density(x=vecteur des valeurs chantillonnes,
                                  w=vecteur des poids associs,
                                  npoints=nombre de points d'valuations de la densit
                                  mini,maxi =tendue de la variable dont on calcule la densit
                                  h  = constante de lissage
                                  v  = vecteur des valeurs de la variable v[0]=mini,v[pred(npoints)]=maxi
                                  d  = vecteur des valeurs de la densit pour chaque valeur de v
           }
function sumF(W:vecteurF):extended;
function sumI(W:vecteurI):integer;
function meanF(W:vecteurF):extended;
function medianeF(W:vecteurF):extended;
function modeF(W:vecteurF):extended;

function lgamma_dens(const x,b,c:extended):extended; //log(densite(gamma(shape,scale)))
function lgamma_dens2(const x,mean,sd:extended):extended; //log(densite(gamma(mean,sd)))
function lnormal_dens(const x,m,s:extended):extended;//log(densite(normale(m,s)))
function lmnormal_dens(X:vecteurF;M:vecteurF;V:matriceE):extended; //log(densit(multinormale(M,V))
function lognorm_dens(const x,m,s:extended):extended; //=ln(densite(lognormale(mdiane de x,sd de log(x))))
function lognorm_dens2(const x,mu,s:extended):extended; //=ln(densite(lognormale(moyenne de log(x),sd de log(x)))
function ldiri_dens(const n :integer;const alpha,x:vecteurd):extended; //=ln(densite(Dirichlet(alpha,x)))
function lbeta_dens(x,a,b:extended):extended;
function lbinom_dens(m,n:integer;p:extended):extended;
function lpoisson_dens(x:integer;lambda:extended):extended;
function lpoisson_tronquee_dens(x:integer;lambda:extended;xmin,xmax:integer):extended;
function lcomb(n,m:integer):extended;
function lprob_hypergeom(d:integer;n,m:vecteurI):extended;
function lmstudent_dens(x:vecteurF;mu:vecteurF;varcov:matriceE;ddl:integer):extended;
                                             //varcov est la matrice de covariance
function mnormal_kerdens(x,w:vecteurF;ech:matriceE;varcov:matriceE):extended;
function approxerf(x:extended):extended; //approximation de la fonction de rpartition de la loi normale 0,1;

function qnorm5(p,mu,sigma:extended):extended;
function pnorm5(x,mu,sigma:extended):extended;

function gbeta(a,b:double;var GM:TMwcGen):double;
function gbinomiale(n:cardinal;p:double;var GM:TMwcGen):cardinal;
function gmultinomiale(const n,d:cardinal;const p:array of double;var GM:TMwcGen):vecteurc;
function ggamma(shape,rate:double;var GM:TMwcGen):double;
function ggamma2(mean,sd:double;var GM:TMwcGen):double;
function ggamma3(mean,shape:double;var GM:TMwcGen):double;
function gnormal(var GM:TMwcGen):double;  //normale(0,1)
function gnorm(const mu,sigma:double;var GM:TMwcGen):double;
function glognorm(const logmu,logsigma:double;var GM:TMwcGen):double;
function glogunif(const logmin,logmax:double;var GM:TMwcGen):double;
function gdirichlet(const d:cardinal;const lambda:vecteurd;var GM:TMwcGen):vecteurd;
function gchi2(nu:cardinal;var GM:TMwcGen):double;
function gstudent(nu:cardinal;mu,sigma:double;var GM:TMwcGen):double;
function gfisher(n,m:cardinal;var GM:TMwcGen):double;
function prob_hypergeom(d:integer;n,m:vecteurI):double;
function gpoisson(lambda:double;var GM:TMwcGen):integer;
function gpoisson_tronquee(lambda:double;min,max:integer;var GM:TMwcGen):integer;

procedure lognorm_dev(const x:extended;scale2:extended;var rt:extended;var y:extended;var GM:TMwcGen);

function norme(A:matriceE):extended;               //somme des carrs des lments
function transp(A:matriceE):matriceE;             //transpose
function sommeM(A,B:matriceE):matriceE;           //somme
function diffM(A,B:matriceE):matriceE;            //diffrence
function prodM(A,B:matriceE):matriceE;            //produit matriciel
function prodMs(A:matriceE;b:extended):matriceE;  //produit d'une matrice par un scalaire
function invM(A:matriceE):matriceE;               //inversion d'une matrice carree symtrique
function invM_Tik(A:matriceE):matriceE;           //inversion d'une matrice carre symtrique avec rgularisation
procedure writeM(A:matriceE;str:string);          //ecriture d'une matrice (chaque lment au format str
procedure writeFM(filename:string;A:matriceE);    //ecriture dans le fichier <filename> de la matrice A
function puissM(A:matriceE;exposant:extended):matriceE;  //puissance d'une matrice diagonalisable
function copyM(A:matriceE):matriceE;              //copie de matrice
procedure jacobi(var C,V,D:matriceE);             //calcul des vecteurs et valeurs propres de la matrice C
//function gmnorm(nl:integer;mu:vecteurF;varcov:matriceE):matriceE;

procedure ACP(X:matriceE;prop:extended;index:integer;var nlambda:integer;var lambda:vecteurF;var slambda:extended;var vectprop:matriceE;var princomp:matriceE;var moy,sd:vecteurF);

procedure local_regression(matX0,matY:matriceE;vecW:vecteurF;var beta:matriceE);
                                                //matX0 variables prdictrices, matY variables dpendantes
                                                //vecW vecteur des poids ; beta matrice des coefficients de la rgression
//procedure logistic_regression(matX0:matriceE;vecY,vecW:vecteurF;var beta:vecteurF;var px,pxi,pxs:extended);
                                                //matX0 variables prdictrices, vecY vecteur de 1 (bon modle) et 0 (autre modle),
                                                //vecW vecteur des poids beta : coeff de la rgression,
                                                //px proba du modle (=invlogit(beta[0])) et pxi et pxs bornes inf et sup de l'intervalle de confiance  95% de px
procedure polytom_logistic_regression(matX0:matriceE;vecY,vecW:vecteurF;var px,pxi,pxs:vecteurF;var  rep:integer);
                                                //matX0 =matrice des predicteurs, vecY = numero du modle (0  pred(nmodel))
                                                //vecW = pondrations des observations
                                                //px,pxi et pxs = vecteur des proba et bornes inf et sup de leur intervalle de confiance

function gmnorm(nl:integer;mu:tenseurE;varcov:matriceE;var ldens:vecteurF;var GM:TMwcGen):matriceE;
function gmstudent(nl:integer;mu:matriceE;varcov:matriceE;ddl:integer;var ldens:vecteurF;var GM:TMwcGen):matriceE;
//function ldmnorm(X:matriceE;mu:vecteurF;varcov:matriceE):vecteurF;
function Determinant(A:matriceE):extended;
function cbindVV(V1:vecteurF;V2:vecteurF):matriceE;
function cbindMV(M:matriceE;V:vecteurF):matriceE;
function rbindMM(M1:matriceE;M2:matriceE):matriceE;
function rbindVV(V1:vecteurF;V2:vecteurF):vecteurF;
function copyVF(A:vecteurF):vecteurF;

procedure covarianceponderee(A:matriceE;w:vecteurF;var mu:vecteurF;var sigma:matriceE);
procedure quantilesponderes(X,w,q:vecteurF;var quant:vecteurF);

procedure fsort(c:char;n:integer;x:vecteurF);
procedure isort(c:char;n:integer;x:vecteurI);
procedure fsortV(c:char;n,m,index:integer;var x:matriceF);
procedure fsortV2(c:char;n,m:integer;var y:vecteurF;var x:matriceF);
procedure cal_moysdI(n:integer;x:vecteurI;var moy:extended;var sd:extended);
procedure cal_moysdF(n:integer;x:vecteurF;var moy:extended;var sd:extended);
procedure cal_moysdlogI(n:integer;x:vecteurI;var moy:extended;var sd:extended);
procedure cal_moysdlogF(n:integer;x:vecteurF;var moy:extended;var sd:extended);
function logitt(x,xmin,xmax:extended):extended;
function invlogitt(x,xmin,xmax:extended):extended;
function inlimit(x,min,max:extended):boolean;
procedure li_genepop(nomfi:string;var mes,title:string;var nloc,nech,nindtot:integer;var nind:vecteurI;var nomloc,nomind:arrayS;var geno:arraySS);

var
    Gen                          :TMwcGen;
    g1,g2,g3,g4                  :Byte; // rcupration des graines

implementation


const
    iMax = 4294967295;


    { Marsaglia et al, Statistics and Probability letters 9, 35-39
 * i j k l entre 1 et 168, <> (1,1,1,1)

  ******************************************************************************
  exemple d'utilisation :

  var
    gen : TGenMars;
    ra: Extended;
    ri: Longint;

  // dans le prg. principal (une fois qu'il est cr, pas besoin de le recrer)
  // a mettre en dbut de programme (ou dans la section initialization)
  gen := TGenMars.Create();

  // tirage d'une valeur ra entre 0 (inclus) et 1 (exclu)
  ra := gen.rnd();

  // tirage d'un entier entre 1 et 10000
  ri := gen.rnd(10000);

  // tirage d'un entier entre 0 et 9999
  ri := gen.rnd0(10000);
  ******************************************************************************
}
constructor TGenMars.create(out s1, s2, s3, s4 : Byte);
{$IFDEF LINUX}
var
  R : TFileStream;
  OK:boolean;
{$ENDIF}
begin
  inherited Create();
{$IFDEF LINUX}
  try
    R := TFileStream.Create('/dev/random', fmOpenRead);
    repeat
      R.read(s1, 1); s1 := (s1 mod 168) + 1;
      R.read(s2, 1); s2 := s2 mod 169;
      R.read(s3, 1); s3 := s3 mod 169;
      R.read(s4, 1); s4 := s4 mod 169;
      OK:=(s1>=1)and(s2>=1)and(s3>=1)and(s3>=1)and(s1+s2+s3+s4>4);
    until OK;
    self.init(1, s1, s2, s3, s4);
    R.Free();
  except
    Randomize(); // pourri !! La mme milliseconde donne le mme rsultat !
    s1 := Random(168)+1;
    s2 := Random(169);
    s3 := Random(169);
    s4 := Random(169);
    self.initialize(s1, s2, s3, s4);
  end;
{$ELSE}
    Randomize();
    s1 := Random(168)+1;
    s2 := Random(169);
    s3 := Random(169);
    s4 := Random(169);
    self.initialize(s1, s2, s3, s4);
{$ENDIF}
end;

// initialise le gnrateur (= randomize)
procedure TGenMars.init(idum: Integer; i,j,k,l: Integer);
var
  ii,jj,m: Integer;
begin
  for ii:=0 to 96 do
  begin
   s:=0.0;
   t:=0.5;
   for jj:=1 to 24 do
   begin
     m := (((i*j) mod 179)*k) mod 179;
     i:=j; j:=k; k:=m;
     l:=(53*(l) +1) mod 169;
     if (((l* m) mod 64) >= 32) then
       s := s + t;
     t := 0.5 * t;
   end;
   u[ii] := s;
  end;
  c := 362436.0 / 16777216.0;
  cd := 7654321.0 / 16777216.0;
  cm := 16777213.0 / 16777216.0;
  ip := 96;
  jp := 32;
end;

function TGenMars.rnd: Extended;
begin
  uni := u[ip] - u[jp];
  if (uni<0.0) then
    uni := uni + 1.0;
  u[ip] := uni;
  dec(ip);
  if (ip < 0) then
    ip := 96;
  dec(jp);
  if (jp < 0) then
    jp := 96;
  c := c - cd;
  if (c < 0.0) then
    c := c + cm;
  uni := uni - c;
  if (uni<0.0) then
    uni := uni + 1.0;
  Result := uni;
end;

procedure TGenMars.initialize(const s1, s2, s3, s4: Byte);
begin
  Self.init(1, s1, s2, s3, s4);
end;

function TGenMars.rnd1(coef: Integer): Longint;
begin
  Result := trunc(coef*rnd)+1;
end;

function TGenMars.rnd0(coef: Integer): Longint;
begin
  Result := trunc(coef*rnd);
end;
//---------------------------------------------------------------------
//Generateur Multiply-With-Carry
procedure Randinit(mu,mo,xx,ca:integer;var gm:TMwcGen;var OK:boolean);
begin
  if (ca=0)or(ca=pred(mu)) then begin OK:=false;exit;end;
  gm.mult:=mu;
  gm.modu:=mo;
  gm.x:=xx;
  gm.carry:=ca;
  OK:=true;
end;

function Rand(var gm:TMwcGen):extended;
var
  y :int64;
begin
  y:=gm.mult*gm.x+gm.carry;
  gm.x:=y mod gm.modu;
  gm.carry:= y div gm.modu;
  Result:=gm.x/gm.modu
end;

function Rand0(max:integer;var gm:TMwcGen):integer;
begin
  Result:=trunc(Rand(gm)*max);

end;

function Rand1(max:integer;var gm:TMwcGen):integer;
begin
  Result:=succ(trunc(Rand(gm)*max));
end;

//---------------RANDOM PERMUTATION---------------------------------------
{procedure randperm(n:integer;var index:vecteurI;var GM:TMwcGen);  //renvoit une permutation alatoire d'entiers compris entre 0 et n-1
var
  i,j :integer;
  ind  :vecteurI;
begin
  setlength(index,n);setlength(ind,succ(n));
  ind[1]:=1;
  for i:=2 to n do
    begin
      j:=Rand1(i,GM);
      ind[i]:=ind[j];
      ind[j]:=i;
    end;
  for i:=0 to pred(n) do index[i]:=pred(ind[succ(i)]);
end;}

procedure randperm(n:integer;var index:vecteurI;var GM:TMwcGen);  //renvoit une permutation alatoire d'entiers compris entre 0 et n-1
var
  i,j :integer;
  ind  :vecteurI;
begin
  setlength(index,n);
  index[0]:=0;
  for i:=1 to pred(n) do
    begin
      j:=Rand0(succ(i),GM);
      index[i]:=index[j];
      index[j]:=i;
    end;
end;

//---------------RESAMPLING-----------------------------------------------
procedure resample(W:vecteurF;n:integer;var index:vecteurI;var freqmax:integer;var GM:TMwcGen);
var                           //residual sampling Liu & Chen 1998 "Sequential Monte Carlo methods for dynamic systems" JASA
  P:vecteurF;
  u,s   :extended;
  i,js,f     :integer;
begin
  setlength(P,succ(high(W)-low(W)));freqmax:=0;
  s:=0.0;for i:=low(W) to high(W) do s:=s+W[i];
  s:=(1.0/s)*n;
  for i:=low(W) to high(W) do P[i]:=W[i]*s;
  setlength(index,n);
  u:=Rand(GM);
  i:=-1;s:=0.0;js:=-1;
  while js<pred(n) do
    begin
      while s<u do begin inc(i);s:=s+P[i];end;
      inc(js);index[js]:=i;f:=1;
      repeat
        u:=u+1;inc(f);
        if s>=u then begin inc(js);index[js]:=i;end;
      until s<u;
      if f>freqmax then freqmax:=f;
    end;
end;

//----------------UTILITAIRES DE BASE------------------------------------
function sumF(W:vecteurF):extended;
var
  R  :extended;
  i :integer;
begin
  R:=0.0;
  if high(W)>low(W) then
    begin
      for i:=low(W) to high(W) do R:=R+W[i];
    end;
  Result:=R;
end;

function sumI(W:vecteurI):integer;
var
  R  :integer;
  i :integer;
begin
  R:=0;
  if high(W)>low(W) then
    begin
      for i:=low(W) to high(W) do R:=R+W[i];
    end;
  Result:=R;
end;

function meanF(W:vecteurF):extended;
var
  R  :extended;
  i :integer;
begin
  R:=0.0;
  if high(W)>low(W) then
    begin
      for i:=low(W) to high(W) do R:=R+W[i];
    end;
  Result:=R/succ(high(W)-low(W));
end;

function medianeF(W:vecteurF):extended;
var
  X:vecteurF;
  n,i :integer;
begin
  n:=succ(high(W));
  setlength(X,n);
  for i:=low(W) to high(W) do X[i]:=W[i];
  fsort('a',n,X);
  if (n mod 2)=0 then Result:=0.5*(X[pred(n div 2)]+X[n div 2]) else Result:=X[pred(n) div 2];
end;

function modeF(W:vecteurF):extended;
var
  X:vecteurF;
  n,i,l,l0,l2,dl,lmin :integer;
  min  :extended;
begin
  n:=succ(high(W));
  setlength(X,n);
  for i:=low(W) to high(W) do X[i]:=W[i];
  fsort('a',n,X);
  l0:=1;l2:=n;dl:=trunc(0.5*(l2-l0));
  while (X[pred(l0)]<>X[pred(l2)]) do
    begin
      min:=X[pred(l0+dl)]-X[pred(l0)];lmin:=l0;
      for l:=l0 to l2-dl do if (X[pred(l+dl)]-X[pred(l)])<min then
        begin
          min:=X[pred(l+dl)]-X[pred(l)];
          lmin:=l;
        end;
      l0:=lmin;l2:=lmin+dl;dl:=trunc(0.5*(l2-l0));
    end;
  Result:=X[pred(l0)];
end;

//---------------CALCUL MATRICIEL----------------------------------------
function norme(A:matriceE):extended;
var
  i,j  :integer;
  s    :extended;
begin
  s:=0.0;
  for i:=0 to high(A.x) do
    for j:=0 to high(A.x[0]) do
      s:=s+sqr(A.x[i,j]);
  Result:=s;
end;

function transp(A:matriceE):matriceE;
var
  i,j : integer;
  B   :matriceE;
begin
  setlength(B.x,succ(high(A.x[low(A.x)])),succ(high(A.x)));
  for i:=0 to high(A.x[0]) do
    begin
      for j:=0 to high(A.x) do B.x[i,j]:=A.x[j,i];
    end;
  B.err:=0;
  Result:=B;
end;


function sommeM(A,B:matriceE):matriceE;
var
  i,j  :integer;
  C    :matriceE;
begin
  if high(A.x[0])<>high(B.x[0]) then begin C.err:=1;Result:=C;exit;end;
  setlength(C.x,succ(high(A.x)),succ(high(A.x[0])));
  for i:=0 to high(A.x) do
    begin
      for j:=0 to high(A.x[0]) do
        begin
          C.x[i,j]:=A.x[i,j]+B.x[i,j];
        end;
    end;
  C.err:=0;
  Result:=C;
end;

function diffM(A,B:matriceE):matriceE;
var
  i,j  :integer;
  C    :matriceE;
begin
  if (high(A.x[0])<>high(B.x[0])) then begin C.err:=1;Result:=C;exit;end;
  setlength(C.x,succ(high(A.x)),succ(high(A.x[0])));
  for i:=0 to high(A.x) do
    begin
      for j:=0 to high(A.x[0]) do
        begin
          C.x[i,j]:=A.x[i,j]-B.x[i,j];
        end;
    end;
  C.err:=0;
  Result:=C;
end;

function prodM(A,B:matriceE):matriceE;
var
  i,j,k : integer;
  C    :matriceE;
begin
  if high(B.x)<>high(A.x[0]) then
    begin
      C.err:=2;
      Result:=C;
      exit;
    end;
  setlength(C.x,succ(high(A.x)),succ(high(B.x[0])));
  for i:=0 to high(A.x) do
    for j:=0 to high(B.x[0]) do C.x[i,j]:=0;
  for i:=0 to high(A.x) do
    begin
      for j:=0 to high(B.x[0]) do
        for k:=0 to high(A.x[0]) do
      C.x[i,j]:=C.x[i,j]+A.x[i,k]*B.x[k,j];
    end;
  C.err:=0;
  Result:=C;
end;

function prodMs(A:matriceE;b:extended):matriceE;
var
  i,j :integer;
  C    :matriceE;
begin
  setlength(C.x,succ(high(A.x)),succ(high(A.x[0])));
  for i:=0 to high(A.x) do
    for j:=0 to high(A.x[0]) do C.x[i,j]:=b*A.x[i,j];
  C.err:=0;
  Result:=C;
end;

function invM(A:matriceE):matriceE;
var
 i,j,k,l,n    :integer;
 max,pivot,coef :extended;
 T              :array of array of extended ;
 C              :matriceE;
  //Form1->Fonction->Caption="inversion matricielle avec sl_inv_jordan";
begin
  n:=succ(high(A.x));setlength(C.x,n,n);
  setlength(T,n,2*n);
  for i:=0 to pred(n) do
      for j:=0 to pred(n) do
        begin
          T[i,j]:=A.x[i,j];
          if (i=j) then T[i,j+n]:=1.0 else T[i,j+n]:=0.0;
        end;
  C.err:=0;
  k:=0;
  while ((C.err=0)and (k<n)) do
    begin
      max:=abs(T[k,k]);
      l:=k;
      for i:=succ(k) to pred(n) do
        if max<abs(T[i,k]) then
          begin
            max:=abs(t[i][k]);
            l:=i;
          end;
      if(max<>0) then
          begin
            for j:=k to pred(2*n) do
              begin
                max:=T[k,j];
                T[k,j]:=T[l,j];
                T[l,j]:=max;
              end;
            pivot:=T[k,k];
            if (pivot<>0) then
              begin
                for j:=succ(k) to pred(2*n) do T[k,j]:=T[k,j]/pivot;
                for i:=0 to pred(n) do
                  if i<>k then
                    begin
                      coef:=T[i,k];
                      for j:=succ(k) to pred(2*n) do T[i,j]:=T[i,j]-coef*T[k,j];
                    end;
              end
              else
                C.err:=3;
          end
          else
            C.err:=3;
      inc(k);
    end;
  if C.err=0 then
    begin
      for i:=0 to pred(n) do
        for j:=0 to pred(n) do
            C.x[i,j]:=T[i,j+n];
    end;
  Setlength(T,0,0);
  Result:=C;
end;

function invM_Tik(A:matriceE):matriceE;
var
  t,coeff  :extended;
  i,j,n  :integer;
  AA,B  :matriceE;
begin
  B:=invM(A);
  if B.err=0 then begin Result:=B;exit;end;

  coeff:=1E-12;
  n:=succ(high(A.x));
  setlength(AA.x,n,n);
  for i:=0 to pred(n) do for j:=0 to pred(n) do AA.x[i,j]:=A.x[i,j];
  t:=0.0;for i:=0 to pred(n) do t:=t+abs(A.x[i,i]);t:=t/n;
  for i:=0 to pred(n) do AA.x[i,i]:=AA.x[i,i]+coeff*t;
  repeat
    B:=invM(AA);
    if B.err>0 then
      begin
        coeff:=10.0*coeff;
        for i:=0 to pred(n) do AA.x[i,i]:=A.x[i,i]+coeff*t;
      end;
  until (B.err=0)or(coeff=0.1);
  B.err:=1;
  Result:=B;
end;

procedure writeM(A:matriceE;str:string);
var
  i,j :integer;
begin
  for i:=0 to high(A.x) do
    begin
      for j:=0 to high(A.x[i]) do write(format(str,[A.x[i,j]]));
      writeln;
    end;
end;



procedure writeFM(filename:string;A:matriceE);var
  i,j  :integer;
  ff   :textfile;
begin
  assignfile(ff,filename);rewrite(ff);
  for i:=0 to high(A.x) do
    begin
      for j:=0 to high(A.x[i]) do write(ff,A.x[i,j],' ');
      writeln(ff);
    end;
  closefile(ff);
end;

function copyM(A:matriceE):matriceE;
var
  i,j,nl,nc :integer;
  C   :matriceE;
begin
  nl:=succ(high(A.x));nc:=succ(high(A.x[0]));
  setlength(C.x,nl,nc);
  for i:=0 to pred(nl) do
    begin
      for j:=0 to pred(nc) do C.x[i,j]:=A.x[i,j];
    end;
  C.err:=A.err;
  Result:=C;
end;

function copyVF(A:vecteurF):vecteurF;
var
  i  :integer;
  C  :vecteurF;
begin
  setlength(C,succ(high(A)));
  for i:=0 to high(A) do C[i]:=A[i];
  Result:=C;
end;

function Sgn(x:extended):extended;
begin
  if x>0.0 then Result:=1.0 else Result:=-1.0;
end;

function Pythag(a,b:extended):extended;
begin
  Result:=sqrt(sqr(a)+sqr(b));
end;

procedure swap(var a,b:extended);
var
  p  :extended;
begin
  p:=a;a:=b;b:=p;
end;

procedure SwapCols(J, K : Integer; A : matriceE; Lbound, Ubound : Integer);
var
  I : Integer;
begin
  for I := Lbound to Ubound do
    Swap(A.x[I,J], A.x[I,K]);
end;

procedure SwapRows(I, K : Integer; A : matriceE; Lbound, Ubound : Integer);
var
  J : Integer;
begin
  for J := Lbound to Ubound do
    Swap(A.x[I,J], A.x[K,J]);
end;

function Det(A : matriceE) : extended;
const
  MACHEP=1E-1000;
var
  Lbound,Ubound : integer;
  I, J, K    : Integer;     { Loop variables }
  Ik, Jk     : Integer;     { Pivot coordinates }
  Pvt        : extended;       { Pivot }
  T          : extended;       { Auxiliary variable }
  PRow, PCol : vecteurI;  { Store line and column of pivot }
  MCol       : vecteurF;     { Stores a column of the matrix }
  D          : extended;       { Determinant }
begin
  Lbound:=0;Ubound:=high(A.x);
  setlength(PRow, succ(Ubound));
  setlength(PCol, succ(Ubound));
  setlength(Mcol, succ(Ubound));

  D := 1.0;
  K := Lbound;
  while K <= Ubound do
    begin
      { Search for largest pivot in submatrix A[K..Ubound, K..Ubound] }
      Pvt := A.x[K,K];
      Ik := K;
      Jk := K;
      for I := K to Ubound do
        for J := K to Ubound do
          if Abs(A.x[I,J]) > Abs(Pvt) then
            begin
              Pvt := A.x[I,J];
              Ik := I;
              Jk := J;
            end;

      { Pivot too small ==> quasi-singular matrix }
      if Abs(Pvt) < MACHEP then
        begin
          Det := 0.0;
          Exit;
        end;

      { Save pivot position }
      PRow[K] := Ik;
      PCol[K] := Jk;

      { Update determinant }
      D := D * Pvt;
      if Ik <> K then D := - D;
      if Jk <> K then D := - D;

      { Exchange current row (K) with pivot row (Ik) }
      if Ik <> K then
        SwapRows(Ik, K, A, Lbound, Ubound);

      { Exchange current column (K) with pivot column (Jk) }
      if Jk <> K then
        SwapCols(Jk, K, A, Lbound, Ubound);

      { Store col. K of A into MCol and set this col. to 0 }
      for I := Lbound to Ubound do
        if I <> K then
          begin
            MCol[I] := A.x[I, K];
            A.x[I, K] := 0.0;
          end
        else
          begin
            MCol[I] := 0.0;
            A.x[I, K] := 1.0;
          end;

      { Transform pivot row }
      for J := Lbound to Ubound do
        A.x[K,J] := A.x[K,J] / Pvt;

      { Transform other rows }
      for I := Lbound to Ubound do
        if I <> K then
          begin
            T := MCol[I];
            for J := Lbound to Ubound do
              A.x[I,J] := A.x[I,J] - T * A.x[K,J];
          end;
      Inc(K);
    end;

  Det := D;
end;

{function Jacobi2(var A,V,D : MatriceE):Integer;
//                  Tol : Float; V : TMatrix; Lambda : TVector) : Integer;
  const
    Tol=1E-100;
    SQRT2DIV2=0.70710678118654752440084436210485;
    MAT_NON_CONV=5;
    MaxIter=1000;
  var
    I, J, K, Im, Jm, Iter,Lbound,Ubound,n : Integer;
    B, C, C2, Na, Nd, P, Q, S, S2, R, T : Extended;
  begin
    Iter := 0;
    //Na := 0.0;
    Nd := 0.0;
    R := 0.0;
    Lbound:=0;Ubound:=high(A.x);n:=succ(Ubound);
    setlength(V.x,n,n);setlength(D.x,n,n);
    for I := Lbound to Ubound do
      begin
        V.x[I,I] := 1.0;
        Nd := Nd + Sqr(A.x[I,I]);
        if I <> Ubound then
          for J := Succ(I) to Ubound do
            begin
              R := R + Sqr(A.x[I,J]);
              V.x[I,J] := 0.0;
              V.x[J,I] := 0.0;
            end;
      end;

    Na := Nd + 2.0 * R;

    repeat
      R := 0.0;
      for I := Lbound to Pred(Ubound) do
        for J := Succ(I) to Ubound do
          begin
            T := Abs(A.x[I,J]);
            if T > R then
              begin
                R := T;
                Im := I;
                Jm := J;
              end;
          end;

      B := A.x[Im,Im] - A.x[Jm,Jm];
      if B = 0 then
        begin
          C := SQRT2DIV2;
          S := C * Sgn(A.x[Im,Jm]);
        end
      else
        begin
          P := 2.0 * A.x[Im,Jm] * Sgn(B);
          Q := Abs(B);
          R := Pythag(P, Q);
          C := Sqrt(0.5 * (1.0 + Q / R));
          S := 0.5 * P / (R * C);
        end;

      for K := Lbound to Ubound do
        begin
          R := V.x[K,Im];
          V.x[K,Im] := C * R + S * V.x[K,Jm];
          V.x[K,Jm] := C * V.x[K,Jm] - S * R;
        end;

      if Im <> Lbound then
        for K := Lbound to Pred(Im) do
          begin
            R := A.x[K,Im];
            A.x[K,Im] := C * R + S * A.x[K,Jm];
            A.x[K,Jm] := C * A.x[K,Jm] - S * R;
          end;

      if Jm <> Succ(Im) then
        for K := Succ(Im) to Pred(Jm) do
          begin
            R := A.x[Im,K];
            A.x[Im,K] := C * R + S * A.x[K,Jm];
            A.x[K,Jm] := C * A.x[K,Jm] - S * R;
          end;

      if Jm <> Ubound then
        for K := Succ(Jm) to Ubound do
          begin
            R := A.x[Im,K];
            A.x[Im,K] := C * R + S * A.x[Jm,K];
            A.x[Jm,K] := C * A.x[Jm,K] - S * R;
          end;

      Nd := Nd + 2.0 * Sqr(A.x[Im,Jm]);

      C2 := Sqr(C);
      S2 := Sqr(S);
      P := 2.0 * S * C * A.x[Im,Jm];
      R := A.x[Im,Im];
      A.x[Im,Im] := C2 * R + S2 * A.x[Jm,Jm] + P;
      A.x[Jm,Jm] := S2 * R + C2 * A.x[Jm,Jm] - P;
      A.x[Im,Jm] := 0.0;
      if (A.x[im,Im]<0)or(A.x[Jm,Jm]<0) then
        Iter:=Iter;
      Inc(Iter);
      if Iter > MaxIter then
        begin
          V.err := MAT_NON_CONV;
          Exit;
        end;
    until Abs(1.0 - Na / Nd) < Tol;

    }{ The diagonal terms of the transformed matrix are the eigenvalues }
    {for I := Lbound to Ubound do
      D.x[I,I] := A.x[I,I];

    }{ Sort eigenvalues and eigenvectors }
    {for I := Lbound to Pred(Ubound) do
      begin
        K := I;
        R := D.x[I,I];
        for J := Succ(I) to Ubound do
          if D.x[J,J] > R then
            begin
              K := J;
              R := D.x[J,J];
            end;
        Swap(D.x[I,I], D.x[K,K]);
        SwapCols(I, K, V, Lbound, Ubound);
      end;

    }{ Make sure that the first component of each eigenvector is > 0 }
    {for J := Lbound to Ubound do
      if V.x[Lbound, J] < 0.0 then
        begin
          for I := Lbound to Ubound do
            V.x[I,J] := - V.x[I,J];
        end;
}{     for J:=Lbound to Ubound do
       if D.x[J,J]<0.0 then
         begin
           D.x[J,J]:=abs(D.x[J,J]);
          for I := Lbound to Ubound do
            V.x[I,J] := - V.x[I,J];
         end;
 }
  {end; }

procedure jacobi3(var C,V,D:matriceE);
var
  i,j,iq,ip,n,nrot  :integer;
  tresh,theta,tau,t,sm,s,h,g,cc   :extended;
  b,z  :array of extended;

procedure rotate(var M:matriceE;i,j,k,l:integer);
begin
  g:=M.x[i,j];
  h:=M.x[k,l];
  M.x[i,j]:=g-s*(h+g*tau);
  M.x[k,l]:=h+s*(g-h*tau);
end;

begin
  n:=succ(high(C.x));
  setlength(b,n);setlength(z,n);setlength(V.x,n,n);setlength(D.x,n,n);V.err:=0;D.err:=0;
  for ip:=0 to pred(n) do
    begin
      for iq:=0 to pred(n) do begin V.x[ip,iq]:=0.0;D.x[ip,iq]:=0.0;end;
      b[ip]:=C.x[ip,ip];
      D.x[ip,ip]:=C.x[ip,ip];
      V.x[ip,ip]:=1.0;
      z[ip]:=0.0;
    end;
  nrot:=0;
  for i:=1 to 50 do
    begin
      sm:=0.0;
      for ip:=0 to n-2 do for iq:=succ(ip) to pred(n) do sm:=sm+abs(C.x[ip,iq]);
      if sm=0 then
        begin
          setlength(b,0);
          setlength(z,0);
          exit;
        end;
      if i<4 then tresh:=0.2*sm/sqr(n) else tresh:=0.0;
      for ip:=0 to n-2 do
        begin
          for iq:=succ(ip) to pred(n) do
            begin
              g:=100.0*abs(C.x[ip,iq]);

              if (i>4)and(abs(D.x[ip,ip]+g)=abs(D.x[ip,ip]))and(abs(D.x[iq,iq]+g)=abs(D.x[iq,iq])) then C.x[ip,iq]:=0.0
                else if abs(C.x[ip,iq])>tresh then
                  begin
                    h:=D.x[iq,iq]-D.x[ip,ip];
                    if abs(h)+g=abs(h) then t:=C.x[ip,iq]/h
                       else
                       begin
                         theta:=0.5*h/C.x[ip,iq];
                         t:=1.0/(abs(theta)+sqrt(1.0+sqr(theta)));
                         if theta<0.0 then t:=-t;
                       end;
                    cc:=1.0/sqrt(1.0+sqr(t));
                    s:=t*cc;
                    tau:=s/(1.0+cc);
                    h:=t*C.x[ip,iq];
                    z[ip]:=z[ip]-h;
                    z[iq]:=z[iq]+h;
                    D.x[ip,ip]:=D.x[ip,ip]-h;
                    D.x[iq,iq]:=D.x[iq,iq]+h;
                    C.x[ip,iq]:=0.0;
                    if ip>0 then for j:=0 to pred(ip) do rotate(C,j,ip,j,iq);
                    if pred(iq)>ip then for j:=succ(ip) to pred(iq) do rotate(C,ip,j,j,iq);
                    if pred(n)>iq then for j:=succ(iq) to pred(n) do rotate(C,ip,j,iq,j);
                    for j:=0 to pred(n) do rotate(V,j,ip,j,iq);
                    inc(nrot);
                  end;
            end;
        end;
      for ip:=0 to pred(n) do
        begin
          b[ip]:=b[ip]+z[ip];
          D.x[ip,ip]:=b[ip];
          {if D.x[ip,ip]<0 then
            z[ip]:=0.0;}
          z[ip]:=0.0;
        end;
    end;
  V.err:=nrot;
  D.err:=nrot;
end;

PROCEDURE jacobi_lib(VAR a: matriceE;n:integer; VAR d: vecteurF;
       VAR v: matriceE; VAR nrot: integer);
(* Programs using routine JACOBI must define the types
TYPE
   glnpnp = ARRAY [1..np,1..np] OF real;
   glnp = ARRAY [1..np] OF real;
where 'np by np' is the physical dimension of the array
a into which all arrays are loaded for analysis. *)
LABEL 99;
CONST
   nmax=100;
VAR
   j,iq,ip,i: integer;
   tresh,theta,tau,t,sm,s,h,g,c: extended;
   b,z: vecteurF;
BEGIN
  setlength(b,succ(n));setlength(z,succ(n));setlength(V.x,succ(n),succ(n));setlength(D,succ(n));V.err:=0;

   FOR ip := 1 TO n DO BEGIN
      FOR iq := 1 TO n DO BEGIN
         v.x[ip,iq] := 0.0
      END;
      v.x[ip,ip] := 1.0
   END;
   FOR ip := 1 TO n DO BEGIN
      b[ip] := a.x[ip,ip];
      d[ip] := b[ip];
      z[ip] := 0.0
   END;
   nrot := 0;
   FOR i := 1 TO 50 DO BEGIN
      sm := 0.0;
      FOR ip := 1 TO n-1 DO BEGIN
         FOR iq := ip+1 TO n DO BEGIN
            sm := sm+abs(a.x[ip,iq])
         END
      END;
      IF (sm = 0.0) THEN GOTO 99;
      IF (i < 4) THEN tresh := 0.2*sm/sqr(n)
      ELSE tresh := 0.0;
      FOR ip := 1 TO n-1 DO BEGIN
         FOR iq := ip+1 TO n DO BEGIN
            g := 100.0*abs(a.x[ip,iq]);
            IF ((i > 4) AND ((abs(d[ip])+g) = abs(d[ip]))
               AND ((abs(d[iq])+g) = abs(d[iq]))) THEN
               a.x[ip,iq] := 0.0
            ELSE IF (abs(a.x[ip,iq]) > tresh) THEN BEGIN
               h := d[iq]-d[ip];
               IF ((abs(h)+g) = abs(h)) THEN BEGIN
                  t := a.x[ip,iq]/h
               END ELSE BEGIN
                  theta := 0.5*h/a.x[ip,iq];
                  t := 1.0/(abs(theta)+sqrt(1.0+sqr(theta)));
                  IF (theta < 0.0) THEN t := -t
               END;
               c := 1.0/sqrt(1+sqr(t));
               s := t*c;
               tau := s/(1.0+c);
               h := t*a.x[ip,iq];
               z[ip] := z[ip]-h;
               z[iq] := z[iq]+h;
               d[ip] := d[ip]-h;
               d[iq] := d[iq]+h;
               a.x[ip,iq] := 0.0;
               FOR j := 1 TO ip-1 DO BEGIN
                  g := a.x[j,ip];
                  h := a.x[j,iq];
                  a.x[j,ip] := g-s*(h+g*tau);
                  a.x[j,iq] := h+s*(g-h*tau)
               END;
               FOR j := ip+1 TO iq-1 DO BEGIN
                  g := a.x[ip,j];
                  h := a.x[j,iq];
                  a.x[ip,j] := g-s*(h+g*tau);
                  a.x[j,iq] := h+s*(g-h*tau)
               END;
               FOR j := iq+1 TO n DO BEGIN
                  g := a.x[ip,j];
                  h := a.x[iq,j];
                  a.x[ip,j] := g-s*(h+g*tau);
                  a.x[iq,j] := h+s*(g-h*tau)
               END;
               FOR j := 1 TO n DO BEGIN
                  g := v.x[j,ip];
                  h := v.x[j,iq];
                  v.x[j,ip] := g-s*(h+g*tau);
                  v.x[j,iq] := h+s*(g-h*tau)
               END;
               nrot := nrot+1
            END
         END
      END
   END;
   FOR ip := 1 TO n DO BEGIN
      b[ip] := b[ip]+z[ip];
      d[ip] := b[ip];
      z[ip] := 0.0
   END;
   writeln('pause in routine JACOBI');
   writeln('50 iterations should not happen'); readln;
99:   END;

procedure jacobi(var C,V,D:matriceE);
var
  i,j  :integer;
  dim,nrot :integer;
  A,VV  :matriceE;
  DD  :vecteurF;
begin
   dim:=succ(high(C.x));
   setlength(A.x,succ(dim),succ(dim));setlength(DD,succ(dim));
   setlength(D.x,dim,dim);setlength(V.x,dim,dim);
   for i:=1 to dim do for j:=1 to dim do A.x[i,j]:=C.x[pred(i),pred(j)];
   jacobi_lib(A,dim,DD,VV,nrot);
   for i:=1 to dim do D.x[pred(i),pred(i)]:=DD[i];
   for i:=1 to dim do for j:=1 to dim do V.x[pred(i),pred(j)]:=VV.x[i,j];
end;

function Determinant(A:matriceE):extended;
var
  V,D:matriceE;
  det:extended;
  i  :integer;
begin
  jacobi(A,V,D);
  det:=1.0;
  for i:=0 to high(A.x) do det:=det*D.x[i,i];
  Result:=det;
end;

procedure ACP(X:matriceE;prop:extended;index:integer;var nlambda:integer;var lambda:vecteurF;var slambda:extended;var vectprop:matriceE;var princomp:matriceE;var moy,sd:vecteurF);
var
  i,j,k,nli,nco  :integer;
  matX,matXT,matM,valprop :matriceE;
  y:vecteurF;
  anli,piv,sl:extended;
begin
  nli:=succ(high(X.x));nco:=succ(high(X.x[0]));setlength(matX.x,nli,nco);
  setlength(matM.x,nco,nco);setlength(moy,nco);setlength(sd,nco);setlength(y,nli);
  setlength(valprop.x,nco,nco);
  anli:=1.0/nli;
  for j:=0 to pred(nco) do
    begin
      for i:=0 to pred(nli) do y[i]:=X.x[i,j];
      cal_moysdF(nli,y,moy[j],sd[j]);
      sd[j]:=sd[j]*sqrt(pred(nli)/nli);
    end;
  if index=0 then
    begin
      for i:=0 to pred(nli) do for j:=0 to pred(nco) do matX.x[i,j]:=(X.x[i,j]-moy[j])/sd[j];
    end
    else
    begin
      for i:=0 to pred(nli) do for j:=0 to pred(nco) do matX.x[i,j]:=(X.x[i,j]-moy[j]);
    end;
  matXT:=transp(matX);
  matM:=prodMs(prodM(matXT,matX),anli);
  jacobi(matM,vectprop,valprop);
  for i:=0 to nco-2 do for j:=succ(i) to pred(nco) do
    if valprop.x[i,i]<valprop.x[j,j] then
      begin
        piv:=valprop.x[i,i];valprop.x[i,i]:=valprop.x[j,j];valprop.x[j,j]:=piv;
        for k:=0 to pred(nco) do
          begin
            piv:=vectprop.x[k,i];vectprop.x[k,i]:=vectprop.x[k,j];vectprop.x[k,j]:=piv;
          end;
      end;
  slambda:=0.0;for i:=0 to pred(nco) do slambda:=slambda+valprop.x[i,i];
  nlambda:=1;sl:=valprop.x[0,0];
  while (sl/slambda)<prop do begin inc(nlambda);sl:=sl+valprop.x[pred(nlambda),pred(nlambda)];end;
  setlength(lambda,nlambda);
  for i:=0 to pred(nlambda) do lambda[i]:=valprop.x[i,i];
  setlength(vectprop.x,nco,nlambda);
  setlength(princomp.x,nli,nlambda);
  for i:=0 to pred(nli) do
    for j:=0 to pred(nlambda) do
      begin
        princomp.x[i,j]:=0.0;
        for k:=0 to pred(nco) do princomp.x[i,j]:=princomp.x[i,j]+matX.x[i,k]*vectprop.x[k,j];
      end;
end;

function plogit(beta:extended):extended;
begin
  if beta<-1000.0 then Result:=0.0 else
    if beta>1000.0 then Result:=1.0 else
      Result:=1.0/(1.0+exp(-beta));
end;

procedure remplimatX(nli,nco:integer;matX0:matriceE;var matX:matriceE);
var
  i,j  :integer;
begin
  setlength(matX.x,nli,succ(nco));
  for i:=0 to pred(nli) do
    begin
      matX.x[i,0]:=1.0;
      for j:=0 to pred(nco) do matX.x[i,succ(j)]:=matX0.x[i,j];
    end;
end;


procedure local_regression(matX0,matY:matriceE;vecW:vecteurF;var beta:matriceE);
                                                //matX0 variables prdictrices, matY variables dpendantes
                                                //vecW vecteur des poids ; beta matrice des coefficients de la rgression
var
  i,j,nli,nco :integer;
  matA,matB,matX,matXT,matAA :matriceE;
begin
  nli:=succ(high(matX0.x));nco:=succ(high(matX0.x[0]));
  remplimatX(nli,nco,matX0,matX);
  setlength(matXT.x,succ(nco),nli);
  setlength(matA.x,succ(nco),nli);
  setlength(matB.x,succ(nco),succ(nco));
  matXT:=transp(matX);
  for i:=0 to pred(nli) do
    for j:=0 to nco do matA.x[j,i]:=matXT.x[j,i]*vecW[i];
  matA.err:=0;matX.err:=0;
  matAA:=prodM(matA,matX);
  matB:=invM(matAA);
  beta:=prodM(prodM(matB,matA),matY);
end;

{procedure logistic_regression(matX0:matriceE;vecY,vecW:vecteurF;var beta:vecteurF;var px,pxi,pxs:extended);
//matX variables prdictrices, vecY vecteur de 1 (bon modle) et 0 (autre modle),
//vecW vecteur de poids beta : coeff de la rgression,
//px proba du modle (=invlogit(beta[0])) et pxi et pxs bornes inf et sup de l'intervalle de confiance  95% de px
var
  i,j,iscen,rep,nts,nli,nco  :integer;
  matA,matB,matX,matXT,matC,matD,bet0,bet,deltabet,matYP,matW,matP :matriceE;
  mP,sd,esd,einf,esup,smoyP,b0,xi,xs,sum,x,sx2,loglik,bx  :extended;
  fin :boolean;

procedure remplimatriceYP;
var
  i,j  :integer;
  betax,px : extended;
begin
  for i:=0 to pred(nli) do for j:=0 to pred(nli) do matW.x[i,j]:=0.0;
  for i:=0 to pred(nli) do
    begin
      betax:=0.0;
      for j:=0 to nco do betax:=betax+bet0.x[j,0]*matX.x[i,j];
      px:=plogit(betax);
      matP.x[i,0]:=px;
      matYP.x[i,0]:=(vecY[i]-px)*vecW[i];
      matW.x[i,i]:=px*(1.0-px)*vecW[i];
    end;
end;

begin
  nli:=succ(high(matX0.x));nco:=succ(high(matX0.x[0]));
  setlength(matP.x,nli,1);
  remplimatX(nli,nco,matX0,matX);
  setlength(bet0.x,succ(nco),1);
  setlength(bet.x,succ(nco),1);
  setlength(deltabet.x,succ(nco),1);
  setlength(matYP.x,nli,1);
  setlength(matXT.x,succ(nco),nli);
  matXT:=transp(matX);
  setlength(matW.x,nli,nli);
  setlength(matA.x,succ(nco),nli);
  setlength(matB.x,succ(nco),succ(nco));
  setlength(matC.x,succ(nco),succ(nco));
  setlength(matD.x,succ(nco),succ(nco));
  for j:=0 to nco do bet0.x[j,0]:=0.0;
  rep:=0;
  repeat
    inc(rep);
    remplimatriceYP; //matrice (y-p) + matrice W2
    matA:=prodM(matXT,matW);
    matC:=prodM(matA,matX); //(XTWX)
    matB:=invM(matC); //=(XT W X)^-1
    matD:=prodM(matB,matXT);        //= (XT W X)^-1 XT
    deltabet:=prodM(matD,matYP);      //= (XT W X)^-1 XT (Y-P)
    sx2:=0;for i:=0 to high(deltabet.x) do sx2:=sx2+sqr(deltabet.x[i,0]);
    bet:=sommeM(bet0,deltabet);
    fin:=(sqrt(sx2)<0.00000001);
    bet0:=copyM(bet);
  until fin;
  setlength(beta,succ(nco));for i:=0 to nco do beta[i]:=bet.x[i,0];
  px:=plogit(beta[0]);
  sd:=sqrt(matB.x[0,0]);
  pxi:=plogit(beta[0]-1.96*sd);
  pxs:=plogit(beta[0]+1.96*sd);
end;
}


procedure polytom_logistic_regression(matX0:matriceE;vecY,vecW:vecteurF;var px,pxi,pxs:vecteurF;var rep:integer);
//matX0 =matrice des predicteurs, vecY = numero du modle (0  pred(nmodel))
//vecW = pondrations des observations
//px,pxi et pxs = vecteur des proba et bornes inf et sup de leur intervalle de confiance
var
  i,j,l,m,n,iscen,nts,tic,nli,nco,nmodel,nlimod,nmodnco,imod  :integer;
  matA,matB,matX,matXT,matC,matD,deltabeta,matP,beta0,beta,matYP,matY :matriceE;
  mP,esd,einf,esup,smoyP,b0,xi,xs,sum,x,sx2,sx20  :extended;
  loglik,sd,bet :vecteurF;
  lambda:array of extended;
  fin,convergeOK :boolean;
  cov :matriceF;

procedure expbeta(b:vecteurF;var eb:vecteurF);
var
  mi,ma,s  :extended;
  i  :integer;
begin
  mi:=b[0];ma:=b[0];
  for i:=1 to high(b) do
    begin
      if mi>b[i] then mi:=b[i];
      if ma<b[i] then ma:=b[i];
    end;
  s:=0.0;
  for i:=0 to high(b) do
    begin
      if ma-b[i]>1000.0 then
        begin
          eb[i]:=0.0
        end else eb[i]:=exp(b[i]-ma);
      s:=s+eb[i];
    end;
  if s>0.0 then for i:=0 to high(b) do eb[i]:=eb[i]/s;
end;

procedure remplimatriceYP;
var
  i,j,imod  :integer;
  betax,ebetax :vecteurF;
begin
  setlength(matP.x,nli,nmodel);
  setlength(ebetax,succ(nmodel));setlength(betax,succ(nmodel));
  for i:=0 to pred(nli) do
    begin
      betax[nmodel]:=0.0;
      for imod:=0 to pred(nmodel) do
        begin
          betax[imod]:=0.0;
          for j:=0 to nco do betax[imod]:=betax[imod]+beta.x[imod*succ(nco)+j,0]*matX.x[i,j];
        end;
      expbeta(betax,ebetax);
      for imod:=0 to pred(nmodel) do matP.x[i,imod]:=ebetax[imod]{/sbetax};
    end;
  for i:=0 to high(matYP.x) do matYP.x[i,0]:=0.0;
  for imod:=0 to pred(nmodel) do
    begin
      for j:=0 to nco do
        begin
          for i:=0 to pred(nli) do
            begin
              matYP.x[imod*succ(nco)+j,0]:=matYP.x[imod*succ(nco)+j,0]+(matY.x[i,imod]-matP.x[i,imod])*matX.x[i,j]*vecW[i];
            end;
        end;
    end;
end;

function cal_loglik:boolean;
var
  i,imod  :integer;
  a,sy,sp       :extended;
begin
  setlength(loglik,rep);
  loglik[pred(rep)]:=0.0;
  for i:=0 to pred(nli) do
    begin
      a:=0.0;sy:=0.0;sp:=0.0;
      for imod:=0 to pred(nmodel) do
        begin
          if (matY.x[i,imod]>0.5) and (matP.x[i,imod]<=0.0) then begin Result:=false;exit;end;
          if matY.x[i,imod]>0.5 then a:=a+{matY.x[i,imod]*}ln(matP.x[i,imod]);
          sp:=sp+matP.x[i,imod];
          sy:=sy+matY.x[i,imod];
        end;
      if (sp>=1.0)and(sy<0.9) then begin Result:=false;exit;end;
      if sy<0.9 then a:=a+ln(1-sp); // ajout du modle cart
      loglik[pred(rep)]:=loglik[pred(rep)]+vecW[i]*a;
    end;
  Result:=true;
end;

procedure calcul_psd(nmo:integer;b0:vecteurF;matV:matriceE;var p,sd:vecteurF);
var
  imod,j,l :integer;
  mi,ma  :extended;
  vecD   :vecteurF;
begin
  setlength(vecD,nmo);
  mi:=b0[0];ma:=mi;
  if nmo>0 then for imod:=1 to nmo do
    begin
      if mi>bet[imod] then mi:=b0[imod];
      if ma<bet[imod] then ma:=b0[imod];
    end;
  if ma-mi<1000 then
    begin
      sum:=0.0;for imod:=0 to nmo do sum:=sum+exp(b0[imod]-ma);
      for imod:=1 to nmo do
        begin
          px[imod]:=exp(b0[imod]-ma)/sum;
          esd:=sqr(exp(0.5*(b0[imod]-ma))/sum);
          for j:=1 to nmo do if imod=j then vecD[pred(j)]:=esd*(sum-exp(b0[imod]-ma))
                                       else vecD[pred(j)]:=-esd*exp(b0[j]-ma);
          sd[imod]:=0;
          for j:=0 to pred(nmo) do for l:=0 to pred(nmo) do sd[imod]:=sd[imod]+matV.x[j,l]*vecD[j]*vecD[l];
          if sd[imod]>0.0 then sd[imod]:=sqrt(sd[imod]) else sd[imod]:=0.0;
        end;
      px[0]:=exp(b0[0]-ma)/sum;
      for j:=0 to pred(nmo) do vecD[j]:=-sqr(exp(0.5*b0[succ(j)]-ma)/sum);
      sd[0]:=0.0;for j:=0 to pred(nmo) do for l:=0 to pred(nmo) do sd[0]:=sd[0]+matV.x[j,l]*vecD[j]*vecD[l];
      if sd[0]>0.0 then sd[0]:=sqrt(sd[0]) else sd[0]:=0.0;
    end
    else
    begin
      sum:=0.0;for imod:=0 to nmo do if b0[imod]>ma-1000 then sum:=sum+exp(b0[imod]-ma);
      for imod:=1 to nmo do
        begin
          if b0[imod]>ma-1000 then
            begin
              px[imod]:=exp(b0[imod]-ma)/sum;
              esd:=sqr(exp(0.5*(b0[imod]-ma))/sum);
              for j:=1 to nmo do if imod=j then vecD[pred(j)]:=esd*(sum-exp(b0[imod]-ma))
                                           else if b0[j]>ma-1000 then vecD[pred(j)]:=-esd*exp(b0[j]-ma)
                                                               else vecD[pred(j)]:=0.0;
              sd[imod]:=0;
              for j:=0 to pred(nmo) do for l:=0 to pred(nmo) do sd[imod]:=sd[imod]+matV.x[j,l]*vecD[j]*vecD[l];
              if sd[imod]>0.0 then sd[imod]:=sqrt(sd[imod]) else sd[imod]:=0.0;
            end
            else
            begin
              px[imod]:=0.0;
              sd[imod]:=0.0;
            end;
        end;
      if b0[0]>ma-1000 then
        begin
          px[0]:=exp(b0[0]-ma)/sum;
          for j:=0 to pred(nmo) do if 0.5*b0[succ(j)]>ma-1000 then vecD[j]:=-sqr(exp(0.5*b0[succ(j)]-ma)/sum) else vecD[j]:=0.0;
          sd[0]:=0.0;for j:=0 to pred(nmo) do for l:=0 to pred(nmo) do sd[0]:=sd[0]+matV.x[j,l]*vecD[j]*vecD[l];
          if sd[0]>0.0 then sd[0]:=sqrt(sd[0]) else sd[0]:=0.0;
        end
        else
        begin
          px[0]:=0.0;
          sd[0]:=0.0;
        end;
    end;
end;

begin
//  polylogisticrep:=Tevent.Create(nil,true,false,'polylogrep');
//  polylogisticfin:=Tevent.Create(nil,true,false,'polylogfin');
  nli:=succ(high(matX0.x));nco:=succ(high(matX0.x[0]));
  remplimatX(nli,nco,matX0,matX);
  nmodel:=0;for i:=1 to high(vecY) do if vecY[i]>nmodel then nmodel:=round(vecY[i]);
  setlength(px,succ(nmodel));setlength(pxi,succ(nmodel));setlength(pxs,succ(nmodel));
  if nmodel<1 then begin px[0]:=1.0;pxi[0]:=1.0;pxs[0]:=1.0;exit;end;
  //nmodel est le nombre de modles moins un (le premier celui d'indice 0)
  nlimod:=nli*nmodel;
  setlength(matY.x,nli,nmodel);
  for imod:=1 to nmodel do for i:=0 to pred(nli) do if abs(vecY[i]-imod)<0.1 then matY.x[i,pred(imod)]:=1.0 else matY.x[i,pred(imod)]:=0.0;
  nmodnco:=nmodel*succ(nco);
  setlength(matXT.x,succ(nco),nli);
  matXT:=transp(matX);
  setlength(matYP.x,nmodnco,1);
  setlength(beta0.x,nmodnco,1);
  setlength(beta.x,nmodnco,1);
  setlength(deltabeta.x,nmodnco,1);
  setlength(matC.x,nmodnco,nmodnco);
  for i:=0 to pred(nmodnco) do for j:=0 to pred(nmodnco) do matC.x[i,j]:=0.0;
  for i:=0 to pred(nmodnco) do beta.x[i,0]:=0.0;beta0:=copyM(beta);
//  for i:=0 to pred(nmodnco) do matYP.x[i,0]:=0.0;
  setlength(matB.x,nmodnco,nmodnco);
  setlength(sd,succ(nmodel));
  rep:=0;fin:=false;
  repeat
    inc(rep);
    remplimatriceYP; //matrice (y-p)
    for i:=0 to high(matC.x) do for j:=0 to high(matC.x[0]) do matC.x[i,j]:=0;
    for m:=0 to pred(nmodel) do
      begin
        for n:=0 to pred(nmodel) do
          begin
            for j:=0 to nco do
              begin
                for l:=0 to nco do
                  begin
                    for i:=0 to pred(nli) do
                      begin
                        if m<>n then matC.x[m*succ(nco)+j,n*succ(nco)+l]:=matC.x[m*succ(nco)+j,n*succ(nco)+l]-vecW[i]*matP.x[i,m]*matP.x[i,n]*matX.x[i,j]*matX.x[i,l]
                                else matC.x[m*succ(nco)+j,n*succ(nco)+l]:=matC.x[m*succ(nco)+j,n*succ(nco)+l]+vecW[i]*matP.x[i,m]*(1-matP.x[i,m])*matX.x[i,j]*matX.x[i,l];
                      end;
                  end;
              end;
          end;
      end;
    matB:=invM(matC); //=(XT W X)^-1
    deltabeta:=prodM(matB,matYP);        //= (XT W X)^-1 XT
    beta:=sommeM(beta0,deltabeta);
    remplimatriceYP;
    if rep=1 then while (not cal_loglik) do begin deltabeta:=prodMs(deltabeta,0.5);beta:=sommeM(beta0,deltabeta);remplimatriceYP;end;
    if rep>1 then
      begin
        while (not cal_loglik)or (loglik[rep-1]<loglik[rep-2]-0.000001) do begin deltabeta:=prodMs(deltabeta,0.5);beta:=sommeM(beta0,deltabeta);remplimatriceYP;end;
        fin:=loglik[rep-1]-loglik[rep-2]<0.000001;
      end;
    beta0:=copyM(beta);
//    polylogisticrep.SetEvent;
  until fin;
//  polylogisticfin.SetEvent;
//  polylogisticrep.Destroy;
//  polylogisticfin.Destroy;
  setlength(matA.x,nmodel,nmodel);setlength(matD.x,nmodel,1);setlength(bet,succ(nmodel));
  for i:=0 to pred(nmodel) do for j:=0 to pred(nmodel) do matA.x[i,j]:=matB.x[i*succ(nco),j*succ(nco)];
  bet[0]:=0.0;for imod:=1 to nmodel do bet[imod]:=beta0.x[pred(imod)*succ(nco),0];
  calcul_psd(nmodel,bet,matA,px,sd);
  for imod:=0 to nmodel do
    begin
        pxi[imod]:=px[imod]-1.96*sd[imod];
        if pxi[imod]<0.0 then pxi[imod]:=0.0;
        pxs[imod]:=px[imod]+1.96*sd[imod];
        if pxs[imod]>1.0 then pxs[imod]:=1.0;
    end;
end;


function puissM(A:matriceE;exposant:extended):matriceE;
var
  i,n  :integer;
  V,D,C    :matriceE;
begin
  n:=succ(high(A.x));
  setlength(V.x,n,n);setlength(D.x,n,n);
  C:=copyM(A);
  jacobi(C,V,D);
  i:=-1;repeat inc(i);until (D.x[i,i]<0)or(i=pred(n));
  if D.x[i,i]<0 then C.err:=5;
  if C.err>0 then begin Result:=C;exit;end;
  for i:=0 to high(C.x) do D.x[i,i]:=exp(exposant*ln(abs(D.x[i,i])));
  C:=prodM(V,D);
  if C.err=0 then C:=prodM(C,transp(V));
  Result:=C;
end;

function gmnorm(nl:integer;mu:tenseurE;varcov:matriceE;var ldens:vecteurF;var GM:TMwcGen):matriceE;
var
  i,j,k,n  :integer;
  C,S,Invarcov    :matriceE;
  X      :vecteurF;
  lDetvarcov,Detvarcov,g,nl2pi  :extended;
  dif,A    :vecteurF;
begin
  n:=succ(high(varcov.x));
  nl2pi:=n*ln(2.0*PI);
  setlength(C.x,nl,n);setlength(X,n);setlength(S.x,n,n);
  setlength(ldens,nl);setlength(dif,n);setlength(A,n);
  S:=puissM(varcov,0.5); //S = matrice racine carre de varcov
  invarcov:=invM(varcov);
  Detvarcov:=Determinant(varcov);
  lDetvarcov:=ln(Detvarcov);
  for i:=0 to pred(nl) do
    begin
      for j:=0 to pred(n) do begin X[j]:=gnormal(GM);end;
      for j:=0 to pred(n) do
        begin
          dif[j]:=0.0;
          for k:=0 to pred(n) do dif[j]:=dif[j]+X[k]*S.x[j,k];
          C.x[i,j]:=mu[i].x[j,0]+dif[j];
        end;
      for j:=0 to pred(n) do
        begin
          A[j]:=0.0;
          for k:=0 to pred(n) do A[j]:=A[j]+dif[j]*invarcov.x[k,j];
        end;
      g:=0.0;for j:=0 to pred(n) do g:=g+A[j]*dif[j];
      ldens[i]:=-0.5*(nl2pi+lDetvarcov+g);
    end;
  C.err:=0;
  Result:=C;
end;

function lgamma(const xx:extended):extended;  //=log(gamma(xx))
const
  cof:array[0..5] of extended=(76.18009172947146,-86.50532032941677,
                               24.01409824083091,-1.231739572450155,
                                0.001208650973866179,-0.5395239384953E-5);
var
  x,y,tmp,ser:extended;
  j  :integer;
begin
  x:=xx;y:=xx;
  tmp:=x+5.5;
  tmp:=tmp-(x+0.5)*ln(tmp);
  ser:=1.000000000190015;
  for j:=0 to 5 do
    begin
      y:=y+1.0;
      ser:=ser+cof[j]/y;
    end;
   Result:=-tmp+ln(2.5066282746310005*ser/x);
end;

{function gmstudent(nl:integer;mu:tenseurE;varcov:matriceE;ddl:integer;var ldens:vecteurF):matriceE;
var
  i,j,k,n  :integer;
  C,S,Invarcov,D    :matriceE;
  X      :vecteurF;
  lDetvarcov,Detvarcov,g,nl2pi,lgnum,lgden,lc,z  :extended;
  dif,A    :vecteurF;
begin
  n:=succ(high(varcov.x));
  nl2pi:=0.5*n*ln(ddl*PI);
  setlength(C.x,nl,n);setlength(X,n);setlength(S.x,n,n);
  setlength(ldens,nl);setlength(dif,n);setlength(A,n);
  S:=puissM(varcov,0.5); //S = matrice racine carre de varcov
  invarcov:=invM(varcov);
  Detvarcov:=Determinant(varcov);
  lDetvarcov:=ln(Detvarcov);
  lgnum:=lgamma(0.5*(ddl+n));lgden:=lgamma(0.5*ddl);
  lc:=lgnum-0.5*lDetvarcov-nl2pi-lgden;
  for i:=0 to pred(nl) do
    begin
      for j:=0 to pred(n) do begin X[j]:=gnormal;end;
      z:=sqrt(gchi2(ddl)/ddl);
      for j:=0 to pred(n) do
        begin
          C.x[i,j]:=mu[i].x[j,0];
          for k:=0 to pred(n) do C.x[i,j]:=C.x[i,j]+X[k]*S.x[j,k];
          C.x[i,j]:=C.x[i,j]/z;
          dif[j]:=C.x[i,j]-mu[i].x[j,0];
        end;
      for j:=0 to pred(n) do
        begin
          A[j]:=0.0;
          for k:=0 to pred(n) do A[j]:=A[j]+dif[k]*invarcov.x[k,j];
        end;
      g:=0.0;for j:=0 to pred(n) do g:=g+A[j]*dif[j];
      if g/ddl<=-1 then
        halt;
      g:=ln(1.0+g/ddl);
      ldens[i]:=lc-0.5*(ddl+n)*g;
    end;
  C.err:=0;
  Result:=C;
end;}

function gmstudent(nl:integer;mu:matriceE;varcov:matriceE;ddl:integer;var ldens:vecteurF;var GM:TMwcGen):matriceE;
var
  i,j,k,n  :integer;
  C,S,scalmat,invscalmat    :matriceE;
  X      :vecteurF;
  lDetscalmat,Detscalmat,g,nl2pi,lgnum,lgden,lc,gc  :extended;
  dif,A    :vecteurF;
begin
  n:=succ(high(varcov.x));
  nl2pi:=0.5*n*ln(ddl*PI);
  setlength(C.x,nl,n);setlength(X,n);setlength(S.x,n,n);
  setlength(ldens,nl);setlength(dif,n);setlength(A,n);
  scalmat:= prodMs(varcov,1.0*(ddl-2)/ddl);
  S:=puissM(scalmat,0.5); //S = matrice racine carre de varcov
  invscalmat:=invM(scalmat);
  Detscalmat:=Determinant(scalmat);
  lDetscalmat:=ln(Detscalmat);
  lgnum:=lgamma(0.5*(ddl+n));lgden:=lgamma(0.5*ddl);
  lc:=lgnum-0.5*lDetscalmat-nl2pi-lgden;
  for i:=0 to pred(nl) do
    begin
      gc:=sqrt(gchi2(ddl,GM)/ddl);
      for j:=0 to pred(n) do begin X[j]:=gnormal(GM)/gc;end;
      for j:=0 to pred(n) do
        begin
          dif[j]:=0.0;
          for k:=0 to pred(n) do dif[j]:=dif[j]+X[k]*S.x[j,k];
          C.x[i,j]:=mu.x[i,j]+dif[j];
        end;
      for j:=0 to pred(n) do
        begin
          A[j]:=0.0;
          for k:=0 to pred(n) do A[j]:=A[j]+dif[k]*invscalmat.x[k,j];
        end;
      g:=0.0;for j:=0 to pred(n) do g:=g+A[j]*dif[j];
      if g/ddl<=-1 then
        halt;
      g:=ln(1.0+g/ddl);
      ldens[i]:=lc-0.5*(ddl+n)*g;
    end;
  C.err:=0;
  Result:=C;
end; 

function lmstudent_dens(x:vecteurF;mu:vecteurF;varcov:matriceE;ddl:integer):extended;
//varcov est la matrice de covariance empirique
var
  j,k,n  :integer;
  S,Invscalmat,scalmat    :matriceE;
  lDetscalmat,Detscalmat,g,nl2pi,lgnum,lgden,lc  :extended;
  dif,A    :vecteurF;
begin
  n:=succ(high(varcov.x));
  nl2pi:=0.5*n*ln(ddl*PI);
  setlength(S.x,n,n);
  setlength(dif,n);setlength(A,n);
  //S:=puissM(prodMs(varcov,1.0*(ddl-2)/ddl),0.5); //S = matrice racine carre de varcov
  scalmat:=prodMs(varcov,1.0*(ddl-2)/ddl);
  invscalmat:=invM(scalmat);
  Detscalmat:=Determinant(scalmat);
  lDetscalmat:=ln(Detscalmat);
  lgnum:=lgamma(0.5*(ddl+n));lgden:=lgamma(0.5*ddl);
  lc:=lgnum-0.5*lDetscalmat-nl2pi-lgden;
  for k:=0 to pred(n) do dif[k]:=x[k]-mu[k];
  for j:=0 to pred(n) do
    begin
      A[j]:=0.0;
      for k:=0 to pred(n) do A[j]:=A[j]+dif[k]*invscalmat.x[k,j];
    end;
  g:=0.0;for j:=0 to pred(n) do g:=g+A[j]*dif[j];
  if g/ddl<=-1 then
    halt;
      g:=ln(1.0+g/ddl);
  Result:=lc-0.5*(ddl+n)*g;
end;

function mnormal_kerdens(x,w:vecteurF;ech:matriceE;varcov:matriceE):extended;
//x vecteur dont on cherche la densit de probabilit
//ech matrice des chantillons utiliss pour calculer la kernel density
//w poids des chantillons
//varcov matrice de covariance utilise dans la multinormale
var
  kdens  :extended;
  i :integer;
begin
  kdens:=0.0;
  for i:=low(w) to high(w) do
    begin
      kdens:=kdens+w[i]*exp(lmnormal_dens(x,ech.x[i],varcov));
    end;
  Result:=kdens;
end;

function approxerf(x:extended):extended;
const
  p=0.2316419;
  b1=0.31938153;
  b2=-0.356563782;
  b3=1.781477937;
  b4=-1.821255978;
  b5=1.330274429;
  sqrt2PI=2.506628274631000502415765284811;
var
  t,t2,t3,t4,t5,r:extended;
begin
  if x=0.0 then begin Result:=0.5;exit;end;
  if abs(x)<2 then
    begin
      Result:=0.5+0.3989423*(x-x*x*x/6.0+x*x*x*x*x/40.0);
      exit;
    end;
  t:=1.0/(1.0+p*x);
  t2:=sqr(t);t3:=t2*t;t4:=sqr(t2);t5:=t4*t;
  r:=b1*t+b2*t2+b3*t3+b4*t4+b5*t5;
  Result:=1.0-exp(-0.5*sqr(x))*r/sqrt2PI;
  if (x>0)and(Result<0.5) then
     halt;
  if (x<0)and(Result>0.5) then
     halt;
end;

function pnorm5(x,mu,sigma:extended):extended;
const
  a:array[0..4] of extended =(2.2352520354606839287,161.02823106855587881,1067.6894854603709582,18154.981253343561249,0.065682337918207449113);
  b:array[0..3] of extended =(47.20258190468824187,976.09855173777669322,10260.932208618978205,45507.789335026729956);
  c:array[0..8] of extended =(0.39894151208813466764,8.8831497943883759412,93.506656132177855979,597.27027639480026226,2494.5375852903726711,
	         6848.1904505362823326,11602.651437647350124,9842.7148383839780218,1.0765576773720192317e-8);
  d:array[0..7] of extended =(22.266688044328115691,235.38790178262499861,1519.377599407554805,6485.558298266760755,18615.571640885098091,
                  34900.952721145977266,38912.003286093271411,19685.429676859990727);
  p:array[0..5] of extended =(0.21589853405795699,0.1274011611602473639,0.022235277870649807,0.001421619193227893466,2.9112874951168792e-5,0.02307344176494017303);
  q:array[0..4] of extended =(1.28426009614491121,0.468238212480865118,0.0659881378689285515,0.00378239633202758244,7.29751555083966205e-5);
  DBL_EPSILON=2.2204460492503131E-16;
  sqrt2PI=2.506628274631000502415765284811;
var
  pp,xden,xnum,temp,eps,xsq,y,cum,ccum :extended;
  i :integer;

procedure do_del(temp,x:extended;var cum,ccum:extended);
var
  xsq,del :extended;
begin
  xsq:=trunc(x*16)/16;
  del:=(x-xsq)*(x+xsq);
  cum:=exp(-0.5*xsq*xsq)*exp(-0.5*del)*temp;
  ccum:=1.0-cum;
end;


begin
  if sigma<=0 then begin if x<mu then Result:=0.0 else Result:=1.0;exit;end;
  pp:=(x - mu)/sigma;
  y:=abs(pp);
  eps:=DBL_EPSILON * 0.5;
  if y<=0.67448975 then
    begin
      if y>eps then
        begin
          xsq:=sqr(pp);
          xnum:=a[4]*xsq;
          xden:=xsq;
          for i:=0 to 2 do
            begin
              xnum:=(xnum + a[i])*xsq;
              xden:=(xden + b[i])*xsq;
            end;
        end else begin xnum:=0.0;xden:=0.0;end;
      temp:=pp*(xnum + a[3])/(xden + b[3]);
      cum:=0.5+temp;
    end
    else
    begin
      if y<=sqrt(32.0) then
        begin
          xnum:=c[8]*y;
          xden:=y;
          for i:=0 to 6 do
            begin
              xnum:=(xnum+c[i])*y;
              xden:=(xden+d[i])*y;
            end;
          temp:=(xnum+c[7])/(xden+d[7]);
          do_del(temp,y,cum,ccum);
          if pp>0.0 then begin temp:=cum;cum:=ccum;ccum:=temp;end;
        end
        else
        begin
          xsq:=1.0/sqr(pp);
          xnum:=p[5]*xsq;
          xden:=xsq;
          for i:=0 to 3 do
            begin
              xnum:=(xnum+p[i])*xsq;
              xden:=(xden+q[i])*xsq;
            end;
          temp:=xsq*(xnum+p[4])/(xden+q[4]);
          temp:=(1.0/sqrt2PI-temp)/y;
          do_del(temp,pp,cum,ccum);
          if pp>0.0 then begin temp:=cum;cum:=ccum;ccum:=temp;end;
        end;
    end;
  Result:=cum;
end;

function qnorm5(p,mu,sigma:extended):extended;
var
  q,r,val,a,b :extended;
begin
  if sigma<=0 then begin Result:=mu;exit;end;
  if p>0.5 then q:=0.5-(1.0-p) else q:=0.5-p;
  if abs(q)<0.425 then   //0.075 <= p <= 0.925
    begin
      r:=0.180625-q*q;
      a:=r * 2509.0809287301226727 + 33430.575583588128105;
      a:=a * r + 67265.770927008700853;
      a:=a * r + 45921.953931549871457;
      a:=a * r + 13731.693765509461125;
      a:=a * r + 1971.5909503065514427;
      a:=a * r + 133.14166789178437745;
      a:=a * r + 3.387132872796366608;
      b:=r * 5226.495278852854561 + 28729.085735721942674;
      b:=b * r + 39307.89580009271061;
      b:=b * r + 21213.794301586595867;
      b:=b * r + 5394.1960214247511077;
      b:=b * r + 687.1870074920579083;
      b:=b * r + 42.313330701600911252;
      b:=b * r + 1.0;
      val:=a/b;
    end
    else
    begin //p<0.075 ou p>0.975
      if p<0.075 then r:=p else r:=1.0-p;
      r:=sqrt(-ln(r));
      if r<=5.0 then
        begin
          r:=r-1.6;
          a:=r * 7.7454501427834140764e-4 + 0.0227238449892691845833;
          a:=a * r + 0.24178072517745061177;
          a:=a * r + 1.27045825245236838258;
          a:=a * r + 3.64784832476320460504;
          a:=a * r + 5.7694972214606914055;
          a:=a * r + 4.6303378461565452959;
          a:=a * r + 1.42343711074968357734;
          b:=r * 1.05075007164441684324e-9 + 5.475938084995344946e-4;
          b:=b * r + 0.0151986665636164571966;
          b:=b * r + 0.14810397642748007459;
          b:=b * r + 0.68976733498510000455;
          b:=b * r + 1.6763848301838038494;
          b:=b * r + 2.05319162663775882187;
          b:=b * r + 1.0;
          val:=a/b;
        end
        else
        begin
          r:=r-5.0;
          a:=r * 2.01033439929228813265e-7 + 2.71155556874348757815e-5;
          a:=a * r +  0.0012426609473880784386;
          a:=a * r +  0.026532189526576123093;
          a:=a * r +  0.29656057182850489123;
          a:=a * r +  1.7848265399172913358;
          a:=a * r +  5.4637849111641143699;
          a:=a * r +  6.6579046435011037772;
          b:=r * 2.04426310338993978564e-15 + 1.4215117583164458887e-7;
          b:=b * r + 1.8463183175100546818e-5;
          b:=b * r + 7.868691311456132591e-4;
          b:=b * r + 0.0148753612908506148525;
          b:=b * r + 0.13692988092273580531;
          b:=b * r + 0.59983220655588793769;
          b:=b * r + 1.0;
          val:=a/b;
        end;
      if q<0.0 then val:=-val;
    end;
  Result:=mu+sigma*val;
end;

function invCumNorm(const p: double): double;
// function obtained from P. J. Acklam,
// http://home.online.no/~pjacklam/notes/invnorm/index.html
const a: array[1..6] of double=(

-3.969683028665376e+01,
  2.209460984245205e+02,
 -2.759285104469687e+02,
  1.383577518672690e+02,
-3.066479806614716e+01,
 2.506628277459239e+00 );

const b: array[1..5] of double =(

 -5.447609879822406e+01,
 1.615858368580409e+02,
 -1.556989798598866e+02,
  6.680131188771972e+01,
 -1.328068155288572e+01  );

const c: array[1..6] of double=(

 -7.784894002430293e-03,
 -3.223964580411365e-01,
 -2.400758277161838e+00,
 -2.549732539343734e+00,
  4.374664141464968e+00,
  2.938163982698783e+00  );

const d: array[1..4] of double=(
 7.784695709041462e-03,
 3.224671290700398e-01,
 2.445134137142996e+00,
 3.754408661907416e+00 );

//Define break-points.

const p_low = 0.02425;
const p_high = 1 - p_low ;
//const infinity=1.7E308; // maximum size of double
var q,r: extended;

   begin
   result:=0.0;
   if ((p<=0) or (p>=1)) then halt; //raise Einvalidargument.create('Inverse Cum Norm argument must be in range 0<p<1');

   //Rational approximation for lower region.
   if ((0 < p) and  (p< p_low)) then begin
      q := sqrt(-2*ln(p));
      result := (((((c[1]*q+c[2])*q+c[3])*q+c[4])*q+c[5])*q+c[6]) /
         ((((d[1]*q+d[2])*q+d[3])*q+d[4])*q+1);
   end;

  //Rational approximation for central region.
  if (p_low <= p) and (p <= p_high ) then begin
      q := p - 0.5 ;
      r := q*q ;
      result := (((((a[1]*r+a[2])*r+a[3])*r+a[4])*r+a[5])*r+a[6])*q /
        (((((b[1]*r+b[2])*r+b[3])*r+b[4])*r+b[5])*r+1) ;
   end;

   //Rational approximation for upper region.
   if ((p_high < p) and (p < 1))  then begin
      q := sqrt(-2*ln(1-p));
      result := -(((((c[1]*q+c[2])*q+c[3])*q+c[4])*q+c[5])*q+c[6]) /
          ((((d[1]*q+d[2])*q+d[3])*q+d[4])*q+1)  ;
   end;
end;




{function ldmnorm(X:matriceE;mu:vecteurF;varcov:matriceE):vecteurF;
var
  i,j,k,n,nl  :integer;
  p,coef           :extended;
  invarcov,A,B         :matriceE;
  C                  :vecteurF;
begin
  nl:=succ(high(X.x));n:=succ(high(varcov.x));
  p:=0;
  invarcov:=invM(varcov);setlength(A.x,1,n);setlength(C,nl);
  setlength(B.x,1,1);
  coef:=n*ln(2*PI)+ln(det(varcov));
  for i:=0 to pred(nl) do
    begin
      for j:=0 to pred(n) do A.x[0,j]:=X.x[i,j]-mu[j];
      B:=prodM(prodM(A,invarcov),transp(A));
      C[i]:=-0.5*(coef+B.x[0,0]);
    end;
    Result:=C;
end;}
{function gbeta(a,b:double):double;
var
  x,y,r,s,la,u,m,u1,u2 :double;
begin
  if (a<1)and(b<1) then
  begin      //Johnk's beta generator, Devroye p 418)
    repeat
      x:=exp(ln(random)/a);
      y:=exp(ln(random)/b);
    until x+y<=1.0;
    r:=x/(x+y);
  end
  else
  begin     //Cheng's rejection algorithm BA, 1978, Devroye p438
    s:=a+b;
    m:=a;if m>b then m:=b;
    if m<=1 then la:=m else la:=sqrt((2*a*b-s)/(s-2.0));
    u:=a+la;
    repeat
      u1:=random;u2:=Gen.rnd;
      x:=u1/la/(1-u1);
      y:=a*exp(x);
    until s*ln(s/(b+y))+u*x-ln(4)>=2*ln(u1)+ln(u2);
    r:=y/(b+y);
  end;
  gbeta:=r;
end;
}

function lcomb(n,m:integer):extended;
var
  c :extended;
  ii  :integer;
begin
  c:=0;
  if m>0 then for ii:=1 to m do c:=c+ln(succ(n-ii)/ii);
  Result:=c;
end;

function lprob_hypergeom(d:integer;n,m:vecteurI):extended;
var
  i,nn,mm  :integer;
  num,den  :extended;
begin
  nn:=0;mm:=0;num:=0.0;
  for i:=0 to pred(d) do
    begin
      if n[i]>0 then num:=num+lcomb(n[i],m[i]);
      inc(nn,n[i]);inc(mm,m[i]);
    end;
  den:=lcomb(nn,mm);
  Result:=num-den;
end;

function lgamma_dens(const x,b,c:extended):extended;
begin
  Result:=(c-1)*ln(x/b)-x/b-ln(b)-lgamma(c);
end;

function lbeta(a,b:extended):extended;
begin
  Result:=lgamma(a)+lgamma(b)-lgamma(a+b);
end;

function lbeta_dens(x,a,b:extended):extended;
begin
  Result:=(a-1)*ln(x)+(b-1)*ln(1-x)-lbeta(a,b);
end;

function lbinom_dens(m,n:integer;p:extended):extended;
begin
  Result:=lgamma(n+1)-lgamma(n-m+1)-lgamma(m+1)+m*ln(p)+(n-m)*ln(1.0-p);
end;

function lgamma_dens2(const x,mean,sd:extended):extended;
var
  shape,scale  :double;
begin
  shape:=sqr(mean/sd);  //correspond  c
  scale:=sqr(sd)/mean;  //correspond  b
  Result:=lgamma_dens(x,scale,shape);
end;

function lnormal_dens(const x,m,s:extended):extended;//log(densite(normale(moyenne,sd))
begin
//  try
  Result:=-0.5*sqr((x-m)/s)-ln(s)-0.5*ln(2*PI);
{  except on EOverflow do
    begin
      writeln;
      writeln('OVERFLOW dans lnormal_dens');
      readln;
    end;
  end;}
end;

function lmnormal_dens(X:vecteurF;M:vecteurF;V:matriceE):extended;
var
  n,i,j  :integer;
  D,A  :vecteurF;
  InvV:matriceE;
  g :extended;
begin
  n:=succ(high(V.x));
  setlength(D,n);setlength(A,n);
  InvV:=invM(V);
  for i:=0 to pred(n) do D[i]:=X[i]-M[i];
  for i:=0 to pred(n) do
    begin
      A[i]:=0.0;
      for j:=0 to pred(n) do A[i]:=A[i]+D[j]*invV.x[j,i];
    end;
  g:=0;for i:=0 to pred(n) do g:=g+A[i]*D[i];
  Result:=-0.5*n*ln(2*PI)-0.5*ln(Determinant(V))-0.5*g;
end;

procedure kernel_norm_dens(x,w:vecteurF;npoints:integer;mini,maxi,h:extended;var v,d:vecteurF);
var
  sx,sx2,sd,s,e  :extended;
  i,j,n        :integer;
begin
  setlength(v,npoints);setlength(d,npoints);
  e:=(maxi-mini)/pred(npoints);
  sx:=0.0;sx2:=0.0;
  n:=succ(high(x)-low(x));
  for i:=low(x) to high(x) do begin sx:=sx+x[i];sx2:=sx2+sqr(x[i]);end;
  sd:=h*sqrt((sx2-sqr(sx)/n)/pred(n));
  s:=0.0;
  for i:=0 to pred(npoints) do
    begin
      v[i]:=mini+e*i;
      d[i]:=0.0;
      for j:=0 to pred(n) do d[i]:=d[i]+w[j]*exp(lnormal_dens(v[i],x[j],sd));
      s:=s+d[i]{*e};  //si on multiplie par e, la surface est gale  1, sinon, c'est la somme des d qui est gale  1
    end;
  for i:=0 to pred(npoints) do d[i]:=d[i]/s;
end;

function lognorm_dens(const x,m,s:extended):extended; //=ln(densite(lognormale(mediane,sd de log(x)))
begin
  if (m<=0)or(x<=0)or(s<=0) then
    halt;
  Result:=-sqr(ln(x/m))/sqr(s)/2-ln(x*s)-0.5*ln(2*PI);
end;

function lognorm_dens2(const x,mu,s:extended):extended; //=ln(densite(lognormale(moyenne de log(x),sd de log(x)))
begin
  if (mu<=0)or(x<=0)or(s<=0) then
    halt;
  Result:=-sqr(ln(x)-mu)/sqr(s)/2-ln(x*s)-0.5*ln(2*PI);
end;

function ldiri_dens(const n :integer;const alpha,x:vecteurd):extended;
var
  s,c :extended;
  j   :integer;
begin
  s:=0.0;
  c:=0.0;
  for j:=0 to pred(n) do
    begin
      s:=s+(alpha[j]-1.0)*ln(x[j]);
      s:=s-lgamma(alpha[j]);
      c:=c+alpha[j];
    end;
  Result:=s+lgamma(c);  
end;

function lpoisson_dens(x:integer;lambda:extended):extended;
begin
  Result:=x*ln(lambda)-lambda-lgamma(x+1.0);
end;

function lpoisson_tronquee_dens(x:integer;lambda:extended;xmin,xmax:integer):extended;
var
  den :extended;
  i   :integer;
begin
  den:=0.0;
  for i:=xmin to xmax do den:=den+exp(lpoisson_dens(i,lambda));
  Result:=lpoisson_dens(x,lambda)-ln(den);
end;
function gbinomiale(n:cardinal;p:double;var GM:TMwcGen):cardinal;  {Knuth 1981, Robert 1992 p 349}
var
  i,x  :cardinal;
begin
  x:=0;
  for i:=1 to n do if Rand(GM)<p then inc(x);
  Result:=x;
end;

function gmultinomiale(const n,d:cardinal;const p:array of double;var GM:TMwcGen):vecteurc;
var
  x    :vecteurc;
  i    :cardinal;
  j    :integer;
  r,s  :double;
begin
  setlength(x,d);
  for i:=0 to pred(d) do x[i]:=0;
  for i:=1 to n do
    begin
      j:=-1;
      s:=0;
      r:=Rand(GM);
      repeat
        inc(j);
        s:=s+p[j];
      until s>=r;
      inc(x[j]);
    end;
  gmultinomiale:=x;
end;

function gnormal(var GM:TMwcGen):double;  //normale(0,1)
var
  u1,u2,c,d  :double;
begin
  repeat u1:=Rand(GM) until u1>0;
  u2:=Rand(GM);
  c:=sqrt(-2.0*ln(u1));
  d:=2*PI*u2;
  if Rand(GM)<0.5 then Result:=c*cos(d) else Result:=c*sin(d);
end;


function gnorm(const mu,sigma:double;var GM:TMwcGen):double;
begin
  Result:=mu+sigma*gnormal(GM);
end;

function glognorm(const logmu,logsigma:double;var GM:TMwcGen):double;
begin
  Result:=exp(gnorm(logmu,logsigma,GM));
end;

procedure lognorm_dev(const x:extended;scale2:extended;var rt:extended;var y:extended;var GM:TMwcGen);
var
  dd  :extended;
begin
  dd:=gnormal(GM)*scale2;
  y:=x*exp(dd);
  rt:=rt+dd;
end;

function gunif(const min,max:double;var GM:TMwcGen):double;
begin
  Result:=min+(max-min)*Rand(GM);
end;

function glogunif(const logmin,logmax:double;var GM:TMwcGen):double;
begin
  Result:=exp(logmin+(logmax-logmin)*Rand(GM));
end;

function sexp(var GM:TMwcGen):double;
var
  q :array[0..15] of double;
  a,u,ustar,umin,se  :double;
  i                  :integer;
  fin                :boolean;
begin
  q[0]:=0.6931471805599453;
  q[1]:=0.9333736875190459;
  q[2]:=0.9888777961838675;
  q[3]:=0.9984959252914960;
  q[4]:=0.9998292811061389;
  q[5]:=0.9999833164100727;
  q[6]:=0.9999985691438767;
  q[7]:=0.9999998906925558;
  q[8]:=0.9999999924734159;
  q[9]:=0.9999999995283275;
  q[10]:=0.9999999999728814;
  q[11]:=0.9999999999985598;
  q[12]:=0.9999999999999289;
  q[13]:=0.9999999999999968;
  q[14]:=0.9999999999999999;
  q[15]:=1.0000000000000000;
  //se:=0.0;
  a := 0.0;
  repeat u := Rand(GM) until u>0.0;
  //fin:=false;
  repeat
    u := u + u;
    fin:= (u > 1.0);
    if not fin then a := a + q[0];
  until fin;
  u := u - 1.0;
  if (u <= q[0]) then se:= a + u
    else
    begin
      i := 0;
      ustar := Rand(GM);
      umin := ustar;
      while (u > q[i]) do
        begin
          ustar := Rand(GM);
          if (ustar < umin) then umin := ustar;
	  inc(i);
        end;
      se:= a + umin * q[0];
    end;
  Result:=se;
end;

{function ggamma(shape,rate:double;var GM:TMwcGen):double;
const
  a1 = 0.3333333;
  a2 = -0.250003;
  a3 = 0.2000062;
  a4 = -0.1662921;
  a5 = 0.1423657;
  a6 = -0.1367177;
  a7 = 0.1233795;
  e1 = 1.0;
  e2 = 0.4999897;
  e3 = 0.166829;
  e4 = 0.0407753;
  e5 = 0.010293;
  q1 = 0.04166669;
  q2 = 0.02083148;
  q3 = 0.00801191;
  q4 = 0.00144121;
  q5 = -7.388e-5;
  q6 = 2.4511e-4;
  q7 = 2.424e-4;
  sqrt32 = 5.656854;
var
  e,p,q,r,t,u,v,w,x   :double;
  ret_val                   :double;
  fin                                :boolean;
label RETOUR;
begin
  if (shape < 1.0) then
    begin
      // alternate method for parameters a below 1
      // 0.36787944117144232159 = exp(-1)
      aa := 0.0;
      b := 1.0 + 0.36787944117144232159 * shape;
      //fin:=false;
      repeat
	p := b * Rand(GM);
        if (p >= 1.0) then
          begin
            ret_val := -ln((b - p) / shape);
            fin:=(sexp(GM) >= (1.0 - shape) * ln(ret_val));
          end
          else
	  begin
            if p>0.0 then ret_val := exp(ln(p) / shape) else ret_val:=0.0;
            fin:=(sexp(GM) >= ret_val);
          end;
      until fin;
      ret_val:= ret_val/rate; // scale *
      GOTO RETOUR;
    end;
	// Step 1: Recalculations of s2, s, d if shape has changed */
    if (shape <> aa) then
      begin
        aa := shape;
        s2 := shape - 0.5;
        s  := sqrt(s2);
        d  := sqrt32 - s * 12.0;
      end;

	// Step 2: t = standard normal deviate, */
	// x = (s,1/2)-normal deviate. */
	// immediate acceptance (i) */
      t := gnormal(GM);
      x := s + 0.5 * t;
      ret_val := x * x;
      if (t >= 0.0) then
        begin
          ret_val:=ret_val/rate; //scale *
          GOTO RETOUR;
        end;

	// Step 3: u = 0,1 - uniform sample. squeeze acceptance (s) */
      u := Rand(GM);
      if (d * u <= t * t * t) then
        begin
          ret_val:=ret_val/rate; //scale *
          GOTO RETOUR;
        end;

	// Step 4: recalculations of q0, b, si, c if necessary */
      if (shape <> aaa) then
        begin
          aaa := shape;
          r   := 1.0 / shape;
          q0  := ((((((q7*r + q6)*r + q5)*r + q4)*r + q3)*r + q2)*r + q1)*r;

          // Approximation depending on size of parameter shape */
          // The constants in the expressions for b, si and */
          // c were established by numerical experiments */

          if (shape <= 3.686) then
            begin
              b := 0.463 + s + 0.178 * s2;
              si:= 1.235;
              c := 0.195 / s - 0.079 + 0.16 * s;
	    end
            else if (shape <= 13.022) then
              begin
                b := 1.654 + 0.0076 * s2;
                si:= 1.68 / s + 0.275;
                c := 0.062 / s + 0.024;
	      end
              else
              begin
                b := 1.77;
                si:= 0.75;
                c := 0.1515 / s;
	      end;
	end;
	// Step 5: no quotient test if x not positive */

	if (x > 0.0) then
          begin
	    // Step 6: calculation of v and quotient q */
            v := t / (s + s);
            if (abs(v) <= 0.25)
              then q:=q0+0.5*t*t*((((((a7*v+a6)*v+a5)*v+a4)*v+a3)*v+a2)*v+a1)* v
              else
              begin
              if 1.0+v<=0 then
                 halt;
                q:=q0-s*t+0.25*t*t+(s2+s2)*ln(1.0+v);
              end;
		// Step 7: quotient acceptance (q) */
            if (ln(1.0 - u) <= q) then
              begin
                ret_val:=ret_val/rate;  //scale *
                goto RETOUR;
              end;
	  end;

	// Step 8: e = standard exponential deviate */
	// u= 0,1 -uniform deviate */
	// t=(b,si)-double exponential (laplace) sample */
        fin:=false;
	repeat
          e := sexp(GM);
          u := Rand(GM);
          u := u + u - 1.0;
          if (u < 0.0) then t := b - si * e
		       else t := b + si * e;
          // Step  9:  rejection if t < tau(1) = -0.71874483771719 */
          if (t >= -0.71874483771719) then
            begin
              // Step 10:  calculation of v and quotient q */
              v := t / (s + s);
              if (abs(v) <= 0.25)
		 then q:=q0+0.5*t*t*((((((a7*v+a6)*v+a5)*v+a4)*v+a3)*v+a2)*v+a1)*v
                 else q:=q0-s*t+0.25*t*t+(s2+s2)*ln(1.0+v);
                 // Step 11:  hat acceptance (h) */
                 // (if q not positive go to step 8) */
              if (q > 0.0) then
                begin
                  if (q <= 0.5)
                     then w:=((((e5*q+e4)*q+e3)*q+e2)*q+e1)*q
                     else w:= exp(q) - 1.0;
                     // if t is rejected */
                     // sample again at step 8 */
                     fin:= (c*abs(u)<=w*exp(e- 0.5*t*t))
                end;
            end;
	until fin;
	x:= s + 0.5*t;
	ret_val:=  x * x/rate; // *scale
  RETOUR:
    Result:=ret_val;
end;}

function ggamma(shape,rate:double;var GM:TMwcGen):double;
const
  log4= 1.3862943611198906188344642429164;
  sg_magic=2.5040773967762740733732583523869;
  e=2.7182818284590452353602874713527;
var
  alpha,beta,ainv,bbb,ccc,u1,u2,v,x,z,r  :double;
  fin  :boolean;
  flog  :textfile;
begin
//  assignfile(flog,'gamma.log');rewrite(flog);
//  writeln(flog,'debut alpha=',alpha:12:6,'   beta=',beta:12:6);flush(flog);
  alpha:=shape;
  beta:=1.0/rate;
  if alpha>1.0 then
    begin
      ainv:=sqrt(2.0*alpha-1.0);
      bbb:=alpha-log4;
      ccc:=alpha+ainv;
      fin:=false;
      while not fin do
        begin
          repeat u1:=Rand(GM); until (u1>1E-7)and(u1<0.999999);
          u2:=1.0-Rand(GM);
          v:=ln(u1/(1.0-u1))/ainv;
          x:=alpha*exp(v);
          z:=u1*u1*u2;
          r:=bbb+ccc*v-x;
          if (r+sg_magic-4.5*z>=0)or(r>=ln(z)) then fin:=true;
        end;
      Result:=x*beta;
      exit;
    end;
  if alpha=1.0 then
    begin
      repeat u1:=Rand(GM) until u1>1E-7;
      Result:=-ln(u1)*beta;
      exit;
    end;
  if alpha<1.0 then
    begin
//      writeln(flog,'alpha=',alpha:12:6);flush(flog);
      fin:=false;
      while not fin do
        begin
          u2:=Rand(GM);
          bbb:=(e+alpha)/e;
          v:=bbb*u2;
          if v<=1.0 then x:=exp((1.0/alpha)*ln(v))
                    else x:=-ln((bbb-v)/alpha);
          u1:=Rand(GM);
//          writeln(flog,'x=',x:12:6);flush(flog);
          if v>1.0 then
             begin
               if x<=0.0 then
                  halt;
               if u1<=exp((alpha-1.0)*ln(x)) then fin:=true;
             end
             else
             begin
               if u1<=exp(-x) then fin:=true;
             end;
        end;
      Result:=x*beta;
//      closefile(flog);
    end;
end;

function ggamma2(mean,sd:double;var GM:TMwcGen):double;
var
  shape,rate  :double;
begin
  if sd<=0.0 then begin Result:=-1;exit;end;
  shape:=sqr(mean/sd);
  rate:=mean/sqr(sd);
  Result:=ggamma(shape,rate,GM);;
end;

function ggamma3(mean,shape:double;var GM:TMwcGen):double;
var
  sd :double;
begin
  if shape=0.0 then begin Result:=1.0;exit;end;
  sd:=mean/sqrt(shape);
  Result:=ggamma2(mean,sd,GM);
end;

function gdirichlet(const d:cardinal;const lambda:vecteurd;var GM:TMwcGen):vecteurd;
var
  x :vecteurd;
  i  :integer;
  s  :double;
begin
  setlength(x,d);
  s:=0.0;
  for i:=0 to pred(d) do
    begin
      x[i]:=ggamma(lambda[i],1.0,GM);
      s:=s+x[i];
    end;
  for i:=0 to pred(d) do x[i]:=x[i]/s;
  Result:=x;
end;

function gchi2(nu:cardinal;var GM:TMwcGen):double;
begin
  Result:=ggamma(0.5*nu,0.5,GM);
end;

function gbeta(a,b:double;var GM:TMwcGen):double;
var
  y1,y2  :double;
begin
  repeat y1:=ggamma(a,1,GM) until y1>0.0;
  y2:=ggamma(b,1,GM);
  Result:=y1/(y1+y2);
end;

function gstudent(nu:cardinal;mu,sigma:double;var GM:TMwcGen):double;
var
  x,y  :double;
begin
  x:=gnorm(0.0,sigma,GM);
  y:=gchi2(nu,GM)/nu;
  Result:=mu+x/sqrt(y);
end;

function gfisher(n,m:cardinal;var GM:TMwcGen):double;
begin
  gfisher:=sqr(gstudent(m,0.0,1.0,GM))/n;
end;

function gpoisson(lambda:double;var GM:TMwcGen):integer;
var
  i  :integer;
  ra,p:double;
begin
  i:=0;p:=0.0;
  repeat
    inc(i);
    repeat ra:=Rand(GM) until ra>0.0;
    p:=p-ln(ra);
  until p>lambda;
  Result:=pred(i);
end;

function gpoisson_tronquee(lambda:double;min,max:integer;var GM:TMwcGen):integer;
var
  i  :integer;
begin
  repeat i:=gpoisson(lambda,GM) until (i>=min)and(i<=max);
  Result:=i;
end;

function comb(n,m:integer):extended;
  var
    c  :extended;
    ii :integer;
  begin
    c:=1;
    if m>0 then
      begin
        for ii:=1 to m do c:=c*(n+1-ii)/ii;
      end;
    comb:=c;
  end;

function prob_hypergeom(d:integer;n,m:vecteurI):double;
var
  i,nn,mm  :integer;
  num,den  :extended;
begin
  nn:=0;mm:=0;num:=1.0;
  for i:=0 to pred(d) do
    begin
      if n[i]>0 then num:=num*comb(n[i],m[i]);
      inc(nn,n[i]);inc(mm,m[i]);
    end;
  den:=comb(nn,mm);
  Result:=num/den;
end;

function cbindMV(M:matriceE;V:vecteurF):matriceE;
var
  i,j,nl,nc  :integer;
  R      :matriceE;
begin
  nl:=succ(high(M.x));if pred(nl)<>high(V) then begin R.err:=1;Result:=R;exit;end;
  nc:=succ(high(M.x[0]));
  setlength(R.x,nl,succ(nc));
  for i:=0 to pred(nl) do for j:=0 to pred(nc) do  R.x[i,j]:=M.x[i,j];
  for i:=0 to pred(nl) do R.x[i,nc]:=V[i];
  R.err:=0;
  Result:=R;
end;

function cbindVV(V1:vecteurF;V2:vecteurF):matriceE;
var
  i,nl  :integer;
  R      :matriceE;
begin
  nl:=succ(high(V1));if pred(nl)<>high(V2) then begin R.err:=1;Result:=R;exit;end;
  setlength(R.x,nl,2);
  for i:=0 to pred(nl) do begin  R.x[i,0]:=V1[i];R.x[i,1]:=V2[i];end;
  R.err:=0;
  Result:=R;
end;

function rbindMM(M1:matriceE;M2:matriceE):matriceE;
var
  i,j,nlt,d,nl1,nl2  :integer;
  R      :matriceE;
begin
  if high(M1.x[0])<>high(M2.x[0]) then begin R.err:=1;Result:=R;exit;end;
  nl1:=succ(high(M1.x));nl2:=succ(high(M2.x));
  nlt:=nl1+nl2;
  d:=succ(high(M1.x[0]));
  setlength(R.x,nlt,d);
  for i:=0 to pred(nlt) do
    begin
      if i<nl1 then for j:=0 to pred(d) do R.x[i,j]:=M1.x[i,j]
               else for j:=0 to pred(d) do R.x[i,j]:=M2.x[i-nl1,j];
    end;
  R.err:=0;
  Result:=R;  
end;

function rbindVV(V1:vecteurF;V2:vecteurF):vecteurF;
var
  i,nlt,nl1,nl2  :integer;
  R      :vecteurF;
begin
  nl1:=succ(high(V1));nl2:=succ(high(V2));
  nlt:=nl1+nl2;
  setlength(R,nlt);
  for i:=0 to pred(nlt) do
    begin
      if i<nl1 then  R[i]:=V1[i] else R[i]:=V2[i-nl1];
    end;
  Result:=R;
end;

procedure fsort(c:char;n:integer;x:vecteurF);
var
  i,j,h :integer;
  ascendant :boolean;
  xtmp:extended;
begin
  ascendant:=(c='a')or(c='A');
  h:=1;
  while (h<=n) do h:=succ(3*h);
  while h<>1 do
    begin
      h:=h div 3;
      for i:=h to pred(n) do
        begin
          xtmp:=x[i];
          j:=i;
          if ascendant then
            begin
              while x[j-h]>xtmp do
                begin
                  x[j]:=x[j-h];
                  j:=j-h;
                  if j<h then break;
                end;
            end
            else
            begin
              while x[j-h]<xtmp do
                begin
                  x[j]:=x[j-h];
                  j:=j-h;
                  if j<h then break;
                end;
            end;
           x[j]:=xtmp;
        end;
    end;
end;

procedure fsortV(c:char;n,m,index:integer;var x:matriceF);
//tri d'une matrice sur la base d'un vecteur
//n :  nombre de lignes de la matrice   (observations)
//m : nombre de colonnes de la matrice  (variables)
//index : numro de la colonne (variable) sur laquelle sera effectu le tri
var
  i,j,h,k :integer;
  ascendant :boolean;
  xtmp:vecteurF;
begin
  setlength(xtmp,m);
  ascendant:=(c='a')or(c='A');
  h:=1;
  while (h<=n) do h:=succ(3*h);
  while h<>1 do
    begin
      h:=h div 3;
      for i:=h to pred(n) do
        begin
          for k:=0 to pred(m) do xtmp[k]:=x[i,k];
          j:=i;
          if ascendant then
            begin
              while x[j-h,index]>xtmp[index] do
                begin
                  for k:=0 to pred(m) do x[j,k]:=x[j-h,k];
                  j:=j-h;
                  if j<h then break;
                end;
            end
            else
            begin
              while x[j-h,index]<xtmp[index] do
                begin
                  for k:=0 to pred(m) do x[j,k]:=x[j-h,k];
                  j:=j-h;
                  if j<h then break;
                end;
            end;
           for k:=0 to pred(m) do x[j,k]:=xtmp[k];
        end;
    end;
end;

procedure fsortV2(c:char;n,m:integer;var y:vecteurF;var x:matriceF);
//tri d'une matrice x sur la base d'un vecteur extrieur  la matrice y
//n :  nombre de lignes de la matrice x  et du vecteur index
//m : nombre de colonnes de la matrice  (variables)
var
  i,j,h,k :integer;
  ascendant :boolean;
  xtmp:vecteurF;
  ytmp  :extended;
begin
  setlength(xtmp,m);
  ascendant:=(c='a')or(c='A');
  h:=1;
  while (h<=n) do h:=succ(3*h);
  while h<>1 do
    begin
      h:=h div 3;
      for i:=h to pred(n) do
        begin
          for k:=0 to pred(m) do xtmp[k]:=x[i,k];ytmp:=y[i];
          j:=i;
          if ascendant then
            begin
              while y[j-h]>ytmp do //       x[j-h,index]>xtmp[index] do
                begin
                  for k:=0 to pred(m) do x[j,k]:=x[j-h,k];y[j]:=y[j-h];
                  j:=j-h;
                  if j<h then break;
                end;
            end
            else
            begin
              while y[j-h]<ytmp do //      x[j-h,index]<xtmp[index] do
                begin
                  for k:=0 to pred(m) do x[j,k]:=x[j-h,k];y[j]:=y[j-h];
                  j:=j-h;
                  if j<h then break;
                end;
            end;
           for k:=0 to pred(m) do x[j,k]:=xtmp[k];y[i]:=ytmp;
        end;
    end;
end;

procedure isort(c:char;n:integer;x:vecteurI);
var
  i,j,h :integer;
  ascendant :boolean;
  xtmp:integer;
begin
  ascendant:=(c='a')or(c='A');
  h:=1;
  while (h<=n) do h:=succ(3*h);
  while h<>1 do
    begin
      h:=h div 3;
      for i:=h to pred(n) do
        begin
          xtmp:=x[i];
          j:=i;
          if ascendant then
            begin
              while x[j-h]>xtmp do
                begin
                  x[j]:=x[j-h];
                  j:=j-h;
                  if j<h then break;
                end;
            end
            else
            begin
              while x[j-h]<xtmp do
                begin
                  x[j]:=x[j-h];
                  j:=j-h;
                  if j<h then break;
                end;
            end;
           x[j]:=xtmp;
        end;
    end;
end;

procedure covarianceponderee(A:matriceE;w:vecteurF;var mu:vecteurF;var sigma:matriceE);
var
  i,j,d,l,k   :integer;
  sx,wn       :vecteurF;
  sxy         :matriceF;
  sw2,sw      :extended;
begin
  d:=succ(high(A.x[0]));l:=succ(high(w));
  setlength(mu,d);setlength(sigma.x,d,d);
  setlength(sx,d);setlength(sxy,d,d);setlength(wn,l);
  sw:=0.0;for k:=0 to pred(l) do sw:=sw+w[k];
  for k:=0 to pred(l) do wn[k]:=w[k]/sw;
  sw2:=0.0;for k:=0 to pred(l) do sw2:=sw2+sqr(wn[k]);
  for i:=0 to pred(d) do
    begin
      sx[i]:=0.0;for k:=0 to pred(l) do sx[i]:=sx[i]+wn[k]*A.x[k,i];
      mu[i]:=sx[i];
      for j:=0 to i do
        begin
          sxy[i,j]:=0.0;
          for k:=0 to pred(l) do sxy[i,j]:=sxy[i,j]+wn[k]*A.x[k,i]*A.x[k,j];
          sxy[j,i]:=sxy[i,j];
        end;
    end;
  for i:=0 to pred(d) do for j:=0 to pred(d) do sigma.x[i,j]:=(sxy[i,j]-sx[i]*sx[j])/(1.0-sw2);
end;

procedure quantilesponderes(X,w,q:vecteurF;var quant:vecteurF);
var
  i,j  :integer;
  s,st,t :extended;
  Y    :matriceF;
begin
  setlength(quant,succ(high(q)));setlength(Y,succ(high(X)),2);
  for i:=0 to high(X) do begin Y[i,0]:=X[i];Y[i,1]:=w[i];end;
  fsortV('a',succ(high(Y)),2,0,Y);
  st:=0.0;for i:=0 to high(Y) do st:=st+Y[i,1];
  for j:=0 to high(q) do
    begin
      t:=q[j]*st;s:=0.0;i:=-1;
      repeat
        inc(i);
        s:=s+Y[i,1];
      until s>=t;
      quant[j]:=Y[i,0];
    end;
end;

procedure cal_moysdI(n:integer;x:vecteurI;var moy:extended;var sd:extended);
var
  sx,sx2  :extended;
  i  :integer;
begin
  sx:=0.0;sx2:=0.0;
  for i:=0 to pred(n) do begin sx:=sx+x[i];sx2:=sx2+sqr(1.0*x[i]);end;
  if n<2 then sd:=0.0 else sd:=sqrt((sx2-sqr(sx)/n)/pred(n));
  if n<1 then moy:=0.0 else moy:=sx/n;
end;

procedure cal_moysdF(n:integer;x:vecteurF;var moy:extended;var sd:extended);
var
  sx,sx2,a  :extended;
  i  :integer;
  ident  :boolean;
begin
  sx:=0.0;sx2:=0.0;
  a:=x[0];ident:=true;i:=1;while ident and (i<length(x)) do begin ident:=x[i]=a;inc(i);end;
  if ident  then begin moy:=a;sd:=0.0;exit;end;
  for i:=0 to pred(n) do begin sx:=sx+x[i];sx2:=sx2+sqr(x[i]);end;
  if n<2 then sd:=0.0 else sd:=sqrt((sx2-sqr(sx)/n)/pred(n));
  if n<1 then moy:=0.0 else moy:=sx/n;
end;

procedure cal_moysdlogI(n:integer;x:vecteurI;var moy:extended;var sd:extended);
var
  sx,sx2,xx  :extended;
  i  :integer;
begin
  sx:=0.0;sx2:=0.0;
  for i:=0 to pred(n) do begin xx:=ln(x[i]);sx:=sx+xx;sx2:=sx2+sqr(xx);end;
  if n<2 then sd:=0.0 else sd:=sqrt((sx2-sqr(sx)/n)/pred(n));
  if n<1 then moy:=0.0 else moy:=sx/n;
end;

procedure cal_moysdlogF(n:integer;x:vecteurF;var moy:extended;var sd:extended);
var
  sx,sx2,xx  :extended;
  i  :integer;
begin
  sx:=0.0;sx2:=0.0;
  for i:=0 to pred(n) do begin  xx:=ln(x[i]);sx:=sx+xx;sx2:=sx2+sqr(xx);end;
  if n<2 then sd:=0.0 else sd:=sqrt((sx2-sqr(sx)/n)/pred(n));
  if n<1 then moy:=0.0 else moy:=sx/n;
end;

function logitt(x,xmin,xmax:extended):extended;
begin
  if x>=xmax then Result:=1E100
    else if x<=xmin then Result:=-1E100
      else Result:=ln((x-xmin)/(xmax-x));
end;

function invlogitt(x,xmin,xmax:extended):extended;
begin
  if x>1E30 then Result:=xmax
    else if x<-1E30 then Result:=xmin
      else Result:=(exp(x)*xmax+xmin)/(1+exp(x))
end;

function inlimit(x,min,max:extended):boolean;
begin
  Result:=(x>=min)and(x<=max);
end;

procedure li_genepop(nomfi:string;var mes,title:string;var nloc,nech,nindtot:integer;var nind:vecteurI;var nomloc,nomind:arrayS;var geno:arraySS);

const
  tab=chr(9);

var
  i,loc,p0,p1,io  :integer;
  f0  :textfile;
  ligne,li,lj :string;
begin
  mes:='';
  assignfile(f0,nomfi);
  try reset(f0); except mes:='Cannot open file';exit;end;
  readln(f0,title);
  if pos('<NF=',title)<1 then sexratio:=0.5 else
    begin
      p0:=pos('<NF=',title);p1:=pos('NM>',title);
      if p1-p0=4 then sexratio:=0.5 else
        begin
          ligne:=copy(title,p0+4,p1-p0-4);
          while ligne[1]=' ' do ligne:=copy(ligne,2,length(ligne));
          while ligne[length(ligne)]=' ' do ligne:=copy(ligne,1,pred(length(ligne)));
          if length(ligne)>0 then val(ligne,sexratio,io) else sexratio:=1.0;
          sexratio:=1.0/(1.0+sexratio);
        end;
    end;
  nloc:=0;
  repeat
    if eof(f0) then begin mes:='Wrong file type';exit;end;
    repeat
      readln(f0,ligne);
      while (length(ligne)>0) and (ligne[1]=' ') do ligne:=copy(ligne,2,length(ligne));
    until length(ligne)>0;
    li:='';for i:=1 to length(ligne) do li:=li+UpCase(ligne[i]);
    if pos('POP',li)=0 then
      begin
        inc(nloc);setlength(nomloc,nloc);nomloc[pred(nloc)]:=li;
      end;
  until pos('POP',li)>0;
  nech:=1;setlength(nind,nech);nind[pred(nech)]:=0;
  nindtot:=0;
  setlength(geno,nloc,nech);
  while not eof(f0) do
    begin
      readln(f0,ligne);
      for i:=1 to length(ligne)  do if ligne[i]=tab then ligne[i]:=' ';
      li:='';for i:=1 to length(ligne) do if ligne[i]<>' ' then li:=li+UpCase(ligne[i]);
      if (pos('POP',li)>0)and(pos(',',li)=0) then
        begin
          inc(nech);setlength(nind,nech);nind[pred(nech)]:=0;
        end
        else
        begin
          inc(nindtot);inc(nind[pred(nech)]);
          setlength(nomind,nindtot);
          setlength(geno,nloc,nindtot);
          li:=copy(ligne,1,pred(pos(',',ligne)));
          while li[1]=' ' do li:=copy(li,2,length(li));
          while li[length(li)]=' ' do li:=copy(li,1,pred(length(li)));
          nomind[pred(nindtot)]:=li;
          li:=copy(ligne,succ(pos(',',ligne)),length(ligne))+' ';
          for loc:=0 to pred(nloc) do
            begin
              while li[1]=' ' do li:=copy(li,2,length(li));
              lj:=copy(li,1,pred(pos(' ',li)));
              geno[loc,pred(nindtot)]:=lj;
              li:=copy(li,succ(pos(' ',li)),length(li));
            end;
        end;
    end;
  closefile(f0);
end;

//initialization
//  aa:=0.0;aaa:=0.0;

end.
