\documentclass[12pt,a4paper]{article}
\usepackage[utf8]{inputenc}
\usepackage[francais]{babel}
\usepackage[T1]{fontenc}
\usepackage{graphicx}
\usepackage{fancyhdr}
\usepackage{geometry}
\usepackage{hyperref}
\author{Veyssier Julien}
%\institute{Université de Montpellier 2}

\title{Documentation sur le développement de \\
DIYABC en python}
\date\today
%\pagestyle{headings}
\pagestyle{fancy}
\fancyhf{}
\fancyhead[L]{\thepage}
\fancyhead[R]{DIYACB python doc | Veyssier}
%\fancyhead[LE,RO]{\thesection}

\geometry{hmargin=2.5cm,vmargin=2cm}

\begin{document}

\maketitle
%\begin{center}powered by \LaTeX\end{center}
\newpage

\tableofcontents

\newpage
 

\section{Introduction}
Ce projet est la refonte de DIYABC, initialement programmé en delphi, en PyQt.
	\subsection{Objectifs}
        Modulariser le code de sorte à permettre facilement l'ajout de nouveaux blocs, tant graphiques que fonctionnels.

	\subsection{Choix d'outils}
        La librairie Qt a été choisie pour sa portabilité, sa flexibilité et sa facilité d'utilisation. Le langage python 
        a été choisi pour sa clarté, sa réutilisabilité et son grand nombre de librairies. QtCreator et/ou QtDesigner sont utilisés pour
        la production des objets graphiques.

\section{Conception}
    \subsection{Partie graphique}
        La partie graphique statique est découplée du fonctionnement. Des fichiers .ui sont produits à partir d'un IDE. Toute entité graphique
        étant succeptible d'être présente plusieurs fois dans l'application est produite indépendament dans un .ui et une classe associée.
        
        L'ui principal est celui de la fenêtre principale.
        Un ui peut n'être qu'un widget. Un fichier source python produit à partir d'un .ui avec ``pyuic'' contient une classe non graphique
        qui crée tous les objets graphiques à l'intérieur de l'objet que l'on veut créer.

        Exemple : Création d'une scroll area.
        \begin{itemize}
            \item Création d'une ui pour QScrollArea
            \item Génération du code python avec pyuic4
            \item Instanciation d'un objet QScrollArea (on peut créer une classe qui dérive de QScrollArea ou bien instancier un vrai QScrollArea)
            \item Appel de la methode setupUi de la classe générée avec l'objet QScrollArea en paramètre
        \end{itemize}
    \subsection{Coeur de l'application}
        La classe principale de l'application dérive de QMainWindow

    \subsection{Proposition d'architectures}
        On pourrait dissocier complètement la partie graphique du fonctionnement, c'est à dire avoir une partie du programme
        qui ne manipule que des objets conceptuels (projet, historical model...) qui appelle son système d'affichage à souhait.

        On pourrait faire une classe abstraite Displayer dérivée en QtDisplayer et CliDisplayer.


\section{Documentation}

\section{Construction du projet}
    Pour générer un exécutable compatible avec un système, il faut : 
    \begin{itemize}
    \item Se trouver sur ce système
    \item Posséder python et toutes les librairies nécessaires au programme
    \item Disposer de pyinstaller
    \end{itemize}
    
    \subsection{Windows}
        \subsubsection{pyinstaller}
        La version 1.4 nécessite une version de python <= à 2.5. L'utilisation de pyinstaller est assez simple. Il faut, 
        lancer ``python Configure.py'' pour que pyinstaller se configure par rapport au système sur lequel il est. Ensuite il faut
        lancer ``python Makespec.py --onefile path\_to\_python\_main\_source.py'' qui génère le specfile dans un dossier du même nom que
        notre source python. Ensuite ``python Build.py specfile.spec'' construit l'exécutable qui se trouvera dans le même dossier que le spec file
        dans un dossier nommé ``dist''.

        Je n'ai pas testé la version 1.5 mais elle doit fonctionner.

        \subsubsection{Installer PyQt4}
        Un installer python 2.5.4 est disponible ici : http://www.python.org/download/releases/2.5.4/ . 
        Un installer PyQt4 est dispo ici : http://www.riverbankcomputing.co.uk/static/Downloads/PyQt4/ .
        Expérience personnelle : PyQt4 pour python 2.5 ne marche pas. Donc j'ai installé python 2.6 puis 
        PyQt4 pour python 2.6. Dans le path système, j'ai donné le chemin pour que la version de python utilisée
        soit la 2.5 mais pour que PyQt4 soit celui installé dans le dossier de python 2.6 et ça marche.
    \subsection{Linux}
        \subsubsection{Installer PyQt4}
        PyQt4 est packagé pour toutes les distributions. Aucun problème de ce côté.
        \subsubsection{pyinstaller}
        Pyinstaller semble ne pas fonctionner parfaitement sous linux. L'exécutable produit ne marche que
        sur la machine qui l'a créé. Je suis d'avis qu'il faut plutôt faire un paquet debian et/ou rpm
        et distribuer le programme de cette façon.

    \subsection{MacOs 10.6 Snow Leopard}
        \subsubsection{Installer PyQt4}
        PyQt n'est pas disponible en binaire sur MacOs. Il faut donc avoir Qt et gcc pour le compiler. 
        Gcc n'est que très difficilement installable sans Xcode. Il faut donc installer Xcode.
        En suivant à peu près les instructions données à cette adresse : http://deanezra.com/2010/05/setting-up-pythonqt-pyqt4-on-mac-os-x-snow-leopard/
        , on arrive à bout de cette installation qui est tout de même un gros morceau pour pas grand chose.
    
        Pour la version 4.8.3 de PyQt, je n'ai trouvé d'autre solution que de commenter les 3 lignes qui concernent
        ``designer'' pour que la compilation fonctionne. En cas d'erreurs incompréhensibles, bien penser à faire un ``make clean''
        pour effacer les .o déjà compilés qui peuvent provenir d'une compilation précédente mal paramétrée.

        \subsubsection{pyinstaller}
        La version 1.4 de pyinstaller ne contient pas de bootloader précompilé. Il faut la 1.5 pour MacOs.
        En suivant à peu près les instructions à cette adresse : http://diotavelli.net/PyQtWiki/PyInstallerOnMacOSX, on arrive à créer un 
        .app qui fonctionne. Le tuto dit de ne pas utiliser l'option ``--onefile'' mais elle fonctionne.

\section{Utilisation}

\section{Limites et améliorations}


\end{document}
